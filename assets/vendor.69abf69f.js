"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;function e(e){var t={exports:{}};return e(t,t.exports),t.exports}var t=e((function(e,t){e.exports=function(){var e=function(e){return e instanceof Uint8Array||e instanceof Uint16Array||e instanceof Uint32Array||e instanceof Int8Array||e instanceof Int16Array||e instanceof Int32Array||e instanceof Float32Array||e instanceof Float64Array||e instanceof Uint8ClampedArray},t=function(e,t){for(var n=Object.keys(t),r=0;r<n.length;++r)e[n[r]]=t[n[r]];return e},n="\n";function r(e){return"undefined"!=typeof atob?atob(e):"base64:"+e}function i(e){var t=new Error("(regl) "+e);throw console.error(t),t}function o(e,t){e||i(t)}function a(e){return e?": "+e:""}function s(e,t,n){e in t||i("unknown parameter ("+e+")"+a(n)+". possible values: "+Object.keys(t).join())}function u(t,n){e(t)||i("invalid parameter type"+a(n)+". must be a typed array")}function l(e,t){switch(t){case"number":return"number"==typeof e;case"object":return"object"==typeof e;case"string":return"string"==typeof e;case"boolean":return"boolean"==typeof e;case"function":return"function"==typeof e;case"undefined":return void 0===e;case"symbol":return"symbol"==typeof e}}function c(e,t,n){l(e,t)||i("invalid parameter type"+a(n)+". expected "+t+", got "+typeof e)}function p(e,t){e>=0&&(0|e)===e||i("invalid parameter type, ("+e+")"+a(t)+". must be a nonnegative integer")}function f(e,t,n){t.indexOf(e)<0&&i("invalid value"+a(n)+". must be one of: "+t)}var d=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function h(e){Object.keys(e).forEach((function(e){d.indexOf(e)<0&&i('invalid regl constructor argument "'+e+'". must be one of '+d)}))}function v(e,t){for(e+="";e.length<t;)e=" "+e;return e}function m(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function b(e,t){this.number=e,this.line=t,this.errors=[]}function g(e,t,n){this.file=e,this.line=t,this.message=n}function y(){var e=new Error,t=(e.stack||e).toString(),n=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(t);if(n)return n[1];var r=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(t);return r?r[1]:"unknown"}function w(){var e=new Error,t=(e.stack||e).toString(),n=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(t);if(n)return n[1];var r=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(t);return r?r[1]:"unknown"}function _(e,t){var n=e.split("\n"),i=1,o=0,a={unknown:new m,0:new m};a.unknown.name=a[0].name=t||y(),a.unknown.lines.push(new b(0,""));for(var s=0;s<n.length;++s){var u=n[s],l=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(u);if(l)switch(l[1]){case"line":var c=/(\d+)(\s+\d+)?/.exec(l[2]);c&&(i=0|c[1],c[2]&&((o=0|c[2])in a||(a[o]=new m)));break;case"define":var p=/SHADER_NAME(_B64)?\s+(.*)$/.exec(l[2]);p&&(a[o].name=p[1]?r(p[2]):p[2])}a[o].lines.push(new b(i++,u))}return Object.keys(a).forEach((function(e){var t=a[e];t.lines.forEach((function(e){t.index[e.number]=e}))})),a}function x(e){var t=[];return e.split("\n").forEach((function(e){if(!(e.length<5)){var n=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(e);n?t.push(new g(0|n[1],0|n[2],n[3].trim())):e.length>0&&t.push(new g("unknown",0,e))}})),t}function C(e,t){t.forEach((function(t){var n=e[t.file];if(n){var r=n.index[t.line];if(r)return r.errors.push(t),void(n.hasErrors=!0)}e.unknown.hasErrors=!0,e.unknown.lines[0].errors.push(t)}))}function k(e,t,r,i,a){if(!e.getShaderParameter(t,e.COMPILE_STATUS)){var s=e.getShaderInfoLog(t),u=i===e.FRAGMENT_SHADER?"fragment":"vertex";D(r,"string",u+" shader source must be a string",a);var l=_(r,a),c=x(s);C(l,c),Object.keys(l).forEach((function(e){var t=l[e];if(t.hasErrors){var r=[""],i=[""];o("file number "+e+": "+t.name+"\n","color:red;text-decoration:underline;font-weight:bold"),t.lines.forEach((function(e){if(e.errors.length>0){o(v(e.number,4)+"|  ","background-color:yellow; font-weight:bold"),o(e.line+n,"color:red; background-color:yellow; font-weight:bold");var t=0;e.errors.forEach((function(r){var i=r.message,a=/^\s*'(.*)'\s*:\s*(.*)$/.exec(i);if(a){var s=a[1];switch(i=a[2],s){case"assign":s="="}t=Math.max(e.line.indexOf(s,t),0)}else t=0;o(v("| ",6)),o(v("^^^",t+3)+n,"font-weight:bold"),o(v("| ",6)),o(i+n,"font-weight:bold")})),o(v("| ",6)+n)}else o(v(e.number,4)+"|  "),o(e.line+n,"color:red")})),"undefined"==typeof document||window.chrome?console.log(r.join("")):(i[0]=r.join("%c"),console.log.apply(console,i))}function o(e,t){r.push(e),i.push(t||"")}})),o.raise("Error compiling "+u+" shader, "+l[0].name)}}function E(e,t,r,i,a){if(!e.getProgramParameter(t,e.LINK_STATUS)){var s=e.getProgramInfoLog(t),u=_(r,a),l='Error linking program with vertex shader, "'+_(i,a)[0].name+'", and fragment shader "'+u[0].name+'"';"undefined"!=typeof document?console.log("%c"+l+n+"%c"+s,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(l+n+s),o.raise(l)}}function P(e){e._commandRef=y()}function A(e,t,n,r){function i(e){return e?r.id(e):0}function o(e,t){Object.keys(t).forEach((function(t){e[r.id(t)]=!0}))}P(e),e._fragId=i(e.static.frag),e._vertId=i(e.static.vert);var a=e._uniformSet={};o(a,t.static),o(a,t.dynamic);var s=e._attributeSet={};o(s,n.static),o(s,n.dynamic),e._hasCount="count"in e.static||"count"in e.dynamic||"elements"in e.static||"elements"in e.dynamic}function V(e,t){var n=w();i(e+" in command "+(t||y())+("unknown"===n?"":" called from "+n))}function S(e,t,n){e||V(t,n||y())}function O(e,t,n,r){e in t||V("unknown parameter ("+e+")"+a(n)+". possible values: "+Object.keys(t).join(),r||y())}function D(e,t,n,r){l(e,t)||V("invalid parameter type"+a(n)+". expected "+t+", got "+typeof e,r||y())}function j(e){e()}function L(e,t,n){e.texture?f(e.texture._texture.internalformat,t,"unsupported texture format for attachment"):f(e.renderbuffer._renderbuffer.format,n,"unsupported renderbuffer format for attachment")}var T=33071,F=9728,M=9984,B=9985,I=9986,R=9987,z=5121,N=5122,U=5123,H=5124,K=5125,G=5126,q=32819,W=32820,Y=33635,Q=34042,$=36193,X={};function J(e,t){return e===W||e===q||e===Y?2:e===Q?4:X[e]*t}function Z(e){return!(e&e-1||!e)}function ee(e,t,n){var r,i=t.width,a=t.height,s=t.channels;o(i>0&&i<=n.maxTextureSize&&a>0&&a<=n.maxTextureSize,"invalid texture shape"),e.wrapS===T&&e.wrapT===T||o(Z(i)&&Z(a),"incompatible wrap mode for texture, both width and height must be power of 2"),1===t.mipmask?1!==i&&1!==a&&o(e.minFilter!==M&&e.minFilter!==I&&e.minFilter!==B&&e.minFilter!==R,"min filter requires mipmap"):(o(Z(i)&&Z(a),"texture must be a square power of 2 to support mipmapping"),o(t.mipmask===(i<<1)-1,"missing or incomplete mipmap data")),t.type===G&&(n.extensions.indexOf("oes_texture_float_linear")<0&&o(e.minFilter===F&&e.magFilter===F,"filter not supported, must enable oes_texture_float_linear"),o(!e.genMipmaps,"mipmap generation not supported with float textures"));var u=t.images;for(r=0;r<16;++r)if(u[r]){var l=i>>r,c=a>>r;o(t.mipmask&1<<r,"missing mipmap data");var p=u[r];if(o(p.width===l&&p.height===c,"invalid shape for mip images"),o(p.format===t.format&&p.internalformat===t.internalformat&&p.type===t.type,"incompatible type for mip image"),p.compressed);else if(p.data){var f=Math.ceil(J(p.type,s)*l/p.unpackAlignment)*p.unpackAlignment;o(p.data.byteLength===f*c,"invalid data for image, buffer size is inconsistent with image format")}else p.element||p.copy}else e.genMipmaps||o(0==(t.mipmask&1<<r),"extra mipmap data");t.compressed&&o(!e.genMipmaps,"mipmap generation for compressed images not supported")}function te(e,t,n,r){var i=e.width,a=e.height,s=e.channels;o(i>0&&i<=r.maxTextureSize&&a>0&&a<=r.maxTextureSize,"invalid texture shape"),o(i===a,"cube map must be square"),o(t.wrapS===T&&t.wrapT===T,"wrap mode not supported by cube map");for(var u=0;u<n.length;++u){var l=n[u];o(l.width===i&&l.height===a,"inconsistent cube map face shape"),t.genMipmaps&&(o(!l.compressed,"can not generate mipmap for compressed textures"),o(1===l.mipmask,"can not specify mipmaps and generate mipmaps"));for(var c=l.images,p=0;p<16;++p){var f=c[p];if(f){var d=i>>p,h=a>>p;o(l.mipmask&1<<p,"missing mipmap data"),o(f.width===d&&f.height===h,"invalid shape for mip images"),o(f.format===e.format&&f.internalformat===e.internalformat&&f.type===e.type,"incompatible type for mip image"),f.compressed||(f.data?o(f.data.byteLength===d*h*Math.max(J(f.type,s),f.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):f.element||f.copy)}}}}X[5120]=X[z]=1,X[N]=X[U]=X[$]=X[Y]=X[q]=X[W]=2,X[H]=X[K]=X[G]=X[Q]=4;var ne=t(o,{optional:j,raise:i,commandRaise:V,command:S,parameter:s,commandParameter:O,constructor:h,type:c,commandType:D,isTypedArray:u,nni:p,oneOf:f,shaderError:k,linkError:E,callSite:w,saveCommandRef:P,saveDrawInfo:A,framebufferFormat:L,guessCommand:y,texture2D:ee,textureCube:te}),re=0,ie=0,oe=5,ae=6;function se(e,t){this.id=re++,this.type=e,this.data=t}function ue(e){return e.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function le(e){if(0===e.length)return[];var t=e.charAt(0),n=e.charAt(e.length-1);if(e.length>1&&t===n&&('"'===t||"'"===t))return['"'+ue(e.substr(1,e.length-2))+'"'];var r=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(e);if(r)return le(e.substr(0,r.index)).concat(le(r[1])).concat(le(e.substr(r.index+r[0].length)));var i=e.split(".");if(1===i.length)return['"'+ue(e)+'"'];for(var o=[],a=0;a<i.length;++a)o=o.concat(le(i[a]));return o}function ce(e){return"["+le(e).join("][")+"]"}function pe(e,t){return new se(e,ce(t+""))}function fe(e){return"function"==typeof e&&!e._reglType||e instanceof se}function de(e,t){return"function"==typeof e?new se(ie,e):"number"==typeof e||"boolean"==typeof e?new se(oe,e):Array.isArray(e)?new se(ae,e.map((function(e,n){return de(e,t+"["+n+"]")}))):e instanceof se?e:void ne(!1,"invalid option type in uniform "+t)}var he={DynamicVariable:se,define:pe,isDynamic:fe,unbox:de,accessor:ce},ve={next:"function"==typeof requestAnimationFrame?function(e){return requestAnimationFrame(e)}:function(e){return setTimeout(e,16)},cancel:"function"==typeof cancelAnimationFrame?function(e){return cancelAnimationFrame(e)}:clearTimeout},me="undefined"!=typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date};function be(){var e={"":0},t=[""];return{id:function(n){var r=e[n];return r||(r=e[n]=t.length,t.push(n),r)},str:function(e){return t[e]}}}function ge(e,n,r){var i,o=document.createElement("canvas");function a(){var t=window.innerWidth,n=window.innerHeight;if(e!==document.body){var i=o.getBoundingClientRect();t=i.right-i.left,n=i.bottom-i.top}o.width=r*t,o.height=r*n}function s(){i?i.disconnect():window.removeEventListener("resize",a),e.removeChild(o)}return t(o.style,{border:0,margin:0,padding:0,top:0,left:0,width:"100%",height:"100%"}),e.appendChild(o),e===document.body&&(o.style.position="absolute",t(e.style,{margin:0,padding:0})),e!==document.body&&"function"==typeof ResizeObserver?(i=new ResizeObserver((function(){setTimeout(a)}))).observe(e):window.addEventListener("resize",a,!1),a(),{canvas:o,onDestroy:s}}function ye(e,t){function n(n){try{return e.getContext(n,t)}catch(r){return null}}return n("webgl")||n("experimental-webgl")||n("webgl-experimental")}function we(e){return"string"==typeof e.nodeName&&"function"==typeof e.appendChild&&"function"==typeof e.getBoundingClientRect}function _e(e){return"function"==typeof e.drawArrays||"function"==typeof e.drawElements}function xe(e){return"string"==typeof e?e.split():(ne(Array.isArray(e),"invalid extension array"),e)}function Ce(e){return"string"==typeof e?(ne("undefined"!=typeof document,"not supported outside of DOM"),document.querySelector(e)):e}function ke(e){var t,n,r,i,o=e||{},a={},s=[],u=[],l="undefined"==typeof window?1:window.devicePixelRatio,c=!1,p=function(e){e&&ne.raise(e)},f=function(){};if("string"==typeof o?(ne("undefined"!=typeof document,"selector queries only supported in DOM enviroments"),t=document.querySelector(o),ne(t,"invalid query string for element")):"object"==typeof o?we(o)?t=o:_e(o)?r=(i=o).canvas:(ne.constructor(o),"gl"in o?i=o.gl:"canvas"in o?r=Ce(o.canvas):"container"in o&&(n=Ce(o.container)),"attributes"in o&&(a=o.attributes,ne.type(a,"object","invalid context attributes")),"extensions"in o&&(s=xe(o.extensions)),"optionalExtensions"in o&&(u=xe(o.optionalExtensions)),"onDone"in o&&(ne.type(o.onDone,"function","invalid or missing onDone callback"),p=o.onDone),"profile"in o&&(c=!!o.profile),"pixelRatio"in o&&(l=+o.pixelRatio,ne(l>0,"invalid pixel ratio"))):ne.raise("invalid arguments to regl"),t&&("canvas"===t.nodeName.toLowerCase()?r=t:n=t),!i){if(!r){ne("undefined"!=typeof document,"must manually specify webgl context outside of DOM environments");var d=ge(n||document.body,p,l);if(!d)return null;r=d.canvas,f=d.onDestroy}void 0===a.premultipliedAlpha&&(a.premultipliedAlpha=!0),i=ye(r,a)}return i?{gl:i,canvas:r,container:n,extensions:s,optionalExtensions:u,pixelRatio:l,profile:c,onDone:p,onDestroy:f}:(f(),p("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function Ee(e,t){var n={};function r(t){ne.type(t,"string","extension name must be string");var r,i=t.toLowerCase();try{r=n[i]=e.getExtension(i)}catch(o){}return!!r}for(var i=0;i<t.extensions.length;++i){var o=t.extensions[i];if(!r(o))return t.onDestroy(),t.onDone('"'+o+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return t.optionalExtensions.forEach(r),{extensions:n,restore:function(){Object.keys(n).forEach((function(e){if(n[e]&&!r(e))throw new Error("(regl): error restoring extension "+e)}))}}}function Pe(e,t){for(var n=Array(e),r=0;r<e;++r)n[r]=t(r);return n}var Ae=5120,Ve=5121,Se=5122,Oe=5123,De=5124,je=5125,Le=5126;function Te(e){for(var t=16;t<=1<<28;t*=16)if(e<=t)return t;return 0}function Fe(e){var t,n;return t=(e>65535)<<4,t|=n=((e>>>=t)>255)<<3,t|=n=((e>>>=n)>15)<<2,(t|=n=((e>>>=n)>3)<<1)|(e>>>=n)>>1}function Me(){var e=Pe(8,(function(){return[]}));function t(t){var n=Te(t),r=e[Fe(n)>>2];return r.length>0?r.pop():new ArrayBuffer(n)}function n(t){e[Fe(t.byteLength)>>2].push(t)}function r(e,n){var r=null;switch(e){case Ae:r=new Int8Array(t(n),0,n);break;case Ve:r=new Uint8Array(t(n),0,n);break;case Se:r=new Int16Array(t(2*n),0,n);break;case Oe:r=new Uint16Array(t(2*n),0,n);break;case De:r=new Int32Array(t(4*n),0,n);break;case je:r=new Uint32Array(t(4*n),0,n);break;case Le:r=new Float32Array(t(4*n),0,n);break;default:return null}return r.length!==n?r.subarray(0,n):r}function i(e){n(e.buffer)}return{alloc:t,free:n,allocType:r,freeType:i}}var Be=Me();Be.zero=Me();var Ie=3408,Re=3410,ze=3411,Ne=3412,Ue=3413,He=3414,Ke=3415,Ge=33901,qe=33902,We=3379,Ye=3386,Qe=34921,$e=36347,Xe=36348,Je=35661,Ze=35660,et=34930,tt=36349,nt=34076,rt=34024,it=7936,ot=7937,at=7938,st=35724,ut=34047,lt=36063,ct=34852,pt=3553,ft=34067,dt=34069,ht=33984,vt=6408,mt=5126,bt=5121,gt=36160,yt=36053,wt=36064,_t=16384,xt=function(e,t){var n=1;t.ext_texture_filter_anisotropic&&(n=e.getParameter(ut));var r=1,i=1;t.webgl_draw_buffers&&(r=e.getParameter(ct),i=e.getParameter(lt));var o=!!t.oes_texture_float;if(o){var a=e.createTexture();e.bindTexture(pt,a),e.texImage2D(pt,0,vt,1,1,0,vt,mt,null);var s=e.createFramebuffer();if(e.bindFramebuffer(gt,s),e.framebufferTexture2D(gt,wt,pt,a,0),e.bindTexture(pt,null),e.checkFramebufferStatus(gt)!==yt)o=!1;else{e.viewport(0,0,1,1),e.clearColor(1,0,0,1),e.clear(_t);var u=Be.allocType(mt,4);e.readPixels(0,0,1,1,vt,mt,u),e.getError()?o=!1:(e.deleteFramebuffer(s),e.deleteTexture(a),o=1===u[0]),Be.freeType(u)}}var l=!0;if("undefined"==typeof navigator||!(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent))){var c=e.createTexture(),p=Be.allocType(bt,36);e.activeTexture(ht),e.bindTexture(ft,c),e.texImage2D(dt,0,vt,3,3,0,vt,bt,p),Be.freeType(p),e.bindTexture(ft,null),e.deleteTexture(c),l=!e.getError()}return{colorBits:[e.getParameter(Re),e.getParameter(ze),e.getParameter(Ne),e.getParameter(Ue)],depthBits:e.getParameter(He),stencilBits:e.getParameter(Ke),subpixelBits:e.getParameter(Ie),extensions:Object.keys(t).filter((function(e){return!!t[e]})),maxAnisotropic:n,maxDrawbuffers:r,maxColorAttachments:i,pointSizeDims:e.getParameter(Ge),lineWidthDims:e.getParameter(qe),maxViewportDims:e.getParameter(Ye),maxCombinedTextureUnits:e.getParameter(Je),maxCubeMapSize:e.getParameter(nt),maxRenderbufferSize:e.getParameter(rt),maxTextureUnits:e.getParameter(et),maxTextureSize:e.getParameter(We),maxAttributes:e.getParameter(Qe),maxVertexUniforms:e.getParameter($e),maxVertexTextureUnits:e.getParameter(Ze),maxVaryingVectors:e.getParameter(Xe),maxFragmentUniforms:e.getParameter(tt),glsl:e.getParameter(st),renderer:e.getParameter(ot),vendor:e.getParameter(it),version:e.getParameter(at),readFloat:o,npotTextureCube:l}};function Ct(t){return!!t&&"object"==typeof t&&Array.isArray(t.shape)&&Array.isArray(t.stride)&&"number"==typeof t.offset&&t.shape.length===t.stride.length&&(Array.isArray(t.data)||e(t.data))}var kt=function(e){return Object.keys(e).map((function(t){return e[t]}))},Et={shape:Dt,flatten:Ot};function Pt(e,t,n){for(var r=0;r<t;++r)n[r]=e[r]}function At(e,t,n,r){for(var i=0,o=0;o<t;++o)for(var a=e[o],s=0;s<n;++s)r[i++]=a[s]}function Vt(e,t,n,r,i,o){for(var a=o,s=0;s<t;++s)for(var u=e[s],l=0;l<n;++l)for(var c=u[l],p=0;p<r;++p)i[a++]=c[p]}function St(e,t,n,r,i){for(var o=1,a=n+1;a<t.length;++a)o*=t[a];var s=t[n];if(t.length-n==4){var u=t[n+1],l=t[n+2],c=t[n+3];for(a=0;a<s;++a)Vt(e[a],u,l,c,r,i),i+=o}else for(a=0;a<s;++a)St(e[a],t,n+1,r,i),i+=o}function Ot(e,t,n,r){var i=1;if(t.length)for(var o=0;o<t.length;++o)i*=t[o];else i=0;var a=r||Be.allocType(n,i);switch(t.length){case 0:break;case 1:Pt(e,t[0],a);break;case 2:At(e,t[0],t[1],a);break;case 3:Vt(e,t[0],t[1],t[2],a,0);break;default:St(e,t,0,a,0)}return a}function Dt(e){for(var t=[],n=e;n.length;n=n[0])t.push(n.length);return t}var jt={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},Lt={int8:5120,int16:5122,int32:5124,uint8:5121,uint16:5123,uint32:5125,float:5126,float32:5126},Tt={dynamic:35048,stream:35040,static:35044},Ft=Et.flatten,Mt=Et.shape,Bt=35044,It=35040,Rt=5121,zt=5126,Nt=[];function Ut(e){return 0|jt[Object.prototype.toString.call(e)]}function Ht(e,t){for(var n=0;n<t.length;++n)e[n]=t[n]}function Kt(e,t,n,r,i,o,a){for(var s=0,u=0;u<n;++u)for(var l=0;l<r;++l)e[s++]=t[i*u+o*l+a]}function Gt(t,n,r,i){var o=0,a={};function s(e){this.id=o++,this.buffer=t.createBuffer(),this.type=e,this.usage=Bt,this.byteLength=0,this.dimension=1,this.dtype=Rt,this.persistentData=null,r.profile&&(this.stats={size:0})}s.prototype.bind=function(){t.bindBuffer(this.type,this.buffer)},s.prototype.destroy=function(){d(this)};var u=[];function l(e,t){var n=u.pop();return n||(n=new s(e)),n.bind(),f(n,t,It,0,1,!1),n}function c(e){u.push(e)}function p(e,n,r){e.byteLength=n.byteLength,t.bufferData(e.type,n,r)}function f(t,n,r,i,o,a){var s,u;if(t.usage=r,Array.isArray(n)){if(t.dtype=i||zt,n.length>0)if(Array.isArray(n[0])){s=Mt(n);for(var l=1,c=1;c<s.length;++c)l*=s[c];t.dimension=l,p(t,u=Ft(n,s,t.dtype),r),a?t.persistentData=u:Be.freeType(u)}else if("number"==typeof n[0]){t.dimension=o;var f=Be.allocType(t.dtype,n.length);Ht(f,n),p(t,f,r),a?t.persistentData=f:Be.freeType(f)}else e(n[0])?(t.dimension=n[0].length,t.dtype=i||Ut(n[0])||zt,p(t,u=Ft(n,[n.length,n[0].length],t.dtype),r),a?t.persistentData=u:Be.freeType(u)):ne.raise("invalid buffer data")}else if(e(n))t.dtype=i||Ut(n),t.dimension=o,p(t,n,r),a&&(t.persistentData=new Uint8Array(new Uint8Array(n.buffer)));else if(Ct(n)){s=n.shape;var d=n.stride,h=n.offset,v=0,m=0,b=0,g=0;1===s.length?(v=s[0],m=1,b=d[0],g=0):2===s.length?(v=s[0],m=s[1],b=d[0],g=d[1]):ne.raise("invalid shape"),t.dtype=i||Ut(n.data)||zt,t.dimension=m;var y=Be.allocType(t.dtype,v*m);Kt(y,n.data,v,m,b,g,h),p(t,y,r),a?t.persistentData=y:Be.freeType(y)}else n instanceof ArrayBuffer?(t.dtype=Rt,t.dimension=o,p(t,n,r),a&&(t.persistentData=new Uint8Array(new Uint8Array(n)))):ne.raise("invalid buffer data")}function d(e){n.bufferCount--,i(e);var r=e.buffer;ne(r,"buffer must not be deleted already"),t.deleteBuffer(r),e.buffer=null,delete a[e.id]}function h(i,o,u,l){n.bufferCount++;var c=new s(o);function p(n){var i=Bt,o=null,a=0,s=0,u=1;return Array.isArray(n)||e(n)||Ct(n)||n instanceof ArrayBuffer?o=n:"number"==typeof n?a=0|n:n&&(ne.type(n,"object","buffer arguments must be an object, a number or an array"),"data"in n&&(ne(null===o||Array.isArray(o)||e(o)||Ct(o),"invalid data for buffer"),o=n.data),"usage"in n&&(ne.parameter(n.usage,Tt,"invalid buffer usage"),i=Tt[n.usage]),"type"in n&&(ne.parameter(n.type,Lt,"invalid buffer type"),s=Lt[n.type]),"dimension"in n&&(ne.type(n.dimension,"number","invalid dimension"),u=0|n.dimension),"length"in n&&(ne.nni(a,"buffer length must be a nonnegative integer"),a=0|n.length)),c.bind(),o?f(c,o,i,s,u,l):(a&&t.bufferData(c.type,a,i),c.dtype=s||Rt,c.usage=i,c.dimension=u,c.byteLength=a),r.profile&&(c.stats.size=c.byteLength*Nt[c.dtype]),p}function h(e,n){ne(n+e.byteLength<=c.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+e.byteLength+" starting from offset "+n+" to a buffer of size "+c.byteLength),t.bufferSubData(c.type,n,e)}function v(t,n){var r,i=0|(n||0);if(c.bind(),e(t)||t instanceof ArrayBuffer)h(t,i);else if(Array.isArray(t)){if(t.length>0)if("number"==typeof t[0]){var o=Be.allocType(c.dtype,t.length);Ht(o,t),h(o,i),Be.freeType(o)}else if(Array.isArray(t[0])||e(t[0])){r=Mt(t);var a=Ft(t,r,c.dtype);h(a,i),Be.freeType(a)}else ne.raise("invalid buffer data")}else if(Ct(t)){r=t.shape;var s=t.stride,u=0,l=0,f=0,d=0;1===r.length?(u=r[0],l=1,f=s[0],d=0):2===r.length?(u=r[0],l=r[1],f=s[0],d=s[1]):ne.raise("invalid shape");var v=Array.isArray(t.data)?c.dtype:Ut(t.data),m=Be.allocType(v,u*l);Kt(m,t.data,u,l,f,d,t.offset),h(m,i),Be.freeType(m)}else ne.raise("invalid data for buffer subdata");return p}return a[c.id]=c,u||p(i),p._reglType="buffer",p._buffer=c,p.subdata=v,r.profile&&(p.stats=c.stats),p.destroy=function(){d(c)},p}function v(){kt(a).forEach((function(e){e.buffer=t.createBuffer(),t.bindBuffer(e.type,e.buffer),t.bufferData(e.type,e.persistentData||e.byteLength,e.usage)}))}return r.profile&&(n.getTotalBufferSize=function(){var e=0;return Object.keys(a).forEach((function(t){e+=a[t].stats.size})),e}),{create:h,createStream:l,destroyStream:c,clear:function(){kt(a).forEach(d),u.forEach(d)},getBuffer:function(e){return e&&e._buffer instanceof s?e._buffer:null},restore:v,_initBuffer:f}}Nt[5120]=1,Nt[5122]=2,Nt[5124]=4,Nt[5121]=1,Nt[5123]=2,Nt[5125]=4,Nt[5126]=4;var qt={points:0,point:0,lines:1,line:1,triangles:4,triangle:4,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},Wt=0,Yt=1,Qt=4,$t=5120,Xt=5121,Jt=5122,Zt=5123,en=5124,tn=5125,nn=34963,rn=35040,on=35044;function an(t,n,r,i){var o={},a=0,s={uint8:Xt,uint16:Zt};function u(e){this.id=a++,o[this.id]=this,this.buffer=e,this.primType=Qt,this.vertCount=0,this.type=0}n.oes_element_index_uint&&(s.uint32=tn),u.prototype.bind=function(){this.buffer.bind()};var l=[];function c(e){var t=l.pop();return t||(t=new u(r.create(null,nn,!0,!1)._buffer)),f(t,e,rn,-1,-1,0,0),t}function p(e){l.push(e)}function f(i,o,a,s,u,l,c){var p;if(i.buffer.bind(),o){var f=c;c||e(o)&&(!Ct(o)||e(o.data))||(f=n.oes_element_index_uint?tn:Zt),r._initBuffer(i.buffer,o,a,f,3)}else t.bufferData(nn,l,a),i.buffer.dtype=p||Xt,i.buffer.usage=a,i.buffer.dimension=3,i.buffer.byteLength=l;if(p=c,!c){switch(i.buffer.dtype){case Xt:case $t:p=Xt;break;case Zt:case Jt:p=Zt;break;case tn:case en:p=tn;break;default:ne.raise("unsupported type for element array")}i.buffer.dtype=p}i.type=p,ne(p!==tn||!!n.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var d=u;d<0&&(d=i.buffer.byteLength,p===Zt?d>>=1:p===tn&&(d>>=2)),i.vertCount=d;var h=s;if(s<0){h=Qt;var v=i.buffer.dimension;1===v&&(h=Wt),2===v&&(h=Yt),3===v&&(h=Qt)}i.primType=h}function d(e){i.elementsCount--,ne(null!==e.buffer,"must not double destroy elements"),delete o[e.id],e.buffer.destroy(),e.buffer=null}function h(t,n){var o=r.create(null,nn,!0),a=new u(o._buffer);function l(t){if(t)if("number"==typeof t)o(t),a.primType=Qt,a.vertCount=0|t,a.type=Xt;else{var n=null,r=on,i=-1,u=-1,c=0,p=0;Array.isArray(t)||e(t)||Ct(t)?n=t:(ne.type(t,"object","invalid arguments for elements"),"data"in t&&(n=t.data,ne(Array.isArray(n)||e(n)||Ct(n),"invalid data for element buffer")),"usage"in t&&(ne.parameter(t.usage,Tt,"invalid element buffer usage"),r=Tt[t.usage]),"primitive"in t&&(ne.parameter(t.primitive,qt,"invalid element buffer primitive"),i=qt[t.primitive]),"count"in t&&(ne("number"==typeof t.count&&t.count>=0,"invalid vertex count for elements"),u=0|t.count),"type"in t&&(ne.parameter(t.type,s,"invalid buffer type"),p=s[t.type]),"length"in t?c=0|t.length:(c=u,p===Zt||p===Jt?c*=2:p!==tn&&p!==en||(c*=4))),f(a,n,r,i,u,c,p)}else o(),a.primType=Qt,a.vertCount=0,a.type=Xt;return l}return i.elementsCount++,l(t),l._reglType="elements",l._elements=a,l.subdata=function(e,t){return o.subdata(e,t),l},l.destroy=function(){d(a)},l}return{create:h,createStream:c,destroyStream:p,getElements:function(e){return"function"==typeof e&&e._elements instanceof u?e._elements:null},clear:function(){kt(o).forEach(d)}}}var sn=new Float32Array(1),un=new Uint32Array(sn.buffer),ln=5123;function cn(e){for(var t=Be.allocType(ln,e.length),n=0;n<e.length;++n)if(isNaN(e[n]))t[n]=65535;else if(e[n]===1/0)t[n]=31744;else if(e[n]===-1/0)t[n]=64512;else{sn[0]=e[n];var r=un[0],i=r>>>31<<15,o=(r<<1>>>24)-127,a=r>>13&1023;if(o<-24)t[n]=i;else if(o<-14){var s=-14-o;t[n]=i+(a+1024>>s)}else t[n]=o>15?i+31744:i+(o+15<<10)+a}return t}function pn(t){return Array.isArray(t)||e(t)}var fn=function(e){return!(e&e-1||!e)},dn=34467,hn=3553,vn=34067,mn=34069,bn=6408,gn=6406,yn=6407,wn=6409,_n=6410,xn=32854,Cn=32855,kn=36194,En=32819,Pn=32820,An=33635,Vn=34042,Sn=6402,On=34041,Dn=35904,jn=35906,Ln=36193,Tn=33776,Fn=33777,Mn=33778,Bn=33779,In=35986,Rn=35987,zn=34798,Nn=35840,Un=35841,Hn=35842,Kn=35843,Gn=36196,qn=5121,Wn=5123,Yn=5125,Qn=5126,$n=10242,Xn=10243,Jn=10497,Zn=33071,er=33648,tr=10240,nr=10241,rr=9728,ir=9729,or=9984,ar=9985,sr=9986,ur=9987,lr=33170,cr=4352,pr=4353,fr=4354,dr=34046,hr=3317,vr=37440,mr=37441,br=37443,gr=37444,yr=33984,wr=[or,sr,ar,ur],_r=[0,wn,_n,yn,bn],xr={};function Cr(e){return"[object "+e+"]"}xr[wn]=xr[gn]=xr[Sn]=1,xr[On]=xr[_n]=2,xr[yn]=xr[Dn]=3,xr[bn]=xr[jn]=4;var kr=Cr("HTMLCanvasElement"),Er=Cr("OffscreenCanvas"),Pr=Cr("CanvasRenderingContext2D"),Ar=Cr("ImageBitmap"),Vr=Cr("HTMLImageElement"),Sr=Cr("HTMLVideoElement"),Or=Object.keys(jt).concat([kr,Er,Pr,Ar,Vr,Sr]),Dr=[];Dr[qn]=1,Dr[Qn]=4,Dr[Ln]=2,Dr[Wn]=2,Dr[Yn]=4;var jr=[];function Lr(e){return Array.isArray(e)&&(0===e.length||"number"==typeof e[0])}function Tr(e){return!!Array.isArray(e)&&!(0===e.length||!pn(e[0]))}function Fr(e){return Object.prototype.toString.call(e)}function Mr(e){return Fr(e)===kr}function Br(e){return Fr(e)===Er}function Ir(e){return Fr(e)===Pr}function Rr(e){return Fr(e)===Ar}function zr(e){return Fr(e)===Vr}function Nr(e){return Fr(e)===Sr}function Ur(e){if(!e)return!1;var t=Fr(e);return Or.indexOf(t)>=0||Lr(e)||Tr(e)||Ct(e)}function Hr(e){return 0|jt[Object.prototype.toString.call(e)]}function Kr(e,t){var n=t.length;switch(e.type){case qn:case Wn:case Yn:case Qn:var r=Be.allocType(e.type,n);r.set(t),e.data=r;break;case Ln:e.data=cn(t);break;default:ne.raise("unsupported texture type, must specify a typed array")}}function Gr(e,t){return Be.allocType(e.type===Ln?Qn:e.type,t)}function qr(e,t){e.type===Ln?(e.data=cn(t),Be.freeType(t)):e.data=t}function Wr(e,t,n,r,i,o){for(var a=e.width,s=e.height,u=e.channels,l=Gr(e,a*s*u),c=0,p=0;p<s;++p)for(var f=0;f<a;++f)for(var d=0;d<u;++d)l[c++]=t[n*f+r*p+i*d+o];qr(e,l)}function Yr(e,t,n,r,i,o){var a;if(a=void 0!==jr[e]?jr[e]:xr[e]*Dr[t],o&&(a*=6),i){for(var s=0,u=n;u>=1;)s+=a*u*u,u/=2;return s}return a*n*r}function Qr(n,r,i,o,a,s,u){var l={"don't care":cr,"dont care":cr,nice:fr,fast:pr},c={repeat:Jn,clamp:Zn,mirror:er},p={nearest:rr,linear:ir},f=t({mipmap:ur,"nearest mipmap nearest":or,"linear mipmap nearest":ar,"nearest mipmap linear":sr,"linear mipmap linear":ur},p),d={none:0,browser:gr},h={uint8:qn,rgba4:En,rgb565:An,"rgb5 a1":Pn},v={alpha:gn,luminance:wn,"luminance alpha":_n,rgb:yn,rgba:bn,rgba4:xn,"rgb5 a1":Cn,rgb565:kn},m={};r.ext_srgb&&(v.srgb=Dn,v.srgba=jn),r.oes_texture_float&&(h.float32=h.float=Qn),r.oes_texture_half_float&&(h.float16=h["half float"]=Ln),r.webgl_depth_texture&&(t(v,{depth:Sn,"depth stencil":On}),t(h,{uint16:Wn,uint32:Yn,"depth stencil":Vn})),r.webgl_compressed_texture_s3tc&&t(m,{"rgb s3tc dxt1":Tn,"rgba s3tc dxt1":Fn,"rgba s3tc dxt3":Mn,"rgba s3tc dxt5":Bn}),r.webgl_compressed_texture_atc&&t(m,{"rgb atc":In,"rgba atc explicit alpha":Rn,"rgba atc interpolated alpha":zn}),r.webgl_compressed_texture_pvrtc&&t(m,{"rgb pvrtc 4bppv1":Nn,"rgb pvrtc 2bppv1":Un,"rgba pvrtc 4bppv1":Hn,"rgba pvrtc 2bppv1":Kn}),r.webgl_compressed_texture_etc1&&(m["rgb etc1"]=Gn);var b=Array.prototype.slice.call(n.getParameter(dn));Object.keys(m).forEach((function(e){var t=m[e];b.indexOf(t)>=0&&(v[e]=t)}));var g=Object.keys(v);i.textureFormats=g;var y=[];Object.keys(v).forEach((function(e){var t=v[e];y[t]=e}));var w=[];Object.keys(h).forEach((function(e){var t=h[e];w[t]=e}));var _=[];Object.keys(p).forEach((function(e){var t=p[e];_[t]=e}));var x=[];Object.keys(f).forEach((function(e){var t=f[e];x[t]=e}));var C=[];Object.keys(c).forEach((function(e){var t=c[e];C[t]=e}));var k=g.reduce((function(e,t){var n=v[t];return n===wn||n===gn||n===wn||n===_n||n===Sn||n===On||r.ext_srgb&&(n===Dn||n===jn)?e[n]=n:n===Cn||t.indexOf("rgba")>=0?e[n]=bn:e[n]=yn,e}),{});function E(){this.internalformat=bn,this.format=bn,this.type=qn,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=gr,this.width=0,this.height=0,this.channels=0}function P(e,t){e.internalformat=t.internalformat,e.format=t.format,e.type=t.type,e.compressed=t.compressed,e.premultiplyAlpha=t.premultiplyAlpha,e.flipY=t.flipY,e.unpackAlignment=t.unpackAlignment,e.colorSpace=t.colorSpace,e.width=t.width,e.height=t.height,e.channels=t.channels}function A(e,t){if("object"==typeof t&&t){if("premultiplyAlpha"in t&&(ne.type(t.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),e.premultiplyAlpha=t.premultiplyAlpha),"flipY"in t&&(ne.type(t.flipY,"boolean","invalid texture flip"),e.flipY=t.flipY),"alignment"in t&&(ne.oneOf(t.alignment,[1,2,4,8],"invalid texture unpack alignment"),e.unpackAlignment=t.alignment),"colorSpace"in t&&(ne.parameter(t.colorSpace,d,"invalid colorSpace"),e.colorSpace=d[t.colorSpace]),"type"in t){var n=t.type;ne(r.oes_texture_float||!("float"===n||"float32"===n),"you must enable the OES_texture_float extension in order to use floating point textures."),ne(r.oes_texture_half_float||!("half float"===n||"float16"===n),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),ne(r.webgl_depth_texture||!("uint16"===n||"uint32"===n||"depth stencil"===n),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),ne.parameter(n,h,"invalid texture type"),e.type=h[n]}var o=e.width,a=e.height,s=e.channels,u=!1;"shape"in t?(ne(Array.isArray(t.shape)&&t.shape.length>=2,"shape must be an array"),o=t.shape[0],a=t.shape[1],3===t.shape.length&&(s=t.shape[2],ne(s>0&&s<=4,"invalid number of channels"),u=!0),ne(o>=0&&o<=i.maxTextureSize,"invalid width"),ne(a>=0&&a<=i.maxTextureSize,"invalid height")):("radius"in t&&(o=a=t.radius,ne(o>=0&&o<=i.maxTextureSize,"invalid radius")),"width"in t&&(o=t.width,ne(o>=0&&o<=i.maxTextureSize,"invalid width")),"height"in t&&(a=t.height,ne(a>=0&&a<=i.maxTextureSize,"invalid height")),"channels"in t&&(s=t.channels,ne(s>0&&s<=4,"invalid number of channels"),u=!0)),e.width=0|o,e.height=0|a,e.channels=0|s;var l=!1;if("format"in t){var c=t.format;ne(r.webgl_depth_texture||!("depth"===c||"depth stencil"===c),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),ne.parameter(c,v,"invalid texture format");var p=e.internalformat=v[c];e.format=k[p],c in h&&("type"in t||(e.type=h[c])),c in m&&(e.compressed=!0),l=!0}!u&&l?e.channels=xr[e.format]:u&&!l?e.channels!==_r[e.format]&&(e.format=e.internalformat=_r[e.channels]):l&&u&&ne(e.channels===xr[e.format],"number of channels inconsistent with specified format")}}function V(e){n.pixelStorei(vr,e.flipY),n.pixelStorei(mr,e.premultiplyAlpha),n.pixelStorei(br,e.colorSpace),n.pixelStorei(hr,e.unpackAlignment)}function S(){E.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function O(t,n){var r=null;if(Ur(n)?r=n:n&&(ne.type(n,"object","invalid pixel data type"),A(t,n),"x"in n&&(t.xOffset=0|n.x),"y"in n&&(t.yOffset=0|n.y),Ur(n.data)&&(r=n.data)),ne(!t.compressed||r instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),n.copy){ne(!r,"can not specify copy and data field for the same texture");var o=a.viewportWidth,s=a.viewportHeight;t.width=t.width||o-t.xOffset,t.height=t.height||s-t.yOffset,t.needsCopy=!0,ne(t.xOffset>=0&&t.xOffset<o&&t.yOffset>=0&&t.yOffset<s&&t.width>0&&t.width<=o&&t.height>0&&t.height<=s,"copy texture read out of bounds")}else if(r){if(e(r))t.channels=t.channels||4,t.data=r,"type"in n||t.type!==qn||(t.type=Hr(r));else if(Lr(r))t.channels=t.channels||4,Kr(t,r),t.alignment=1,t.needsFree=!0;else if(Ct(r)){var u=r.data;Array.isArray(u)||t.type!==qn||(t.type=Hr(u));var l,c,p,f,d,h,v=r.shape,m=r.stride;3===v.length?(p=v[2],h=m[2]):(ne(2===v.length,"invalid ndarray pixel data, must be 2 or 3D"),p=1,h=1),l=v[0],c=v[1],f=m[0],d=m[1],t.alignment=1,t.width=l,t.height=c,t.channels=p,t.format=t.internalformat=_r[p],t.needsFree=!0,Wr(t,u,f,d,h,r.offset)}else if(Mr(r)||Br(r)||Ir(r))Mr(r)||Br(r)?t.element=r:t.element=r.canvas,t.width=t.element.width,t.height=t.element.height,t.channels=4;else if(Rr(r))t.element=r,t.width=r.width,t.height=r.height,t.channels=4;else if(zr(r))t.element=r,t.width=r.naturalWidth,t.height=r.naturalHeight,t.channels=4;else if(Nr(r))t.element=r,t.width=r.videoWidth,t.height=r.videoHeight,t.channels=4;else if(Tr(r)){var b=t.width||r[0].length,g=t.height||r.length,y=t.channels;y=pn(r[0][0])?y||r[0][0].length:y||1;for(var w=Et.shape(r),_=1,x=0;x<w.length;++x)_*=w[x];var C=Gr(t,_);Et.flatten(r,w,"",C),qr(t,C),t.alignment=1,t.width=b,t.height=g,t.channels=y,t.format=t.internalformat=_r[y],t.needsFree=!0}}else t.width=t.width||1,t.height=t.height||1,t.channels=t.channels||4;t.type===Qn?ne(i.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):t.type===Ln&&ne(i.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function D(e,t,r){var i=e.element,a=e.data,s=e.internalformat,u=e.format,l=e.type,c=e.width,p=e.height;V(e),i?n.texImage2D(t,r,u,u,l,i):e.compressed?n.compressedTexImage2D(t,r,s,c,p,0,a):e.needsCopy?(o(),n.copyTexImage2D(t,r,u,e.xOffset,e.yOffset,c,p,0)):n.texImage2D(t,r,u,c,p,0,u,l,a||null)}function j(e,t,r,i,a){var s=e.element,u=e.data,l=e.internalformat,c=e.format,p=e.type,f=e.width,d=e.height;V(e),s?n.texSubImage2D(t,a,r,i,c,p,s):e.compressed?n.compressedTexSubImage2D(t,a,r,i,l,f,d,u):e.needsCopy?(o(),n.copyTexSubImage2D(t,a,r,i,e.xOffset,e.yOffset,f,d)):n.texSubImage2D(t,a,r,i,f,d,c,p,u)}var L=[];function T(){return L.pop()||new S}function F(e){e.needsFree&&Be.freeType(e.data),S.call(e),L.push(e)}function M(){E.call(this),this.genMipmaps=!1,this.mipmapHint=cr,this.mipmask=0,this.images=Array(16)}function B(e,t,n){var r=e.images[0]=T();e.mipmask=1,r.width=e.width=t,r.height=e.height=n,r.channels=e.channels=4}function I(e,t){var n=null;if(Ur(t))P(n=e.images[0]=T(),e),O(n,t),e.mipmask=1;else if(A(e,t),Array.isArray(t.mipmap))for(var r=t.mipmap,i=0;i<r.length;++i)P(n=e.images[i]=T(),e),n.width>>=i,n.height>>=i,O(n,r[i]),e.mipmask|=1<<i;else P(n=e.images[0]=T(),e),O(n,t),e.mipmask=1;P(e,e.images[0]),!e.compressed||e.internalformat!==Tn&&e.internalformat!==Fn&&e.internalformat!==Mn&&e.internalformat!==Bn||ne(e.width%4==0&&e.height%4==0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function R(e,t){for(var n=e.images,r=0;r<n.length;++r){if(!n[r])return;D(n[r],t,r)}}var z=[];function N(){var e=z.pop()||new M;E.call(e),e.mipmask=0;for(var t=0;t<16;++t)e.images[t]=null;return e}function U(e){for(var t=e.images,n=0;n<t.length;++n)t[n]&&F(t[n]),t[n]=null;z.push(e)}function H(){this.minFilter=rr,this.magFilter=rr,this.wrapS=Zn,this.wrapT=Zn,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=cr}function K(e,t){if("min"in t){var n=t.min;ne.parameter(n,f),e.minFilter=f[n],wr.indexOf(e.minFilter)>=0&&!("faces"in t)&&(e.genMipmaps=!0)}if("mag"in t){var r=t.mag;ne.parameter(r,p),e.magFilter=p[r]}var o=e.wrapS,a=e.wrapT;if("wrap"in t){var s=t.wrap;"string"==typeof s?(ne.parameter(s,c),o=a=c[s]):Array.isArray(s)&&(ne.parameter(s[0],c),ne.parameter(s[1],c),o=c[s[0]],a=c[s[1]])}else{if("wrapS"in t){var u=t.wrapS;ne.parameter(u,c),o=c[u]}if("wrapT"in t){var d=t.wrapT;ne.parameter(d,c),a=c[d]}}if(e.wrapS=o,e.wrapT=a,"anisotropic"in t){var h=t.anisotropic;ne("number"==typeof h&&h>=1&&h<=i.maxAnisotropic,"aniso samples must be between 1 and "),e.anisotropic=t.anisotropic}if("mipmap"in t){var v=!1;switch(typeof t.mipmap){case"string":ne.parameter(t.mipmap,l,"invalid mipmap hint"),e.mipmapHint=l[t.mipmap],e.genMipmaps=!0,v=!0;break;case"boolean":v=e.genMipmaps=t.mipmap;break;case"object":ne(Array.isArray(t.mipmap),"invalid mipmap type"),e.genMipmaps=!1,v=!0;break;default:ne.raise("invalid mipmap type")}v&&!("min"in t)&&(e.minFilter=or)}}function G(e,t){n.texParameteri(t,nr,e.minFilter),n.texParameteri(t,tr,e.magFilter),n.texParameteri(t,$n,e.wrapS),n.texParameteri(t,Xn,e.wrapT),r.ext_texture_filter_anisotropic&&n.texParameteri(t,dr,e.anisotropic),e.genMipmaps&&(n.hint(lr,e.mipmapHint),n.generateMipmap(t))}var q=0,W={},Y=i.maxTextureUnits,Q=Array(Y).map((function(){return null}));function $(e){E.call(this),this.mipmask=0,this.internalformat=bn,this.id=q++,this.refCount=1,this.target=e,this.texture=n.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new H,u.profile&&(this.stats={size:0})}function X(e){n.activeTexture(yr),n.bindTexture(e.target,e.texture)}function J(){var e=Q[0];e?n.bindTexture(e.target,e.texture):n.bindTexture(hn,null)}function Z(e){var t=e.texture;ne(t,"must not double destroy texture");var r=e.unit,i=e.target;r>=0&&(n.activeTexture(yr+r),n.bindTexture(i,null),Q[r]=null),n.deleteTexture(t),e.texture=null,e.params=null,e.pixels=null,e.refCount=0,delete W[e.id],s.textureCount--}function ee(e,t){var r=new $(hn);function o(e,t){var n=r.texInfo;H.call(n);var a=N();return"number"==typeof e?B(a,0|e,"number"==typeof t?0|t:0|e):e?(ne.type(e,"object","invalid arguments to regl.texture"),K(n,e),I(a,e)):B(a,1,1),n.genMipmaps&&(a.mipmask=(a.width<<1)-1),r.mipmask=a.mipmask,P(r,a),ne.texture2D(n,a,i),r.internalformat=a.internalformat,o.width=a.width,o.height=a.height,X(r),R(a,hn),G(n,hn),J(),U(a),u.profile&&(r.stats.size=Yr(r.internalformat,r.type,a.width,a.height,n.genMipmaps,!1)),o.format=y[r.internalformat],o.type=w[r.type],o.mag=_[n.magFilter],o.min=x[n.minFilter],o.wrapS=C[n.wrapS],o.wrapT=C[n.wrapT],o}function a(e,t,n,i){ne(!!e,"must specify image data");var a=0|t,s=0|n,u=0|i,l=T();return P(l,r),l.width=0,l.height=0,O(l,e),l.width=l.width||(r.width>>u)-a,l.height=l.height||(r.height>>u)-s,ne(r.type===l.type&&r.format===l.format&&r.internalformat===l.internalformat,"incompatible format for texture.subimage"),ne(a>=0&&s>=0&&a+l.width<=r.width&&s+l.height<=r.height,"texture.subimage write out of bounds"),ne(r.mipmask&1<<u,"missing mipmap data"),ne(l.data||l.element||l.needsCopy,"missing image data"),X(r),j(l,hn,a,s,u),J(),F(l),o}function l(e,t){var i=0|e,a=0|t||i;if(i===r.width&&a===r.height)return o;o.width=r.width=i,o.height=r.height=a,X(r);for(var s=0;r.mipmask>>s;++s){var l=i>>s,c=a>>s;if(!l||!c)break;n.texImage2D(hn,s,r.format,l,c,0,r.format,r.type,null)}return J(),u.profile&&(r.stats.size=Yr(r.internalformat,r.type,i,a,!1,!1)),o}return W[r.id]=r,s.textureCount++,o(e,t),o.subimage=a,o.resize=l,o._reglType="texture2d",o._texture=r,u.profile&&(o.stats=r.stats),o.destroy=function(){r.decRef()},o}function te(e,t,r,o,a,l){var c=new $(vn);W[c.id]=c,s.cubeCount++;var p=new Array(6);function f(e,t,n,r,o,a){var s,l=c.texInfo;for(H.call(l),s=0;s<6;++s)p[s]=N();if("number"!=typeof e&&e)if("object"==typeof e)if(t)I(p[0],e),I(p[1],t),I(p[2],n),I(p[3],r),I(p[4],o),I(p[5],a);else if(K(l,e),A(c,e),"faces"in e){var d=e.faces;for(ne(Array.isArray(d)&&6===d.length,"cube faces must be a length 6 array"),s=0;s<6;++s)ne("object"==typeof d[s]&&!!d[s],"invalid input for cube map face"),P(p[s],c),I(p[s],d[s])}else for(s=0;s<6;++s)I(p[s],e);else ne.raise("invalid arguments to cube map");else{var h=0|e||1;for(s=0;s<6;++s)B(p[s],h,h)}for(P(c,p[0]),ne.optional((function(){i.npotTextureCube||ne(fn(c.width)&&fn(c.height),"your browser does not support non power or two texture dimensions")})),l.genMipmaps?c.mipmask=(p[0].width<<1)-1:c.mipmask=p[0].mipmask,ne.textureCube(c,l,p,i),c.internalformat=p[0].internalformat,f.width=p[0].width,f.height=p[0].height,X(c),s=0;s<6;++s)R(p[s],mn+s);for(G(l,vn),J(),u.profile&&(c.stats.size=Yr(c.internalformat,c.type,f.width,f.height,l.genMipmaps,!0)),f.format=y[c.internalformat],f.type=w[c.type],f.mag=_[l.magFilter],f.min=x[l.minFilter],f.wrapS=C[l.wrapS],f.wrapT=C[l.wrapT],s=0;s<6;++s)U(p[s]);return f}function d(e,t,n,r,i){ne(!!t,"must specify image data"),ne("number"==typeof e&&e===(0|e)&&e>=0&&e<6,"invalid face");var o=0|n,a=0|r,s=0|i,u=T();return P(u,c),u.width=0,u.height=0,O(u,t),u.width=u.width||(c.width>>s)-o,u.height=u.height||(c.height>>s)-a,ne(c.type===u.type&&c.format===u.format&&c.internalformat===u.internalformat,"incompatible format for texture.subimage"),ne(o>=0&&a>=0&&o+u.width<=c.width&&a+u.height<=c.height,"texture.subimage write out of bounds"),ne(c.mipmask&1<<s,"missing mipmap data"),ne(u.data||u.element||u.needsCopy,"missing image data"),X(c),j(u,mn+e,o,a,s),J(),F(u),f}function h(e){var t=0|e;if(t!==c.width){f.width=c.width=t,f.height=c.height=t,X(c);for(var r=0;r<6;++r)for(var i=0;c.mipmask>>i;++i)n.texImage2D(mn+r,i,c.format,t>>i,t>>i,0,c.format,c.type,null);return J(),u.profile&&(c.stats.size=Yr(c.internalformat,c.type,f.width,f.height,!1,!0)),f}}return f(e,t,r,o,a,l),f.subimage=d,f.resize=h,f._reglType="textureCube",f._texture=c,u.profile&&(f.stats=c.stats),f.destroy=function(){c.decRef()},f}function re(){for(var e=0;e<Y;++e)n.activeTexture(yr+e),n.bindTexture(hn,null),Q[e]=null;kt(W).forEach(Z),s.cubeCount=0,s.textureCount=0}function ie(){for(var e=0;e<Y;++e){var t=Q[e];t&&(t.bindCount=0,t.unit=-1,Q[e]=null)}kt(W).forEach((function(e){e.texture=n.createTexture(),n.bindTexture(e.target,e.texture);for(var t=0;t<32;++t)if(0!=(e.mipmask&1<<t))if(e.target===hn)n.texImage2D(hn,t,e.internalformat,e.width>>t,e.height>>t,0,e.internalformat,e.type,null);else for(var r=0;r<6;++r)n.texImage2D(mn+r,t,e.internalformat,e.width>>t,e.height>>t,0,e.internalformat,e.type,null);G(e.texInfo,e.target)}))}function oe(){for(var e=0;e<Y;++e){var t=Q[e];t&&(t.bindCount=0,t.unit=-1,Q[e]=null),n.activeTexture(yr+e),n.bindTexture(hn,null),n.bindTexture(vn,null)}}return t($.prototype,{bind:function(){var e=this;e.bindCount+=1;var t=e.unit;if(t<0){for(var r=0;r<Y;++r){var i=Q[r];if(i){if(i.bindCount>0)continue;i.unit=-1}Q[r]=e,t=r;break}t>=Y&&ne.raise("insufficient number of texture units"),u.profile&&s.maxTextureUnits<t+1&&(s.maxTextureUnits=t+1),e.unit=t,n.activeTexture(yr+t),n.bindTexture(e.target,e.texture)}return t},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&Z(this)}}),u.profile&&(s.getTotalTextureSize=function(){var e=0;return Object.keys(W).forEach((function(t){e+=W[t].stats.size})),e}),{create2D:ee,createCube:te,clear:re,getTexture:function(e){return null},restore:ie,refresh:oe}}jr[xn]=2,jr[Cn]=2,jr[kn]=2,jr[On]=4,jr[Tn]=.5,jr[Fn]=.5,jr[Mn]=1,jr[Bn]=1,jr[In]=.5,jr[Rn]=1,jr[zn]=1,jr[Nn]=.5,jr[Un]=.25,jr[Hn]=.5,jr[Kn]=.25,jr[Gn]=.5;var $r=36161,Xr=32854,Jr=32855,Zr=36194,ei=33189,ti=36168,ni=34041,ri=35907,ii=34836,oi=34842,ai=34843,si=[];function ui(e,t,n){return si[e]*t*n}si[Xr]=2,si[Jr]=2,si[Zr]=2,si[ei]=2,si[ti]=1,si[ni]=4,si[ri]=4,si[ii]=16,si[oi]=8,si[ai]=6;var li=function(e,t,n,r,i){var o={rgba4:Xr,rgb565:Zr,"rgb5 a1":Jr,depth:ei,stencil:ti,"depth stencil":ni};t.ext_srgb&&(o.srgba=ri),t.ext_color_buffer_half_float&&(o.rgba16f=oi,o.rgb16f=ai),t.webgl_color_buffer_float&&(o.rgba32f=ii);var a=[];Object.keys(o).forEach((function(e){var t=o[e];a[t]=e}));var s=0,u={};function l(e){this.id=s++,this.refCount=1,this.renderbuffer=e,this.format=Xr,this.width=0,this.height=0,i.profile&&(this.stats={size:0})}function c(t){var n=t.renderbuffer;ne(n,"must not double destroy renderbuffer"),e.bindRenderbuffer($r,null),e.deleteRenderbuffer(n),t.renderbuffer=null,t.refCount=0,delete u[t.id],r.renderbufferCount--}function p(t,s){var c=new l(e.createRenderbuffer());function p(t,r){var s=0,u=0,l=Xr;if("object"==typeof t&&t){var f=t;if("shape"in f){var d=f.shape;ne(Array.isArray(d)&&d.length>=2,"invalid renderbuffer shape"),s=0|d[0],u=0|d[1]}else"radius"in f&&(s=u=0|f.radius),"width"in f&&(s=0|f.width),"height"in f&&(u=0|f.height);"format"in f&&(ne.parameter(f.format,o,"invalid renderbuffer format"),l=o[f.format])}else"number"==typeof t?(s=0|t,u="number"==typeof r?0|r:s):t?ne.raise("invalid arguments to renderbuffer constructor"):s=u=1;if(ne(s>0&&u>0&&s<=n.maxRenderbufferSize&&u<=n.maxRenderbufferSize,"invalid renderbuffer size"),s!==c.width||u!==c.height||l!==c.format)return p.width=c.width=s,p.height=c.height=u,c.format=l,e.bindRenderbuffer($r,c.renderbuffer),e.renderbufferStorage($r,l,s,u),ne(0===e.getError(),"invalid render buffer format"),i.profile&&(c.stats.size=ui(c.format,c.width,c.height)),p.format=a[c.format],p}function f(t,r){var o=0|t,a=0|r||o;return o===c.width&&a===c.height||(ne(o>0&&a>0&&o<=n.maxRenderbufferSize&&a<=n.maxRenderbufferSize,"invalid renderbuffer size"),p.width=c.width=o,p.height=c.height=a,e.bindRenderbuffer($r,c.renderbuffer),e.renderbufferStorage($r,c.format,o,a),ne(0===e.getError(),"invalid render buffer format"),i.profile&&(c.stats.size=ui(c.format,c.width,c.height))),p}return u[c.id]=c,r.renderbufferCount++,p(t,s),p.resize=f,p._reglType="renderbuffer",p._renderbuffer=c,i.profile&&(p.stats=c.stats),p.destroy=function(){c.decRef()},p}function f(){kt(u).forEach((function(t){t.renderbuffer=e.createRenderbuffer(),e.bindRenderbuffer($r,t.renderbuffer),e.renderbufferStorage($r,t.format,t.width,t.height)})),e.bindRenderbuffer($r,null)}return l.prototype.decRef=function(){--this.refCount<=0&&c(this)},i.profile&&(r.getTotalRenderbufferSize=function(){var e=0;return Object.keys(u).forEach((function(t){e+=u[t].stats.size})),e}),{create:p,clear:function(){kt(u).forEach(c)},restore:f}},ci=36160,pi=36161,fi=3553,di=34069,hi=36064,vi=36096,mi=36128,bi=33306,gi=36053,yi=36054,wi=36055,_i=36057,xi=36061,Ci=36193,ki=5121,Ei=5126,Pi=6407,Ai=6408,Vi=6402,Si=[Pi,Ai],Oi=[];Oi[Ai]=4,Oi[Pi]=3;var Di=[];Di[ki]=1,Di[Ei]=4,Di[Ci]=2;var ji=33189,Li=36168,Ti=34041,Fi=[32854,32855,36194,35907,34842,34843,34836],Mi={};function Bi(e,n,r,i,o,a){var s={cur:null,next:null,dirty:!1,setFBO:null},u=["rgba"],l=["rgba4","rgb565","rgb5 a1"];n.ext_srgb&&l.push("srgba"),n.ext_color_buffer_half_float&&l.push("rgba16f","rgb16f"),n.webgl_color_buffer_float&&l.push("rgba32f");var c=["uint8"];function p(e,t,n){this.target=e,this.texture=t,this.renderbuffer=n;var r=0,i=0;t?(r=t.width,i=t.height):n&&(r=n.width,i=n.height),this.width=r,this.height=i}function f(e){e&&(e.texture&&e.texture._texture.decRef(),e.renderbuffer&&e.renderbuffer._renderbuffer.decRef())}function d(e,t,n){if(e)if(e.texture){var r=e.texture._texture,i=Math.max(1,r.width),o=Math.max(1,r.height);ne(i===t&&o===n,"inconsistent width/height for supplied texture"),r.refCount+=1}else{var a=e.renderbuffer._renderbuffer;ne(a.width===t&&a.height===n,"inconsistent width/height for renderbuffer"),a.refCount+=1}}function h(t,n){n&&(n.texture?e.framebufferTexture2D(ci,t,n.target,n.texture._texture.texture,0):e.framebufferRenderbuffer(ci,t,pi,n.renderbuffer._renderbuffer.renderbuffer))}function v(e){var t=fi,n=null,r=null,i=e;"object"==typeof e&&(i=e.data,"target"in e&&(t=0|e.target)),ne.type(i,"function","invalid attachment data");var o=i._reglType;return"texture2d"===o?(n=i,ne(t===fi)):"textureCube"===o?(n=i,ne(t>=di&&t<di+6,"invalid cube map target")):"renderbuffer"===o?(r=i,t=pi):ne.raise("invalid regl object for attachment"),new p(t,n,r)}function m(e,t,n,r,a){if(n){var s=i.create2D({width:e,height:t,format:r,type:a});return s._texture.refCount=0,new p(fi,s,null)}var u=o.create({width:e,height:t,format:r});return u._renderbuffer.refCount=0,new p(pi,null,u)}function b(e){return e&&(e.texture||e.renderbuffer)}function g(e,t,n){e&&(e.texture?e.texture.resize(t,n):e.renderbuffer&&e.renderbuffer.resize(t,n),e.width=t,e.height=n)}n.oes_texture_half_float&&c.push("half float","float16"),n.oes_texture_float&&c.push("float","float32");var y=0,w={};function _(){this.id=y++,w[this.id]=this,this.framebuffer=e.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function x(e){e.colorAttachments.forEach(f),f(e.depthAttachment),f(e.stencilAttachment),f(e.depthStencilAttachment)}function C(t){var n=t.framebuffer;ne(n,"must not double destroy framebuffer"),e.deleteFramebuffer(n),t.framebuffer=null,a.framebufferCount--,delete w[t.id]}function k(t){var n;e.bindFramebuffer(ci,t.framebuffer);var i=t.colorAttachments;for(n=0;n<i.length;++n)h(hi+n,i[n]);for(n=i.length;n<r.maxColorAttachments;++n)e.framebufferTexture2D(ci,hi+n,fi,null,0);e.framebufferTexture2D(ci,bi,fi,null,0),e.framebufferTexture2D(ci,vi,fi,null,0),e.framebufferTexture2D(ci,mi,fi,null,0),h(vi,t.depthAttachment),h(mi,t.stencilAttachment),h(bi,t.depthStencilAttachment);var o=e.checkFramebufferStatus(ci);e.isContextLost()||o===gi||ne.raise("framebuffer configuration not supported, status = "+Mi[o]),e.bindFramebuffer(ci,s.next?s.next.framebuffer:null),s.cur=s.next,e.getError()}function E(e,i){var o=new _;function p(e,t){var i;ne(s.next!==o,"can not update framebuffer which is currently in use");var a=0,f=0,h=!0,g=!0,y=null,w=!0,_="rgba",C="uint8",E=1,P=null,A=null,V=null,S=!1;if("number"==typeof e)a=0|e,f=0|t||a;else if(e){ne.type(e,"object","invalid arguments for framebuffer");var O=e;if("shape"in O){var D=O.shape;ne(Array.isArray(D)&&D.length>=2,"invalid shape for framebuffer"),a=D[0],f=D[1]}else"radius"in O&&(a=f=O.radius),"width"in O&&(a=O.width),"height"in O&&(f=O.height);("color"in O||"colors"in O)&&(y=O.color||O.colors,Array.isArray(y)&&ne(1===y.length||n.webgl_draw_buffers,"multiple render targets not supported")),y||("colorCount"in O&&(E=0|O.colorCount,ne(E>0,"invalid color buffer count")),"colorTexture"in O&&(w=!!O.colorTexture,_="rgba4"),"colorType"in O&&(C=O.colorType,w?(ne(n.oes_texture_float||!("float"===C||"float32"===C),"you must enable OES_texture_float in order to use floating point framebuffer objects"),ne(n.oes_texture_half_float||!("half float"===C||"float16"===C),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):"half float"===C||"float16"===C?(ne(n.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),_="rgba16f"):"float"!==C&&"float32"!==C||(ne(n.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),_="rgba32f"),ne.oneOf(C,c,"invalid color type")),"colorFormat"in O&&(_=O.colorFormat,u.indexOf(_)>=0?w=!0:l.indexOf(_)>=0?w=!1:ne.optional((function(){w?ne.oneOf(O.colorFormat,u,"invalid color format for texture"):ne.oneOf(O.colorFormat,l,"invalid color format for renderbuffer")})))),("depthTexture"in O||"depthStencilTexture"in O)&&(S=!(!O.depthTexture&&!O.depthStencilTexture),ne(!S||n.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in O&&("boolean"==typeof O.depth?h=O.depth:(P=O.depth,g=!1)),"stencil"in O&&("boolean"==typeof O.stencil?g=O.stencil:(A=O.stencil,h=!1)),"depthStencil"in O&&("boolean"==typeof O.depthStencil?h=g=O.depthStencil:(V=O.depthStencil,h=!1,g=!1))}else a=f=1;var j=null,L=null,T=null,F=null;if(Array.isArray(y))j=y.map(v);else if(y)j=[v(y)];else for(j=new Array(E),i=0;i<E;++i)j[i]=m(a,f,w,_,C);ne(n.webgl_draw_buffers||j.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),ne(j.length<=r.maxColorAttachments,"too many color attachments, not supported"),a=a||j[0].width,f=f||j[0].height,P?L=v(P):h&&!g&&(L=m(a,f,S,"depth","uint32")),A?T=v(A):g&&!h&&(T=m(a,f,!1,"stencil","uint8")),V?F=v(V):!P&&!A&&g&&h&&(F=m(a,f,S,"depth stencil","depth stencil")),ne(!!P+!!A+!!V<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var M=null;for(i=0;i<j.length;++i)if(d(j[i],a,f),ne(!j[i]||j[i].texture&&Si.indexOf(j[i].texture._texture.format)>=0||j[i].renderbuffer&&Fi.indexOf(j[i].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+i+" is invalid"),j[i]&&j[i].texture){var B=Oi[j[i].texture._texture.format]*Di[j[i].texture._texture.type];null===M?M=B:ne(M===B,"all color attachments much have the same number of bits per pixel.")}return d(L,a,f),ne(!L||L.texture&&L.texture._texture.format===Vi||L.renderbuffer&&L.renderbuffer._renderbuffer.format===ji,"invalid depth attachment for framebuffer object"),d(T,a,f),ne(!T||T.renderbuffer&&T.renderbuffer._renderbuffer.format===Li,"invalid stencil attachment for framebuffer object"),d(F,a,f),ne(!F||F.texture&&F.texture._texture.format===Ti||F.renderbuffer&&F.renderbuffer._renderbuffer.format===Ti,"invalid depth-stencil attachment for framebuffer object"),x(o),o.width=a,o.height=f,o.colorAttachments=j,o.depthAttachment=L,o.stencilAttachment=T,o.depthStencilAttachment=F,p.color=j.map(b),p.depth=b(L),p.stencil=b(T),p.depthStencil=b(F),p.width=o.width,p.height=o.height,k(o),p}function f(e,t){ne(s.next!==o,"can not resize a framebuffer which is currently in use");var n=Math.max(0|e,1),r=Math.max(0|t||n,1);if(n===o.width&&r===o.height)return p;for(var i=o.colorAttachments,a=0;a<i.length;++a)g(i[a],n,r);return g(o.depthAttachment,n,r),g(o.stencilAttachment,n,r),g(o.depthStencilAttachment,n,r),o.width=p.width=n,o.height=p.height=r,k(o),p}return a.framebufferCount++,p(e,i),t(p,{resize:f,_reglType:"framebuffer",_framebuffer:o,destroy:function(){C(o),x(o)},use:function(e){s.setFBO({framebuffer:p},e)}})}function P(e){var o=Array(6);function a(e){var r;ne(o.indexOf(s.next)<0,"can not update framebuffer which is currently in use");var l,p={color:null},f=0,d=null,h="rgba",v="uint8",m=1;if("number"==typeof e)f=0|e;else if(e){ne.type(e,"object","invalid arguments for framebuffer");var b=e;if("shape"in b){var g=b.shape;ne(Array.isArray(g)&&g.length>=2,"invalid shape for framebuffer"),ne(g[0]===g[1],"cube framebuffer must be square"),f=g[0]}else"radius"in b&&(f=0|b.radius),"width"in b?(f=0|b.width,"height"in b&&ne(b.height===f,"must be square")):"height"in b&&(f=0|b.height);("color"in b||"colors"in b)&&(d=b.color||b.colors,Array.isArray(d)&&ne(1===d.length||n.webgl_draw_buffers,"multiple render targets not supported")),d||("colorCount"in b&&(m=0|b.colorCount,ne(m>0,"invalid color buffer count")),"colorType"in b&&(ne.oneOf(b.colorType,c,"invalid color type"),v=b.colorType),"colorFormat"in b&&(h=b.colorFormat,ne.oneOf(b.colorFormat,u,"invalid color format for texture"))),"depth"in b&&(p.depth=b.depth),"stencil"in b&&(p.stencil=b.stencil),"depthStencil"in b&&(p.depthStencil=b.depthStencil)}else f=1;if(d)if(Array.isArray(d))for(l=[],r=0;r<d.length;++r)l[r]=d[r];else l=[d];else{l=Array(m);var y={radius:f,format:h,type:v};for(r=0;r<m;++r)l[r]=i.createCube(y)}for(p.color=Array(l.length),r=0;r<l.length;++r){var w=l[r];ne("function"==typeof w&&"textureCube"===w._reglType,"invalid cube map"),f=f||w.width,ne(w.width===f&&w.height===f,"invalid cube map shape"),p.color[r]={target:di,data:l[r]}}for(r=0;r<6;++r){for(var _=0;_<l.length;++_)p.color[_].target=di+r;r>0&&(p.depth=o[0].depth,p.stencil=o[0].stencil,p.depthStencil=o[0].depthStencil),o[r]?o[r](p):o[r]=E(p)}return t(a,{width:f,height:f,color:l})}function l(e){var t,n=0|e;if(ne(n>0&&n<=r.maxCubeMapSize,"invalid radius for cube fbo"),n===a.width)return a;var i=a.color;for(t=0;t<i.length;++t)i[t].resize(n);for(t=0;t<6;++t)o[t].resize(n);return a.width=a.height=n,a}return a(e),t(a,{faces:o,resize:l,_reglType:"framebufferCube",destroy:function(){o.forEach((function(e){e.destroy()}))}})}function A(){s.cur=null,s.next=null,s.dirty=!0,kt(w).forEach((function(t){t.framebuffer=e.createFramebuffer(),k(t)}))}return t(s,{getFramebuffer:function(e){if("function"==typeof e&&"framebuffer"===e._reglType){var t=e._framebuffer;if(t instanceof _)return t}return null},create:E,createCube:P,clear:function(){kt(w).forEach(C)},restore:A})}Mi[gi]="complete",Mi[yi]="incomplete attachment",Mi[_i]="incomplete dimensions",Mi[wi]="incomplete, missing attachment",Mi[xi]="unsupported";var Ii=5126,Ri=34962,zi=34963,Ni=["attributes","elements","offset","count","primitive","instances"];function Ui(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=Ii,this.offset=0,this.stride=0,this.divisor=0}function Hi(t,n,r,i,o,a,s){for(var u=r.maxAttributes,l=new Array(u),c=0;c<u;++c)l[c]=new Ui;var p=0,f={},d={Record:Ui,scope:{},state:l,currentVAO:null,targetVAO:null,restore:v()?x:function(){},createVAO:C,getVAO:b,destroyBuffer:h,setVAO:v()?g:y,clear:v()?w:function(){}};function h(e){for(var n=0;n<l.length;++n){var r=l[n];r.buffer===e&&(t.disableVertexAttribArray(n),r.buffer=null)}}function v(){return n.oes_vertex_array_object}function m(){return n.angle_instanced_arrays}function b(e){return"function"==typeof e&&e._vao?e._vao:null}function g(e){if(e!==d.currentVAO){var t=v();e?t.bindVertexArrayOES(e.vao):t.bindVertexArrayOES(null),d.currentVAO=e}}function y(e){if(e!==d.currentVAO){if(e)e.bindAttrs();else{for(var n=m(),r=0;r<l.length;++r){var i=l[r];i.buffer?(t.enableVertexAttribArray(r),i.buffer.bind(),t.vertexAttribPointer(r,i.size,i.type,i.normalized,i.stride,i.offfset),n&&i.divisor&&n.vertexAttribDivisorANGLE(r,i.divisor)):(t.disableVertexAttribArray(r),t.vertexAttrib4f(r,i.x,i.y,i.z,i.w))}s.elements?t.bindBuffer(zi,s.elements.buffer.buffer):t.bindBuffer(zi,null)}d.currentVAO=e}}function w(){kt(f).forEach((function(e){e.destroy()}))}function _(){this.id=++p,this.attributes=[],this.elements=null,this.ownsElements=!1,this.count=0,this.offset=0,this.instances=-1,this.primitive=4;var e=v();this.vao=e?e.createVertexArrayOES():null,f[this.id]=this,this.buffers=[]}function x(){v()&&kt(f).forEach((function(e){e.refresh()}))}function C(t){var r=new _;function s(t){var i;if(Array.isArray(t))i=t,r.elements&&r.ownsElements&&r.elements.destroy(),r.elements=null,r.ownsElements=!1,r.offset=0,r.count=0,r.instances=-1,r.primitive=4;else{if(ne("object"==typeof t,"invalid arguments for create vao"),ne("attributes"in t,"must specify attributes for vao"),t.elements){var l=t.elements;r.ownsElements?"function"==typeof l&&"elements"===l._reglType?(r.elements.destroy(),r.ownsElements=!1):(r.elements(l),r.ownsElements=!1):a.getElements(t.elements)?(r.elements=t.elements,r.ownsElements=!1):(r.elements=a.create(t.elements),r.ownsElements=!0)}else r.elements=null,r.ownsElements=!1;i=t.attributes,r.offset=0,r.count=-1,r.instances=-1,r.primitive=4,r.elements&&(r.count=r.elements._elements.vertCount,r.primitive=r.elements._elements.primType),"offset"in t&&(r.offset=0|t.offset),"count"in t&&(r.count=0|t.count),"instances"in t&&(r.instances=0|t.instances),"primitive"in t&&(ne(t.primitive in qt,"bad primitive type: "+t.primitive),r.primitive=qt[t.primitive]),ne.optional((()=>{for(var e=Object.keys(t),n=0;n<e.length;++n)ne(Ni.indexOf(e[n])>=0,'invalid option for vao: "'+e[n]+'" valid options are '+Ni)})),ne(Array.isArray(i),"attributes must be an array")}ne(i.length<u,"too many attributes"),ne(i.length>0,"must specify at least one attribute");var c={},p=r.attributes;p.length=i.length;for(var f=0;f<i.length;++f){var d,h=i[f],v=p[f]=new Ui,m=h.data||h;Array.isArray(m)||e(m)||Ct(m)?(r.buffers[f]&&(d=r.buffers[f],e(m)&&d._buffer.byteLength>=m.byteLength?d.subdata(m):(d.destroy(),r.buffers[f]=null)),r.buffers[f]||(d=r.buffers[f]=o.create(h,Ri,!1,!0)),v.buffer=o.getBuffer(d),v.size=0|v.buffer.dimension,v.normalized=!1,v.type=v.buffer.dtype,v.offset=0,v.stride=0,v.divisor=0,v.state=1,c[f]=1):o.getBuffer(h)?(v.buffer=o.getBuffer(h),v.size=0|v.buffer.dimension,v.normalized=!1,v.type=v.buffer.dtype,v.offset=0,v.stride=0,v.divisor=0,v.state=1):o.getBuffer(h.buffer)?(v.buffer=o.getBuffer(h.buffer),v.size=0|(+h.size||v.buffer.dimension),v.normalized=!!h.normalized||!1,"type"in h?(ne.parameter(h.type,Lt,"invalid buffer type"),v.type=Lt[h.type]):v.type=v.buffer.dtype,v.offset=0|(h.offset||0),v.stride=0|(h.stride||0),v.divisor=0|(h.divisor||0),v.state=1,ne(v.size>=1&&v.size<=4,"size must be between 1 and 4"),ne(v.offset>=0,"invalid offset"),ne(v.stride>=0&&v.stride<=255,"stride must be between 0 and 255"),ne(v.divisor>=0,"divisor must be positive"),ne(!v.divisor||!!n.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in h?(ne(f>0,"first attribute must not be a constant"),v.x=+h.x||0,v.y=+h.y||0,v.z=+h.z||0,v.w=+h.w||0,v.state=2):ne(!1,"invalid attribute spec for location "+f)}for(var b=0;b<r.buffers.length;++b)!c[b]&&r.buffers[b]&&(r.buffers[b].destroy(),r.buffers[b]=null);return r.refresh(),s}return i.vaoCount+=1,s.destroy=function(){for(var e=0;e<r.buffers.length;++e)r.buffers[e]&&r.buffers[e].destroy();r.buffers.length=0,r.ownsElements&&(r.elements.destroy(),r.elements=null,r.ownsElements=!1),r.destroy()},s._vao=r,s._reglType="vao",s(t)}return _.prototype.bindAttrs=function(){for(var e=m(),n=this.attributes,r=0;r<n.length;++r){var i=n[r];i.buffer?(t.enableVertexAttribArray(r),t.bindBuffer(Ri,i.buffer.buffer),t.vertexAttribPointer(r,i.size,i.type,i.normalized,i.stride,i.offset),e&&i.divisor&&e.vertexAttribDivisorANGLE(r,i.divisor)):(t.disableVertexAttribArray(r),t.vertexAttrib4f(r,i.x,i.y,i.z,i.w))}for(var o=n.length;o<u;++o)t.disableVertexAttribArray(o);var s=a.getElements(this.elements);s?t.bindBuffer(zi,s.buffer.buffer):t.bindBuffer(zi,null)},_.prototype.refresh=function(){var e=v();e&&(e.bindVertexArrayOES(this.vao),this.bindAttrs(),d.currentVAO=null,e.bindVertexArrayOES(null))},_.prototype.destroy=function(){if(this.vao){var e=v();this===d.currentVAO&&(d.currentVAO=null,e.bindVertexArrayOES(null)),e.deleteVertexArrayOES(this.vao),this.vao=null}this.ownsElements&&(this.elements.destroy(),this.elements=null,this.ownsElements=!1),f[this.id]&&(delete f[this.id],i.vaoCount-=1)},d}var Ki=35632,Gi=35633,qi=35718,Wi=35721;function Yi(e,n,r,i){var o={},a={};function s(e,t,n,r){this.name=e,this.id=t,this.location=n,this.info=r}function u(e,t){for(var n=0;n<e.length;++n)if(e[n].id===t.id)return void(e[n].location=t.location);e.push(t)}function l(t,r,i){var s=t===Ki?o:a,u=s[r];if(!u){var l=n.str(r);u=e.createShader(t),e.shaderSource(u,l),e.compileShader(u),ne.shaderError(e,u,l,t,i),s[r]=u}return u}var c={},p=[],f=0;function d(e,t){this.id=f++,this.fragId=e,this.vertId=t,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,i.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function h(t,r,o){var a,c,p=l(Ki,t.fragId),f=l(Gi,t.vertId),d=t.program=e.createProgram();if(e.attachShader(d,p),e.attachShader(d,f),o)for(a=0;a<o.length;++a){var h=o[a];e.bindAttribLocation(d,h[0],h[1])}e.linkProgram(d),ne.linkError(e,d,n.str(t.fragId),n.str(t.vertId),r);var v=e.getProgramParameter(d,qi);i.profile&&(t.stats.uniformsCount=v);var m=t.uniforms;for(a=0;a<v;++a)if(c=e.getActiveUniform(d,a)){if(c.size>1)for(var b=0;b<c.size;++b){var g=c.name.replace("[0]","["+b+"]");u(m,new s(g,n.id(g),e.getUniformLocation(d,g),c))}var y=c.name;c.size>1&&(y=y.replace("[0]","")),u(m,new s(y,n.id(y),e.getUniformLocation(d,y),c))}var w=e.getProgramParameter(d,Wi);i.profile&&(t.stats.attributesCount=w);var _=t.attributes;for(a=0;a<w;++a)(c=e.getActiveAttrib(d,a))&&u(_,new s(c.name,n.id(c.name),e.getAttribLocation(d,c.name),c))}function v(){o={},a={};for(var e=0;e<p.length;++e)h(p[e],null,p[e].attributes.map((function(e){return[e.location,e.name]})))}return i.profile&&(r.getMaxUniformsCount=function(){var e=0;return p.forEach((function(t){t.stats.uniformsCount>e&&(e=t.stats.uniformsCount)})),e},r.getMaxAttributesCount=function(){var e=0;return p.forEach((function(t){t.stats.attributesCount>e&&(e=t.stats.attributesCount)})),e}),{clear:function(){var t=e.deleteShader.bind(e);kt(o).forEach(t),o={},kt(a).forEach(t),a={},p.forEach((function(t){e.deleteProgram(t.program)})),p.length=0,c={},r.shaderCount=0},program:function(n,i,s,u){ne.command(n>=0,"missing vertex shader",s),ne.command(i>=0,"missing fragment shader",s);var l=c[i];l||(l=c[i]={});var f=l[n];if(f&&(f.refCount++,!u))return f;var v=new d(i,n);return r.shaderCount++,h(v,s,u),f||(l[n]=v),p.push(v),t(v,{destroy:function(){if(v.refCount--,v.refCount<=0){e.deleteProgram(v.program);var t=p.indexOf(v);p.splice(t,1),r.shaderCount--}l[v.vertId].refCount<=0&&(e.deleteShader(a[v.vertId]),delete a[v.vertId],delete c[v.fragId][v.vertId]),Object.keys(c[v.fragId]).length||(e.deleteShader(o[v.fragId]),delete o[v.fragId],delete c[v.fragId])}})},restore:v,shader:l,frag:-1,vert:-1}}var Qi=6408,$i=5121,Xi=3333,Ji=5126;function Zi(t,n,r,i,o,a,s){function u(u){var l;null===n.next?(ne(o.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),l=$i):(ne(null!==n.next.colorAttachments[0].texture,"You cannot read from a renderbuffer"),l=n.next.colorAttachments[0].texture._texture.type,ne.optional((function(){a.oes_texture_float?(ne(l===$i||l===Ji,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),l===Ji&&ne(s.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):ne(l===$i,"Reading from a framebuffer is only allowed for the type 'uint8'")})));var c=0,p=0,f=i.framebufferWidth,d=i.framebufferHeight,h=null;e(u)?h=u:u&&(ne.type(u,"object","invalid arguments to regl.read()"),c=0|u.x,p=0|u.y,ne(c>=0&&c<i.framebufferWidth,"invalid x offset for regl.read"),ne(p>=0&&p<i.framebufferHeight,"invalid y offset for regl.read"),f=0|(u.width||i.framebufferWidth-c),d=0|(u.height||i.framebufferHeight-p),h=u.data||null),h&&(l===$i?ne(h instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):l===Ji&&ne(h instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),ne(f>0&&f+c<=i.framebufferWidth,"invalid width for read pixels"),ne(d>0&&d+p<=i.framebufferHeight,"invalid height for read pixels"),r();var v=f*d*4;return h||(l===$i?h=new Uint8Array(v):l===Ji&&(h=h||new Float32Array(v))),ne.isTypedArray(h,"data buffer for regl.read() must be a typedarray"),ne(h.byteLength>=v,"data buffer for regl.read() too small"),t.pixelStorei(Xi,4),t.readPixels(c,p,f,d,Qi,l,h),h}function l(e){var t;return n.setFBO({framebuffer:e.framebuffer},(function(){t=u(e)})),t}function c(e){return e&&"framebuffer"in e?l(e):u(e)}return c}function eo(e){return Array.prototype.slice.call(e)}function to(e){return eo(e).join("")}function no(){var e=0,n=[],r=[];function i(t){for(var i=0;i<r.length;++i)if(r[i]===t)return n[i];var o="g"+e++;return n.push(o),r.push(t),o}function o(){var n=[];function r(){n.push.apply(n,eo(arguments))}var i=[];function o(){var t="v"+e++;return i.push(t),arguments.length>0&&(n.push(t,"="),n.push.apply(n,eo(arguments)),n.push(";")),t}return t(r,{def:o,toString:function(){return to([i.length>0?"var "+i.join(",")+";":"",to(n)])}})}function a(){var e=o(),n=o(),r=e.toString,i=n.toString;function a(t,r){n(t,r,"=",e.def(t,r),";")}return t((function(){e.apply(e,eo(arguments))}),{def:e.def,entry:e,exit:n,save:a,set:function(t,n,r){a(t,n),e(t,n,"=",r,";")},toString:function(){return r()+i()}})}function s(){var e=to(arguments),n=a(),r=a(),i=n.toString,o=r.toString;return t(n,{then:function(){return n.apply(n,eo(arguments)),this},else:function(){return r.apply(r,eo(arguments)),this},toString:function(){var t=o();return t&&(t="else{"+t+"}"),to(["if(",e,"){",i(),"}",t])}})}var u=o(),l={};function c(e,n){var r=[];function i(){var e="a"+r.length;return r.push(e),e}n=n||0;for(var o=0;o<n;++o)i();var s=a(),u=s.toString;return l[e]=t(s,{arg:i,toString:function(){return to(["function(",r.join(),"){",u(),"}"])}})}function p(){var e=['"use strict";',u,"return {"];Object.keys(l).forEach((function(t){e.push('"',t,'":',l[t].toString(),",")})),e.push("}");var t=to(e).replace(/;/g,";\n").replace(/}/g,"}\n").replace(/{/g,"{\n");return Function.apply(null,n.concat(t)).apply(null,r)}return{global:u,link:i,block:o,proc:c,scope:a,cond:s,compile:p}}var ro="xyzw".split(""),io=5121,oo=1,ao=2,so=0,uo=1,lo=2,co=3,po=4,fo=5,ho=6,vo="dither",mo="blend.enable",bo="blend.color",go="blend.equation",yo="blend.func",wo="depth.enable",_o="depth.func",xo="depth.range",Co="depth.mask",ko="colorMask",Eo="cull.enable",Po="cull.face",Ao="frontFace",Vo="lineWidth",So="polygonOffset.enable",Oo="polygonOffset.offset",Do="sample.alpha",jo="sample.enable",Lo="sample.coverage",To="stencil.enable",Fo="stencil.mask",Mo="stencil.func",Bo="stencil.opFront",Io="stencil.opBack",Ro="scissor.enable",zo="scissor.box",No="viewport",Uo="profile",Ho="framebuffer",Ko="vert",Go="frag",qo="elements",Wo="primitive",Yo="count",Qo="offset",$o="instances",Xo="vao",Jo="Width",Zo="Height",ea=Ho+Jo,ta=Ho+Zo,na=No+Jo,ra=No+Zo,ia="drawingBuffer",oa=ia+Jo,aa=ia+Zo,sa=[yo,go,Mo,Bo,Io,Lo,No,zo,Oo],ua=34962,la=34963,ca=3553,pa=34067,fa=2884,da=3042,ha=3024,va=2960,ma=2929,ba=3089,ga=32823,ya=32926,wa=32928,_a=5126,xa=35664,Ca=35665,ka=35666,Ea=5124,Pa=35667,Aa=35668,Va=35669,Sa=35670,Oa=35671,Da=35672,ja=35673,La=35674,Ta=35675,Fa=35676,Ma=35678,Ba=35680,Ia=4,Ra=1028,za=1029,Na=2304,Ua=2305,Ha=32775,Ka=32776,Ga=519,qa=7680,Wa=0,Ya=1,Qa=32774,$a=513,Xa=36160,Ja=36064,Za={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},es=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],ts={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},ns={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},rs={frag:35632,vert:35633},is={cw:Na,ccw:Ua};function os(t){return Array.isArray(t)||e(t)||Ct(t)}function as(e){return e.sort((function(e,t){return e===No?-1:t===No?1:e<t?-1:1}))}function ss(e,t,n,r){this.thisDep=e,this.contextDep=t,this.propDep=n,this.append=r}function us(e){return e&&!(e.thisDep||e.contextDep||e.propDep)}function ls(e){return new ss(!1,!1,!1,e)}function cs(e,t){var n=e.type;if(n===so){var r=e.data.length;return new ss(!0,r>=1,r>=2,t)}if(n===po){var i=e.data;return new ss(i.thisDep,i.contextDep,i.propDep,t)}if(n===fo)return new ss(!1,!1,!1,t);if(n===ho){for(var o=!1,a=!1,s=!1,u=0;u<e.data.length;++u){var l=e.data[u];if(l.type===uo)s=!0;else if(l.type===lo)a=!0;else if(l.type===co)o=!0;else if(l.type===so){o=!0;var c=l.data;c>=1&&(a=!0),c>=2&&(s=!0)}else l.type===po&&(o=o||l.data.thisDep,a=a||l.data.contextDep,s=s||l.data.propDep)}return new ss(o,a,s,t)}return new ss(n===co,n===lo,n===uo,t)}var ps=new ss(!1,!1,!1,(function(){}));function fs(e,n,r,i,o,a,s,u,l,c,p,f,d,h,v){var m=c.Record,b={add:32774,subtract:32778,"reverse subtract":32779};r.ext_blend_minmax&&(b.min=Ha,b.max=Ka);var g=r.angle_instanced_arrays,y=r.webgl_draw_buffers,w=r.oes_vertex_array_object,_={dirty:!0,profile:v.profile},x={},C=[],k={},E={};function P(e){return e.replace(".","_")}function A(e,t,n){var r=P(e);C.push(e),x[r]=_[r]=!!n,k[r]=t}function V(e,t,n){var r=P(e);C.push(e),Array.isArray(n)?(_[r]=n.slice(),x[r]=n.slice()):_[r]=x[r]=n,E[r]=t}A(vo,ha),A(mo,da),V(bo,"blendColor",[0,0,0,0]),V(go,"blendEquationSeparate",[Qa,Qa]),V(yo,"blendFuncSeparate",[Ya,Wa,Ya,Wa]),A(wo,ma,!0),V(_o,"depthFunc",$a),V(xo,"depthRange",[0,1]),V(Co,"depthMask",!0),V(ko,ko,[!0,!0,!0,!0]),A(Eo,fa),V(Po,"cullFace",za),V(Ao,Ao,Ua),V(Vo,Vo,1),A(So,ga),V(Oo,"polygonOffset",[0,0]),A(Do,ya),A(jo,wa),V(Lo,"sampleCoverage",[1,!1]),A(To,va),V(Fo,"stencilMask",-1),V(Mo,"stencilFunc",[Ga,0,-1]),V(Bo,"stencilOpSeparate",[Ra,qa,qa,qa]),V(Io,"stencilOpSeparate",[za,qa,qa,qa]),A(Ro,ba),V(zo,"scissor",[0,0,e.drawingBufferWidth,e.drawingBufferHeight]),V(No,No,[0,0,e.drawingBufferWidth,e.drawingBufferHeight]);var S={gl:e,context:d,strings:n,next:x,current:_,draw:f,elements:a,buffer:o,shader:p,attributes:c.state,vao:c,uniforms:l,framebuffer:u,extensions:r,timer:h,isBufferArgs:os},O={primTypes:qt,compareFuncs:ts,blendFuncs:Za,blendEquations:b,stencilOps:ns,glTypes:Lt,orientationType:is};ne.optional((function(){S.isArrayLike=pn})),y&&(O.backBuffer=[za],O.drawBuffer=Pe(i.maxDrawbuffers,(function(e){return 0===e?[0]:Pe(e,(function(e){return Ja+e}))})));var D=0;function j(){var e=no(),t=e.link,r=e.global;e.id=D++,e.batchId="0";var i=t(S),o=e.shared={props:"a0"};Object.keys(S).forEach((function(e){o[e]=r.def(i,".",e)})),ne.optional((function(){e.CHECK=t(ne),e.commandStr=ne.guessCommand(),e.command=t(e.commandStr),e.assert=function(e,n,r){e("if(!(",n,"))",this.CHECK,".commandRaise(",t(r),",",this.command,");")},O.invalidBlendCombinations=es}));var a=e.next={},s=e.current={};Object.keys(E).forEach((function(e){Array.isArray(_[e])&&(a[e]=r.def(o.next,".",e),s[e]=r.def(o.current,".",e))}));var u=e.constants={};Object.keys(O).forEach((function(e){u[e]=r.def(JSON.stringify(O[e]))})),e.invoke=function(n,r){switch(r.type){case so:var i=["this",o.context,o.props,e.batchId];return n.def(t(r.data),".call(",i.slice(0,Math.max(r.data.length+1,4)),")");case uo:return n.def(o.props,r.data);case lo:return n.def(o.context,r.data);case co:return n.def("this",r.data);case po:return r.data.append(e,n),r.data.ref;case fo:return r.data.toString();case ho:return r.data.map((function(t){return e.invoke(n,t)}))}},e.attribCache={};var l={};return e.scopeAttrib=function(e){var r=n.id(e);if(r in l)return l[r];var i=c.scope[r];return i||(i=c.scope[r]=new m),l[r]=t(i)},e}function L(e){var t,n=e.static,r=e.dynamic;if(Uo in n){var i=!!n[Uo];(t=ls((function(e,t){return i}))).enable=i}else if(Uo in r){var o=r[Uo];t=cs(o,(function(e,t){return e.invoke(t,o)}))}return t}function T(e,t){var n=e.static,r=e.dynamic;if(Ho in n){var i=n[Ho];return i?(i=u.getFramebuffer(i),ne.command(i,"invalid framebuffer object"),ls((function(e,t){var n=e.link(i),r=e.shared;t.set(r.framebuffer,".next",n);var o=r.context;return t.set(o,"."+ea,n+".width"),t.set(o,"."+ta,n+".height"),n}))):ls((function(e,t){var n=e.shared;t.set(n.framebuffer,".next","null");var r=n.context;return t.set(r,"."+ea,r+"."+oa),t.set(r,"."+ta,r+"."+aa),"null"}))}if(Ho in r){var o=r[Ho];return cs(o,(function(e,t){var n=e.invoke(t,o),r=e.shared,i=r.framebuffer,a=t.def(i,".getFramebuffer(",n,")");ne.optional((function(){e.assert(t,"!"+n+"||"+a,"invalid framebuffer object")})),t.set(i,".next",a);var s=r.context;return t.set(s,"."+ea,a+"?"+a+".width:"+s+"."+oa),t.set(s,"."+ta,a+"?"+a+".height:"+s+"."+aa),a}))}return null}function F(e,t,n){var r=e.static,i=e.dynamic;function o(e){if(e in r){var o=r[e];ne.commandType(o,"object","invalid "+e,n.commandStr);var a,s,u=!0,l=0|o.x,c=0|o.y;return"width"in o?(a=0|o.width,ne.command(a>=0,"invalid "+e,n.commandStr)):u=!1,"height"in o?(s=0|o.height,ne.command(s>=0,"invalid "+e,n.commandStr)):u=!1,new ss(!u&&t&&t.thisDep,!u&&t&&t.contextDep,!u&&t&&t.propDep,(function(e,t){var n=e.shared.context,r=a;"width"in o||(r=t.def(n,".",ea,"-",l));var i=s;return"height"in o||(i=t.def(n,".",ta,"-",c)),[l,c,r,i]}))}if(e in i){var p=i[e],f=cs(p,(function(t,n){var r=t.invoke(n,p);ne.optional((function(){t.assert(n,r+"&&typeof "+r+'==="object"',"invalid "+e)}));var i=t.shared.context,o=n.def(r,".x|0"),a=n.def(r,".y|0"),s=n.def('"width" in ',r,"?",r,".width|0:","(",i,".",ea,"-",o,")"),u=n.def('"height" in ',r,"?",r,".height|0:","(",i,".",ta,"-",a,")");return ne.optional((function(){t.assert(n,s+">=0&&"+u+">=0","invalid "+e)})),[o,a,s,u]}));return t&&(f.thisDep=f.thisDep||t.thisDep,f.contextDep=f.contextDep||t.contextDep,f.propDep=f.propDep||t.propDep),f}return t?new ss(t.thisDep,t.contextDep,t.propDep,(function(e,t){var n=e.shared.context;return[0,0,t.def(n,".",ea),t.def(n,".",ta)]})):null}var a=o(No);if(a){var s=a;a=new ss(a.thisDep,a.contextDep,a.propDep,(function(e,t){var n=s.append(e,t),r=e.shared.context;return t.set(r,"."+na,n[2]),t.set(r,"."+ra,n[3]),n}))}return{viewport:a,scissor_box:o(zo)}}function M(e,t){var n=e.static;if("string"==typeof n[Go]&&"string"==typeof n[Ko]){if(Object.keys(t.dynamic).length>0)return null;var r=t.static,i=Object.keys(r);if(i.length>0&&"number"==typeof r[i[0]]){for(var o=[],a=0;a<i.length;++a)ne("number"==typeof r[i[a]],"must specify all vertex attribute locations when using vaos"),o.push([0|r[i[a]],i[a]]);return o}}return null}function B(e,t,r){var i=e.static,o=e.dynamic;function a(e){if(e in i){var t=n.id(i[e]);ne.optional((function(){p.shader(rs[e],t,ne.guessCommand())}));var r=ls((function(){return t}));return r.id=t,r}if(e in o){var a=o[e];return cs(a,(function(t,n){var r=t.invoke(n,a),i=n.def(t.shared.strings,".id(",r,")");return ne.optional((function(){n(t.shared.shader,".shader(",rs[e],",",i,",",t.command,");")})),i}))}return null}var s,u=a(Go),l=a(Ko),c=null;return us(u)&&us(l)?(c=p.program(l.id,u.id,null,r),s=ls((function(e,t){return e.link(c)}))):s=new ss(u&&u.thisDep||l&&l.thisDep,u&&u.contextDep||l&&l.contextDep,u&&u.propDep||l&&l.propDep,(function(e,t){var n,r=e.shared.shader;n=u?u.append(e,t):t.def(r,".",Go);var i=r+".program("+(l?l.append(e,t):t.def(r,".",Ko))+","+n;return ne.optional((function(){i+=","+e.command})),t.def(i+")")})),{frag:u,vert:l,progVar:s,program:c}}function I(e,t){var n=e.static,r=e.dynamic,i={},o=!1;function s(){if(Xo in n){var e=n[Xo];return null!==e&&null===c.getVAO(e)&&(e=c.createVAO(e)),o=!0,i.vao=e,ls((function(t){var n=c.getVAO(e);return n?t.link(n):"null"}))}if(Xo in r){o=!0;var t=r[Xo];return cs(t,(function(e,n){var r=e.invoke(n,t);return n.def(e.shared.vao+".getVAO("+r+")")}))}return null}var u=s(),l=!1;function p(){if(qo in n){var e=n[qo];if(i.elements=e,os(e)){var s=i.elements=a.create(e,!0);e=a.getElements(s),l=!0}else e&&(e=a.getElements(e),l=!0,ne.command(e,"invalid elements",t.commandStr));var c=ls((function(t,n){if(e){var r=t.link(e);return t.ELEMENTS=r,r}return t.ELEMENTS=null,null}));return c.value=e,c}if(qo in r){l=!0;var p=r[qo];return cs(p,(function(e,t){var n=e.shared,r=n.isBufferArgs,i=n.elements,o=e.invoke(t,p),a=t.def("null"),s=t.def(r,"(",o,")"),u=e.cond(s).then(a,"=",i,".createStream(",o,");").else(a,"=",i,".getElements(",o,");");return ne.optional((function(){e.assert(u.else,"!"+o+"||"+a,"invalid elements")})),t.entry(u),t.exit(e.cond(s).then(i,".destroyStream(",a,");")),e.ELEMENTS=a,a}))}return o?new ss(u.thisDep,u.contextDep,u.propDep,(function(e,t){return t.def(e.shared.vao+".currentVAO?"+e.shared.elements+".getElements("+e.shared.vao+".currentVAO.elements):null")})):null}var f=p();function d(){if(Wo in n){var e=n[Wo];return i.primitive=e,ne.commandParameter(e,qt,"invalid primitve",t.commandStr),ls((function(t,n){return qt[e]}))}if(Wo in r){var a=r[Wo];return cs(a,(function(e,t){var n=e.constants.primTypes,r=e.invoke(t,a);return ne.optional((function(){e.assert(t,r+" in "+n,"invalid primitive, must be one of "+Object.keys(qt))})),t.def(n,"[",r,"]")}))}return l?us(f)?f.value?ls((function(e,t){return t.def(e.ELEMENTS,".primType")})):ls((function(){return Ia})):new ss(f.thisDep,f.contextDep,f.propDep,(function(e,t){var n=e.ELEMENTS;return t.def(n,"?",n,".primType:",Ia)})):o?new ss(u.thisDep,u.contextDep,u.propDep,(function(e,t){return t.def(e.shared.vao+".currentVAO?"+e.shared.vao+".currentVAO.primitive:"+Ia)})):null}function h(e,a){if(e in n){var s=0|n[e];return a?i.offset=s:i.instances=s,ne.command(!a||s>=0,"invalid "+e,t.commandStr),ls((function(e,t){return a&&(e.OFFSET=s),s}))}if(e in r){var c=r[e];return cs(c,(function(t,n){var r=t.invoke(n,c);return a&&(t.OFFSET=r,ne.optional((function(){t.assert(n,r+">=0","invalid "+e)}))),r}))}if(a){if(l)return ls((function(e,t){return e.OFFSET=0,0}));if(o)return new ss(u.thisDep,u.contextDep,u.propDep,(function(e,t){return t.def(e.shared.vao+".currentVAO?"+e.shared.vao+".currentVAO.offset:0")}))}else if(o)return new ss(u.thisDep,u.contextDep,u.propDep,(function(e,t){return t.def(e.shared.vao+".currentVAO?"+e.shared.vao+".currentVAO.instances:-1")}));return null}var v=h(Qo,!0);function m(){if(Yo in n){var e=0|n[Yo];return i.count=e,ne.command("number"==typeof e&&e>=0,"invalid vertex count",t.commandStr),ls((function(){return e}))}if(Yo in r){var a=r[Yo];return cs(a,(function(e,t){var n=e.invoke(t,a);return ne.optional((function(){e.assert(t,"typeof "+n+'==="number"&&'+n+">=0&&"+n+"===("+n+"|0)","invalid vertex count")})),n}))}if(l){if(us(f)){if(f)return v?new ss(v.thisDep,v.contextDep,v.propDep,(function(e,t){var n=t.def(e.ELEMENTS,".vertCount-",e.OFFSET);return ne.optional((function(){e.assert(t,n+">=0","invalid vertex offset/element buffer too small")})),n})):ls((function(e,t){return t.def(e.ELEMENTS,".vertCount")}));var s=ls((function(){return-1}));return ne.optional((function(){s.MISSING=!0})),s}var c=new ss(f.thisDep||v.thisDep,f.contextDep||v.contextDep,f.propDep||v.propDep,(function(e,t){var n=e.ELEMENTS;return e.OFFSET?t.def(n,"?",n,".vertCount-",e.OFFSET,":-1"):t.def(n,"?",n,".vertCount:-1")}));return ne.optional((function(){c.DYNAMIC=!0})),c}return o?new ss(u.thisDep,u.contextDep,u.propDep,(function(e,t){return t.def(e.shared.vao,".currentVAO?",e.shared.vao,".currentVAO.count:-1")})):null}var b=d(),g=m(),y=h($o,!1);return{elements:f,primitive:b,count:g,instances:y,offset:v,vao:u,vaoActive:o,elementsActive:l,static:i}}function R(e,t){var n=e.static,r=e.dynamic,o={};return C.forEach((function(e){var a=P(e);function s(t,i){if(e in n){var s=t(n[e]);o[a]=ls((function(){return s}))}else if(e in r){var u=r[e];o[a]=cs(u,(function(e,t){return i(e,t,e.invoke(t,u))}))}}switch(e){case Eo:case mo:case vo:case To:case wo:case Ro:case So:case Do:case jo:case Co:return s((function(n){return ne.commandType(n,"boolean",e,t.commandStr),n}),(function(t,n,r){return ne.optional((function(){t.assert(n,"typeof "+r+'==="boolean"',"invalid flag "+e,t.commandStr)})),r}));case _o:return s((function(n){return ne.commandParameter(n,ts,"invalid "+e,t.commandStr),ts[n]}),(function(t,n,r){var i=t.constants.compareFuncs;return ne.optional((function(){t.assert(n,r+" in "+i,"invalid "+e+", must be one of "+Object.keys(ts))})),n.def(i,"[",r,"]")}));case xo:return s((function(e){return ne.command(pn(e)&&2===e.length&&"number"==typeof e[0]&&"number"==typeof e[1]&&e[0]<=e[1],"depth range is 2d array",t.commandStr),e}),(function(e,t,n){return ne.optional((function(){e.assert(t,e.shared.isArrayLike+"("+n+")&&"+n+".length===2&&typeof "+n+'[0]==="number"&&typeof '+n+'[1]==="number"&&'+n+"[0]<="+n+"[1]","depth range must be a 2d array")})),[t.def("+",n,"[0]"),t.def("+",n,"[1]")]}));case yo:return s((function(e){ne.commandType(e,"object","blend.func",t.commandStr);var n="srcRGB"in e?e.srcRGB:e.src,r="srcAlpha"in e?e.srcAlpha:e.src,i="dstRGB"in e?e.dstRGB:e.dst,o="dstAlpha"in e?e.dstAlpha:e.dst;return ne.commandParameter(n,Za,a+".srcRGB",t.commandStr),ne.commandParameter(r,Za,a+".srcAlpha",t.commandStr),ne.commandParameter(i,Za,a+".dstRGB",t.commandStr),ne.commandParameter(o,Za,a+".dstAlpha",t.commandStr),ne.command(-1===es.indexOf(n+", "+i),"unallowed blending combination (srcRGB, dstRGB) = ("+n+", "+i+")",t.commandStr),[Za[n],Za[i],Za[r],Za[o]]}),(function(t,n,r){var i=t.constants.blendFuncs;function o(o,a){var s=n.def('"',o,a,'" in ',r,"?",r,".",o,a,":",r,".",o);return ne.optional((function(){t.assert(n,s+" in "+i,"invalid "+e+"."+o+a+", must be one of "+Object.keys(Za))})),s}ne.optional((function(){t.assert(n,r+"&&typeof "+r+'==="object"',"invalid blend func, must be an object")}));var a=o("src","RGB"),s=o("dst","RGB");ne.optional((function(){var e=t.constants.invalidBlendCombinations;t.assert(n,e+".indexOf("+a+'+", "+'+s+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")}));var u=n.def(i,"[",a,"]"),l=n.def(i,"[",o("src","Alpha"),"]");return[u,n.def(i,"[",s,"]"),l,n.def(i,"[",o("dst","Alpha"),"]")]}));case go:return s((function(n){return"string"==typeof n?(ne.commandParameter(n,b,"invalid "+e,t.commandStr),[b[n],b[n]]):"object"==typeof n?(ne.commandParameter(n.rgb,b,e+".rgb",t.commandStr),ne.commandParameter(n.alpha,b,e+".alpha",t.commandStr),[b[n.rgb],b[n.alpha]]):void ne.commandRaise("invalid blend.equation",t.commandStr)}),(function(t,n,r){var i=t.constants.blendEquations,o=n.def(),a=n.def(),s=t.cond("typeof ",r,'==="string"');return ne.optional((function(){function n(e,n,r){t.assert(e,r+" in "+i,"invalid "+n+", must be one of "+Object.keys(b))}n(s.then,e,r),t.assert(s.else,r+"&&typeof "+r+'==="object"',"invalid "+e),n(s.else,e+".rgb",r+".rgb"),n(s.else,e+".alpha",r+".alpha")})),s.then(o,"=",a,"=",i,"[",r,"];"),s.else(o,"=",i,"[",r,".rgb];",a,"=",i,"[",r,".alpha];"),n(s),[o,a]}));case bo:return s((function(e){return ne.command(pn(e)&&4===e.length,"blend.color must be a 4d array",t.commandStr),Pe(4,(function(t){return+e[t]}))}),(function(e,t,n){return ne.optional((function(){e.assert(t,e.shared.isArrayLike+"("+n+")&&"+n+".length===4","blend.color must be a 4d array")})),Pe(4,(function(e){return t.def("+",n,"[",e,"]")}))}));case Fo:return s((function(e){return ne.commandType(e,"number",a,t.commandStr),0|e}),(function(e,t,n){return ne.optional((function(){e.assert(t,"typeof "+n+'==="number"',"invalid stencil.mask")})),t.def(n,"|0")}));case Mo:return s((function(n){ne.commandType(n,"object",a,t.commandStr);var r=n.cmp||"keep",i=n.ref||0,o="mask"in n?n.mask:-1;return ne.commandParameter(r,ts,e+".cmp",t.commandStr),ne.commandType(i,"number",e+".ref",t.commandStr),ne.commandType(o,"number",e+".mask",t.commandStr),[ts[r],i,o]}),(function(e,t,n){var r=e.constants.compareFuncs;return ne.optional((function(){function i(){e.assert(t,Array.prototype.join.call(arguments,""),"invalid stencil.func")}i(n+"&&typeof ",n,'==="object"'),i('!("cmp" in ',n,")||(",n,".cmp in ",r,")")})),[t.def('"cmp" in ',n,"?",r,"[",n,".cmp]",":",qa),t.def(n,".ref|0"),t.def('"mask" in ',n,"?",n,".mask|0:-1")]}));case Bo:case Io:return s((function(n){ne.commandType(n,"object",a,t.commandStr);var r=n.fail||"keep",i=n.zfail||"keep",o=n.zpass||"keep";return ne.commandParameter(r,ns,e+".fail",t.commandStr),ne.commandParameter(i,ns,e+".zfail",t.commandStr),ne.commandParameter(o,ns,e+".zpass",t.commandStr),[e===Io?za:Ra,ns[r],ns[i],ns[o]]}),(function(t,n,r){var i=t.constants.stencilOps;function o(o){return ne.optional((function(){t.assert(n,'!("'+o+'" in '+r+")||("+r+"."+o+" in "+i+")","invalid "+e+"."+o+", must be one of "+Object.keys(ns))})),n.def('"',o,'" in ',r,"?",i,"[",r,".",o,"]:",qa)}return ne.optional((function(){t.assert(n,r+"&&typeof "+r+'==="object"',"invalid "+e)})),[e===Io?za:Ra,o("fail"),o("zfail"),o("zpass")]}));case Oo:return s((function(e){ne.commandType(e,"object",a,t.commandStr);var n=0|e.factor,r=0|e.units;return ne.commandType(n,"number",a+".factor",t.commandStr),ne.commandType(r,"number",a+".units",t.commandStr),[n,r]}),(function(t,n,r){return ne.optional((function(){t.assert(n,r+"&&typeof "+r+'==="object"',"invalid "+e)})),[n.def(r,".factor|0"),n.def(r,".units|0")]}));case Po:return s((function(e){var n=0;return"front"===e?n=Ra:"back"===e&&(n=za),ne.command(!!n,a,t.commandStr),n}),(function(e,t,n){return ne.optional((function(){e.assert(t,n+'==="front"||'+n+'==="back"',"invalid cull.face")})),t.def(n,'==="front"?',Ra,":",za)}));case Vo:return s((function(e){return ne.command("number"==typeof e&&e>=i.lineWidthDims[0]&&e<=i.lineWidthDims[1],"invalid line width, must be a positive number between "+i.lineWidthDims[0]+" and "+i.lineWidthDims[1],t.commandStr),e}),(function(e,t,n){return ne.optional((function(){e.assert(t,"typeof "+n+'==="number"&&'+n+">="+i.lineWidthDims[0]+"&&"+n+"<="+i.lineWidthDims[1],"invalid line width")})),n}));case Ao:return s((function(e){return ne.commandParameter(e,is,a,t.commandStr),is[e]}),(function(e,t,n){return ne.optional((function(){e.assert(t,n+'==="cw"||'+n+'==="ccw"',"invalid frontFace, must be one of cw,ccw")})),t.def(n+'==="cw"?'+Na+":"+Ua)}));case ko:return s((function(e){return ne.command(pn(e)&&4===e.length,"color.mask must be length 4 array",t.commandStr),e.map((function(e){return!!e}))}),(function(e,t,n){return ne.optional((function(){e.assert(t,e.shared.isArrayLike+"("+n+")&&"+n+".length===4","invalid color.mask")})),Pe(4,(function(e){return"!!"+n+"["+e+"]"}))}));case Lo:return s((function(e){ne.command("object"==typeof e&&e,a,t.commandStr);var n="value"in e?e.value:1,r=!!e.invert;return ne.command("number"==typeof n&&n>=0&&n<=1,"sample.coverage.value must be a number between 0 and 1",t.commandStr),[n,r]}),(function(e,t,n){return ne.optional((function(){e.assert(t,n+"&&typeof "+n+'==="object"',"invalid sample.coverage")})),[t.def('"value" in ',n,"?+",n,".value:1"),t.def("!!",n,".invert")]}))}})),o}function z(e,t){var n=e.static,r=e.dynamic,i={};return Object.keys(n).forEach((function(e){var r,o=n[e];if("number"==typeof o||"boolean"==typeof o)r=ls((function(){return o}));else if("function"==typeof o){var a=o._reglType;"texture2d"===a||"textureCube"===a?r=ls((function(e){return e.link(o)})):"framebuffer"===a||"framebufferCube"===a?(ne.command(o.color.length>0,'missing color attachment for framebuffer sent to uniform "'+e+'"',t.commandStr),r=ls((function(e){return e.link(o.color[0])}))):ne.commandRaise('invalid data for uniform "'+e+'"',t.commandStr)}else pn(o)?r=ls((function(t){return t.global.def("[",Pe(o.length,(function(n){return ne.command("number"==typeof o[n]||"boolean"==typeof o[n],"invalid uniform "+e,t.commandStr),o[n]})),"]")})):ne.commandRaise('invalid or missing data for uniform "'+e+'"',t.commandStr);r.value=o,i[e]=r})),Object.keys(r).forEach((function(e){var t=r[e];i[e]=cs(t,(function(e,n){return e.invoke(n,t)}))})),i}function N(e,t){var r=e.static,i=e.dynamic,a={};return Object.keys(r).forEach((function(e){var i=r[e],s=n.id(e),u=new m;if(os(i))u.state=oo,u.buffer=o.getBuffer(o.create(i,ua,!1,!0)),u.type=0;else{var l=o.getBuffer(i);if(l)u.state=oo,u.buffer=l,u.type=0;else if(ne.command("object"==typeof i&&i,"invalid data for attribute "+e,t.commandStr),"constant"in i){var c=i.constant;u.buffer="null",u.state=ao,"number"==typeof c?u.x=c:(ne.command(pn(c)&&c.length>0&&c.length<=4,"invalid constant for attribute "+e,t.commandStr),ro.forEach((function(e,t){t<c.length&&(u[e]=c[t])})))}else{l=os(i.buffer)?o.getBuffer(o.create(i.buffer,ua,!1,!0)):o.getBuffer(i.buffer),ne.command(!!l,'missing buffer for attribute "'+e+'"',t.commandStr);var p=0|i.offset;ne.command(p>=0,'invalid offset for attribute "'+e+'"',t.commandStr);var f=0|i.stride;ne.command(f>=0&&f<256,'invalid stride for attribute "'+e+'", must be integer betweeen [0, 255]',t.commandStr);var d=0|i.size;ne.command(!("size"in i)||d>0&&d<=4,'invalid size for attribute "'+e+'", must be 1,2,3,4',t.commandStr);var h=!!i.normalized,v=0;"type"in i&&(ne.commandParameter(i.type,Lt,"invalid type for attribute "+e,t.commandStr),v=Lt[i.type]);var b=0|i.divisor;ne.optional((function(){"divisor"in i&&(ne.command(0===b||g,'cannot specify divisor for attribute "'+e+'", instancing not supported',t.commandStr),ne.command(b>=0,'invalid divisor for attribute "'+e+'"',t.commandStr));var n=t.commandStr,r=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(i).forEach((function(t){ne.command(r.indexOf(t)>=0,'unknown parameter "'+t+'" for attribute pointer "'+e+'" (valid parameters are '+r+")",n)}))})),u.buffer=l,u.state=oo,u.size=d,u.normalized=h,u.type=v||l.dtype,u.offset=p,u.stride=f,u.divisor=b}}a[e]=ls((function(e,t){var n=e.attribCache;if(s in n)return n[s];var r={isStream:!1};return Object.keys(u).forEach((function(e){r[e]=u[e]})),u.buffer&&(r.buffer=e.link(u.buffer),r.type=r.type||r.buffer+".dtype"),n[s]=r,r}))})),Object.keys(i).forEach((function(e){var t=i[e];function n(n,r){var i=n.invoke(r,t),o=n.shared,a=n.constants,s=o.isBufferArgs,u=o.buffer;ne.optional((function(){n.assert(r,i+"&&(typeof "+i+'==="object"||typeof '+i+'==="function")&&('+s+"("+i+")||"+u+".getBuffer("+i+")||"+u+".getBuffer("+i+".buffer)||"+s+"("+i+'.buffer)||("constant" in '+i+"&&(typeof "+i+'.constant==="number"||'+o.isArrayLike+"("+i+".constant))))",'invalid dynamic attribute "'+e+'"')}));var l={isStream:r.def(!1)},c=new m;c.state=oo,Object.keys(c).forEach((function(e){l[e]=r.def(""+c[e])}));var p=l.buffer,f=l.type;function d(e){r(l[e],"=",i,".",e,"|0;")}return r("if(",s,"(",i,")){",l.isStream,"=true;",p,"=",u,".createStream(",ua,",",i,");",f,"=",p,".dtype;","}else{",p,"=",u,".getBuffer(",i,");","if(",p,"){",f,"=",p,".dtype;",'}else if("constant" in ',i,"){",l.state,"=",ao,";","if(typeof "+i+'.constant === "number"){',l[ro[0]],"=",i,".constant;",ro.slice(1).map((function(e){return l[e]})).join("="),"=0;","}else{",ro.map((function(e,t){return l[e]+"="+i+".constant.length>"+t+"?"+i+".constant["+t+"]:0;"})).join(""),"}}else{","if(",s,"(",i,".buffer)){",p,"=",u,".createStream(",ua,",",i,".buffer);","}else{",p,"=",u,".getBuffer(",i,".buffer);","}",f,'="type" in ',i,"?",a.glTypes,"[",i,".type]:",p,".dtype;",l.normalized,"=!!",i,".normalized;"),d("size"),d("offset"),d("stride"),d("divisor"),r("}}"),r.exit("if(",l.isStream,"){",u,".destroyStream(",p,");","}"),l}a[e]=cs(t,n)})),a}function U(e){var t=e.static,n=e.dynamic,r={};return Object.keys(t).forEach((function(e){var n=t[e];r[e]=ls((function(e,t){return"number"==typeof n||"boolean"==typeof n?""+n:e.link(n)}))})),Object.keys(n).forEach((function(e){var t=n[e];r[e]=cs(t,(function(e,n){return e.invoke(n,t)}))})),r}function H(e,t,n,i,o){var a=e.static,s=e.dynamic;ne.optional((function(){var e=[Ho,Ko,Go,qo,Wo,Qo,Yo,$o,Uo,Xo].concat(C);function t(t){Object.keys(t).forEach((function(t){ne.command(e.indexOf(t)>=0,'unknown parameter "'+t+'"',o.commandStr)}))}t(a),t(s)}));var u=M(e,t),l=T(e),p=F(e,l,o),f=I(e,o),d=R(e,o),h=B(e,o,u);function v(e){var t=p[e];t&&(d[e]=t)}v(No),v(P(zo));var m=Object.keys(d).length>0,b={framebuffer:l,draw:f,shader:h,state:d,dirty:m,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(b.profile=L(e),b.uniforms=z(n,o),b.drawVAO=b.scopeVAO=f.vao,!b.drawVAO&&h.program&&!u&&r.angle_instanced_arrays&&f.static.elements){var g=!0,y=h.program.attributes.map((function(e){var n=t.static[e];return g=g&&!!n,n}));if(g&&y.length>0){var w=c.getVAO(c.createVAO({attributes:y,elements:f.static.elements}));b.drawVAO=new ss(null,null,null,(function(e,t){return e.link(w)})),b.useVAO=!0}}return u?b.useVAO=!0:b.attributes=N(t,o),b.context=U(i),b}function K(e,t,n){var r=e.shared.context,i=e.scope();Object.keys(n).forEach((function(o){t.save(r,"."+o);var a=n[o].append(e,t);Array.isArray(a)?i(r,".",o,"=[",a.join(),"];"):i(r,".",o,"=",a,";")})),t(i)}function G(e,t,n,r){var i,o=e.shared,a=o.gl,s=o.framebuffer;y&&(i=t.def(o.extensions,".webgl_draw_buffers"));var u,l=e.constants,c=l.drawBuffer,p=l.backBuffer;u=n?n.append(e,t):t.def(s,".next"),r||t("if(",u,"!==",s,".cur){"),t("if(",u,"){",a,".bindFramebuffer(",Xa,",",u,".framebuffer);"),y&&t(i,".drawBuffersWEBGL(",c,"[",u,".colorAttachments.length]);"),t("}else{",a,".bindFramebuffer(",Xa,",null);"),y&&t(i,".drawBuffersWEBGL(",p,");"),t("}",s,".cur=",u,";"),r||t("}")}function q(e,t,n){var r=e.shared,i=r.gl,o=e.current,a=e.next,s=r.current,u=r.next,l=e.cond(s,".dirty");C.forEach((function(t){var r,c,p=P(t);if(!(p in n.state))if(p in a){r=a[p],c=o[p];var f=Pe(_[p].length,(function(e){return l.def(r,"[",e,"]")}));l(e.cond(f.map((function(e,t){return e+"!=="+c+"["+t+"]"})).join("||")).then(i,".",E[p],"(",f,");",f.map((function(e,t){return c+"["+t+"]="+e})).join(";"),";"))}else{r=l.def(u,".",p);var d=e.cond(r,"!==",s,".",p);l(d),p in k?d(e.cond(r).then(i,".enable(",k[p],");").else(i,".disable(",k[p],");"),s,".",p,"=",r,";"):d(i,".",E[p],"(",r,");",s,".",p,"=",r,";")}})),0===Object.keys(n.state).length&&l(s,".dirty=false;"),t(l)}function W(e,t,n,r){var i=e.shared,o=e.current,a=i.current,s=i.gl;as(Object.keys(n)).forEach((function(i){var u=n[i];if(!r||r(u)){var l=u.append(e,t);if(k[i]){var c=k[i];us(u)?t(s,l?".enable(":".disable(",c,");"):t(e.cond(l).then(s,".enable(",c,");").else(s,".disable(",c,");")),t(a,".",i,"=",l,";")}else if(pn(l)){var p=o[i];t(s,".",E[i],"(",l,");",l.map((function(e,t){return p+"["+t+"]="+e})).join(";"),";")}else t(s,".",E[i],"(",l,");",a,".",i,"=",l,";")}}))}function Y(e,t){g&&(e.instancing=t.def(e.shared.extensions,".angle_instanced_arrays"))}function Q(e,t,n,r,i){var o,a,s,u=e.shared,l=e.stats,c=u.current,p=u.timer,f=n.profile;function d(){return"undefined"==typeof performance?"Date.now()":"performance.now()"}function v(e){e(o=t.def(),"=",d(),";"),"string"==typeof i?e(l,".count+=",i,";"):e(l,".count++;"),h&&(r?e(a=t.def(),"=",p,".getNumPendingQueries();"):e(p,".beginQuery(",l,");"))}function m(e){e(l,".cpuTime+=",d(),"-",o,";"),h&&(r?e(p,".pushScopeStats(",a,",",p,".getNumPendingQueries(),",l,");"):e(p,".endQuery();"))}function b(e){var n=t.def(c,".profile");t(c,".profile=",e,";"),t.exit(c,".profile=",n,";")}if(f){if(us(f))return void(f.enable?(v(t),m(t.exit),b("true")):b("false"));b(s=f.append(e,t))}else s=t.def(c,".profile");var g=e.block();v(g),t("if(",s,"){",g,"}");var y=e.block();m(y),t.exit("if(",s,"){",y,"}")}function $(e,t,n,r,i){var o=e.shared;function a(e){switch(e){case xa:case Pa:case Oa:return 2;case Ca:case Aa:case Da:return 3;case ka:case Va:case ja:return 4;default:return 1}}function s(n,r,i){var a=o.gl,s=t.def(n,".location"),u=t.def(o.attributes,"[",s,"]"),l=i.state,c=i.buffer,p=[i.x,i.y,i.z,i.w],f=["buffer","normalized","offset","stride"];function d(){t("if(!",u,".buffer){",a,".enableVertexAttribArray(",s,");}");var n,o=i.type;if(n=i.size?t.def(i.size,"||",r):r,t("if(",u,".type!==",o,"||",u,".size!==",n,"||",f.map((function(e){return u+"."+e+"!=="+i[e]})).join("||"),"){",a,".bindBuffer(",ua,",",c,".buffer);",a,".vertexAttribPointer(",[s,n,o,i.normalized,i.stride,i.offset],");",u,".type=",o,";",u,".size=",n,";",f.map((function(e){return u+"."+e+"="+i[e]+";"})).join(""),"}"),g){var l=i.divisor;t("if(",u,".divisor!==",l,"){",e.instancing,".vertexAttribDivisorANGLE(",[s,l],");",u,".divisor=",l,";}")}}function h(){t("if(",u,".buffer){",a,".disableVertexAttribArray(",s,");",u,".buffer=null;","}if(",ro.map((function(e,t){return u+"."+e+"!=="+p[t]})).join("||"),"){",a,".vertexAttrib4f(",s,",",p,");",ro.map((function(e,t){return u+"."+e+"="+p[t]+";"})).join(""),"}")}l===oo?d():l===ao?h():(t("if(",l,"===",oo,"){"),d(),t("}else{"),h(),t("}"))}r.forEach((function(r){var o,u=r.name,l=n.attributes[u];if(l){if(!i(l))return;o=l.append(e,t)}else{if(!i(ps))return;var c=e.scopeAttrib(u);ne.optional((function(){e.assert(t,c+".state","missing attribute "+u)})),o={},Object.keys(new m).forEach((function(e){o[e]=t.def(c,".",e)}))}s(e.link(r),a(r.info.type),o)}))}function X(e,t,r,i,o,a){for(var s,u=e.shared,l=u.gl,c={},p=0;p<i.length;++p){var f=i[p],d=f.name,h=f.info.type,v=f.info.size,m=r.uniforms[d];if(v>1){if(!m)continue;var b=d.replace("[0]","");if(c[b])continue;c[b]=1}var g,y=e.link(f)+".location";if(m){if(!o(m))continue;if(us(m)){var w=m.value;if(ne.command(null!=w,'missing uniform "'+d+'"',e.commandStr),h===Ma||h===Ba){ne.command("function"==typeof w&&(h===Ma&&("texture2d"===w._reglType||"framebuffer"===w._reglType)||h===Ba&&("textureCube"===w._reglType||"framebufferCube"===w._reglType)),"invalid texture for uniform "+d,e.commandStr);var _=e.link(w._texture||w.color[0]._texture);t(l,".uniform1i(",y,",",_+".bind());"),t.exit(_,".unbind();")}else if(h===La||h===Ta||h===Fa){ne.optional((function(){ne.command(pn(w),"invalid matrix for uniform "+d,e.commandStr),ne.command(h===La&&4===w.length||h===Ta&&9===w.length||h===Fa&&16===w.length,"invalid length for matrix uniform "+d,e.commandStr)}));var x=e.global.def("new Float32Array(["+Array.prototype.slice.call(w)+"])"),C=2;h===Ta?C=3:h===Fa&&(C=4),t(l,".uniformMatrix",C,"fv(",y,",false,",x,");")}else{switch(h){case _a:1===v?ne.commandType(w,"number","uniform "+d,e.commandStr):ne.command(pn(w)&&w.length===v,"uniform "+d,e.commandStr),s="1f";break;case xa:ne.command(pn(w)&&w.length&&w.length%2==0&&w.length<=2*v,"uniform "+d,e.commandStr),s="2f";break;case Ca:ne.command(pn(w)&&w.length&&w.length%3==0&&w.length<=3*v,"uniform "+d,e.commandStr),s="3f";break;case ka:ne.command(pn(w)&&w.length&&w.length%4==0&&w.length<=4*v,"uniform "+d,e.commandStr),s="4f";break;case Sa:1===v?ne.commandType(w,"boolean","uniform "+d,e.commandStr):ne.command(pn(w)&&w.length===v,"uniform "+d,e.commandStr),s="1i";break;case Ea:1===v?ne.commandType(w,"number","uniform "+d,e.commandStr):ne.command(pn(w)&&w.length===v,"uniform "+d,e.commandStr),s="1i";break;case Oa:case Pa:ne.command(pn(w)&&w.length&&w.length%2==0&&w.length<=2*v,"uniform "+d,e.commandStr),s="2i";break;case Da:case Aa:ne.command(pn(w)&&w.length&&w.length%3==0&&w.length<=3*v,"uniform "+d,e.commandStr),s="3i";break;case ja:case Va:ne.command(pn(w)&&w.length&&w.length%4==0&&w.length<=4*v,"uniform "+d,e.commandStr),s="4i"}v>1?(s+="v",w=e.global.def("["+Array.prototype.slice.call(w)+"]")):w=pn(w)?Array.prototype.slice.call(w):w,t(l,".uniform",s,"(",y,",",w,");")}continue}g=m.append(e,t)}else{if(!o(ps))continue;g=t.def(u.uniforms,"[",n.id(d),"]")}h===Ma?(ne(!Array.isArray(g),"must specify a scalar prop for textures"),t("if(",g,"&&",g,'._reglType==="framebuffer"){',g,"=",g,".color[0];","}")):h===Ba&&(ne(!Array.isArray(g),"must specify a scalar prop for cube maps"),t("if(",g,"&&",g,'._reglType==="framebufferCube"){',g,"=",g,".color[0];","}")),ne.optional((function(){function n(n,r){e.assert(t,n,'bad data or missing for uniform "'+d+'".  '+r)}function r(e,t){1===t&&ne(!Array.isArray(g),"must not specify an array type for uniform"),n("Array.isArray("+g+") && typeof "+g+'[0]===" '+e+'" || typeof '+g+'==="'+e+'"',"invalid type, expected "+e)}function i(t,r,i){Array.isArray(g)?ne(g.length&&g.length%t==0&&g.length<=t*i,"must have length of "+(1===i?"":"n * ")+t):n(u.isArrayLike+"("+g+")&&"+g+".length && "+g+".length % "+t+" === 0 && "+g+".length<="+t*i,"invalid vector, should have length of "+(1===i?"":"n * ")+t,e.commandStr)}function o(t){ne(!Array.isArray(g),"must not specify a value type"),n("typeof "+g+'==="function"&&'+g+'._reglType==="texture'+(t===ca?"2d":"Cube")+'"',"invalid texture type",e.commandStr)}switch(h){case Ea:r("number",v);break;case Pa:i(2,"number",v);break;case Aa:i(3,"number",v);break;case Va:i(4,"number",v);break;case _a:r("number",v);break;case xa:i(2,"number",v);break;case Ca:i(3,"number",v);break;case ka:i(4,"number",v);break;case Sa:r("boolean",v);break;case Oa:i(2,"boolean",v);break;case Da:i(3,"boolean",v);break;case ja:i(4,"boolean",v);break;case La:i(4,"number",v);break;case Ta:i(9,"number",v);break;case Fa:i(16,"number",v);break;case Ma:o(ca);break;case Ba:o(pa)}}));var k=1;switch(h){case Ma:case Ba:var E=t.def(g,"._texture");t(l,".uniform1i(",y,",",E,".bind());"),t.exit(E,".unbind();");continue;case Ea:case Sa:s="1i";break;case Pa:case Oa:s="2i",k=2;break;case Aa:case Da:s="3i",k=3;break;case Va:case ja:s="4i",k=4;break;case _a:s="1f";break;case xa:s="2f",k=2;break;case Ca:s="3f",k=3;break;case ka:s="4f",k=4;break;case La:s="Matrix2fv";break;case Ta:s="Matrix3fv";break;case Fa:s="Matrix4fv"}if(-1===s.indexOf("Matrix")&&v>1&&(s+="v",k=1),"M"===s.charAt(0)){t(l,".uniform",s,"(",y,",");var P=Math.pow(h-La+2,2),A=e.global.def("new Float32Array(",P,")");Array.isArray(g)?t("false,(",Pe(P,(function(e){return A+"["+e+"]="+g[e]})),",",A,")"):t("false,(Array.isArray(",g,")||",g," instanceof Float32Array)?",g,":(",Pe(P,(function(e){return A+"["+e+"]="+g+"["+e+"]"})),",",A,")"),t(");")}else if(k>1){for(var V=[],S=[],O=0;O<k;++O)Array.isArray(g)?S.push(g[O]):S.push(t.def(g+"["+O+"]")),a&&V.push(t.def());a&&t("if(!",e.batchId,"||",V.map((function(e,t){return e+"!=="+S[t]})).join("||"),"){",V.map((function(e,t){return e+"="+S[t]+";"})).join("")),t(l,".uniform",s,"(",y,",",S.join(","),");"),a&&t("}")}else{if(ne(!Array.isArray(g),"uniform value must not be an array"),a){var D=t.def();t("if(!",e.batchId,"||",D,"!==",g,"){",D,"=",g,";")}t(l,".uniform",s,"(",y,",",g,");"),a&&t("}")}}}function J(e,t,n,r){var i=e.shared,o=i.gl,a=i.draw,s=r.draw;function u(){var u,l=s.elements,c=t;return l?((l.contextDep&&r.contextDynamic||l.propDep)&&(c=n),u=l.append(e,c),s.elementsActive&&c("if("+u+")"+o+".bindBuffer("+la+","+u+".buffer.buffer);")):(u=c.def(),c(u,"=",a,".",qo,";","if(",u,"){",o,".bindBuffer(",la,",",u,".buffer.buffer);}","else if(",i.vao,".currentVAO){",u,"=",e.shared.elements+".getElements("+i.vao,".currentVAO.elements);",w?"":"if("+u+")"+o+".bindBuffer("+la+","+u+".buffer.buffer);","}")),u}function l(){var i,o=s.count,u=t;return o?((o.contextDep&&r.contextDynamic||o.propDep)&&(u=n),i=o.append(e,u),ne.optional((function(){o.MISSING&&e.assert(t,"false","missing vertex count"),o.DYNAMIC&&e.assert(u,i+">=0","missing vertex count")}))):(i=u.def(a,".",Yo),ne.optional((function(){e.assert(u,i+">=0","missing vertex count")}))),i}var c=u();function p(i){var o=s[i];return o?o.contextDep&&r.contextDynamic||o.propDep?o.append(e,n):o.append(e,t):t.def(a,".",i)}var f,d,h=p(Wo),v=p(Qo),m=l();if("number"==typeof m){if(0===m)return}else n("if(",m,"){"),n.exit("}");g&&(f=p($o),d=e.instancing);var b=c+".type",y=s.elements&&us(s.elements)&&!s.vaoActive;function _(){function e(){n(d,".drawElementsInstancedANGLE(",[h,m,b,v+"<<(("+b+"-"+io+")>>1)",f],");")}function t(){n(d,".drawArraysInstancedANGLE(",[h,v,m,f],");")}c&&"null"!==c?y?e():(n("if(",c,"){"),e(),n("}else{"),t(),n("}")):t()}function x(){function e(){n(o+".drawElements("+[h,m,b,v+"<<(("+b+"-"+io+")>>1)"]+");")}function t(){n(o+".drawArrays("+[h,v,m]+");")}c&&"null"!==c?y?e():(n("if(",c,"){"),e(),n("}else{"),t(),n("}")):t()}g&&("number"!=typeof f||f>=0)?"string"==typeof f?(n("if(",f,">0){"),_(),n("}else if(",f,"<0){"),x(),n("}")):_():x()}function Z(e,t,n,r,i){var o=j(),a=o.proc("body",i);return ne.optional((function(){o.commandStr=t.commandStr,o.command=o.link(t.commandStr)})),g&&(o.instancing=a.def(o.shared.extensions,".angle_instanced_arrays")),e(o,a,n,r),o.compile().body}function ee(e,t,n,r){Y(e,t),n.useVAO?n.drawVAO?t(e.shared.vao,".setVAO(",n.drawVAO.append(e,t),");"):t(e.shared.vao,".setVAO(",e.shared.vao,".targetVAO);"):(t(e.shared.vao,".setVAO(null);"),$(e,t,n,r.attributes,(function(){return!0}))),X(e,t,n,r.uniforms,(function(){return!0}),!1),J(e,t,t,n)}function te(e,t){var n=e.proc("draw",1);Y(e,n),K(e,n,t.context),G(e,n,t.framebuffer),q(e,n,t),W(e,n,t.state),Q(e,n,t,!1,!0);var r=t.shader.progVar.append(e,n);if(n(e.shared.gl,".useProgram(",r,".program);"),t.shader.program)ee(e,n,t,t.shader.program);else{n(e.shared.vao,".setVAO(null);");var i=e.global.def("{}"),o=n.def(r,".id"),a=n.def(i,"[",o,"]");n(e.cond(a).then(a,".call(this,a0);").else(a,"=",i,"[",o,"]=",e.link((function(n){return Z(ee,e,t,n,1)})),"(",r,");",a,".call(this,a0);"))}Object.keys(t.state).length>0&&n(e.shared.current,".dirty=true;"),e.shared.vao&&n(e.shared.vao,".setVAO(null);")}function re(e,t,n,r){function i(){return!0}e.batchId="a1",Y(e,t),$(e,t,n,r.attributes,i),X(e,t,n,r.uniforms,i,!1),J(e,t,t,n)}function ie(e,t,n,r){Y(e,t);var i=n.contextDep,o=t.def(),a="a0",s="a1",u=t.def();e.shared.props=u,e.batchId=o;var l=e.scope(),c=e.scope();function p(e){return e.contextDep&&i||e.propDep}function f(e){return!p(e)}if(t(l.entry,"for(",o,"=0;",o,"<",s,";++",o,"){",u,"=",a,"[",o,"];",c,"}",l.exit),n.needsContext&&K(e,c,n.context),n.needsFramebuffer&&G(e,c,n.framebuffer),W(e,c,n.state,p),n.profile&&p(n.profile)&&Q(e,c,n,!1,!0),r)n.useVAO?n.drawVAO?p(n.drawVAO)?c(e.shared.vao,".setVAO(",n.drawVAO.append(e,c),");"):l(e.shared.vao,".setVAO(",n.drawVAO.append(e,l),");"):l(e.shared.vao,".setVAO(",e.shared.vao,".targetVAO);"):(l(e.shared.vao,".setVAO(null);"),$(e,l,n,r.attributes,f),$(e,c,n,r.attributes,p)),X(e,l,n,r.uniforms,f,!1),X(e,c,n,r.uniforms,p,!0),J(e,l,c,n);else{var d=e.global.def("{}"),h=n.shader.progVar.append(e,c),v=c.def(h,".id"),m=c.def(d,"[",v,"]");c(e.shared.gl,".useProgram(",h,".program);","if(!",m,"){",m,"=",d,"[",v,"]=",e.link((function(t){return Z(re,e,n,t,2)})),"(",h,");}",m,".call(this,a0[",o,"],",o,");")}}function oe(e,t){var n=e.proc("batch",2);e.batchId="0",Y(e,n);var r=!1,i=!0;Object.keys(t.context).forEach((function(e){r=r||t.context[e].propDep})),r||(K(e,n,t.context),i=!1);var o=t.framebuffer,a=!1;function s(e){return e.contextDep&&r||e.propDep}o?(o.propDep?r=a=!0:o.contextDep&&r&&(a=!0),a||G(e,n,o)):G(e,n,null),t.state.viewport&&t.state.viewport.propDep&&(r=!0),q(e,n,t),W(e,n,t.state,(function(e){return!s(e)})),t.profile&&s(t.profile)||Q(e,n,t,!1,"a1"),t.contextDep=r,t.needsContext=i,t.needsFramebuffer=a;var u=t.shader.progVar;if(u.contextDep&&r||u.propDep)ie(e,n,t,null);else{var l=u.append(e,n);if(n(e.shared.gl,".useProgram(",l,".program);"),t.shader.program)ie(e,n,t,t.shader.program);else{n(e.shared.vao,".setVAO(null);");var c=e.global.def("{}"),p=n.def(l,".id"),f=n.def(c,"[",p,"]");n(e.cond(f).then(f,".call(this,a0,a1);").else(f,"=",c,"[",p,"]=",e.link((function(n){return Z(ie,e,t,n,2)})),"(",l,");",f,".call(this,a0,a1);"))}}Object.keys(t.state).length>0&&n(e.shared.current,".dirty=true;"),e.shared.vao&&n(e.shared.vao,".setVAO(null);")}function ae(e,t){var r=e.proc("scope",3);e.batchId="a2";var i=e.shared,o=i.current;function a(n){var o=t.shader[n];o&&r.set(i.shader,"."+n,o.append(e,r))}K(e,r,t.context),t.framebuffer&&t.framebuffer.append(e,r),as(Object.keys(t.state)).forEach((function(n){var o=t.state[n].append(e,r);pn(o)?o.forEach((function(t,i){r.set(e.next[n],"["+i+"]",t)})):r.set(i.next,"."+n,o)})),Q(e,r,t,!0,!0),[qo,Qo,Yo,$o,Wo].forEach((function(n){var o=t.draw[n];o&&r.set(i.draw,"."+n,""+o.append(e,r))})),Object.keys(t.uniforms).forEach((function(o){var a=t.uniforms[o].append(e,r);Array.isArray(a)&&(a="["+a.join()+"]"),r.set(i.uniforms,"["+n.id(o)+"]",a)})),Object.keys(t.attributes).forEach((function(n){var i=t.attributes[n].append(e,r),o=e.scopeAttrib(n);Object.keys(new m).forEach((function(e){r.set(o,"."+e,i[e])}))})),t.scopeVAO&&r.set(i.vao,".targetVAO",t.scopeVAO.append(e,r)),a(Ko),a(Go),Object.keys(t.state).length>0&&(r(o,".dirty=true;"),r.exit(o,".dirty=true;")),r("a1(",e.shared.context,",a0,",e.batchId,");")}function se(e){if("object"==typeof e&&!pn(e)){for(var t=Object.keys(e),n=0;n<t.length;++n)if(he.isDynamic(e[t[n]]))return!0;return!1}}function ue(e,t,n){var r=t.static[n];if(r&&se(r)){var i=e.global,o=Object.keys(r),a=!1,s=!1,u=!1,l=e.global.def("{}");o.forEach((function(t){var n=r[t];if(he.isDynamic(n)){"function"==typeof n&&(n=r[t]=he.unbox(n));var o=cs(n,null);a=a||o.thisDep,u=u||o.propDep,s=s||o.contextDep}else{switch(i(l,".",t,"="),typeof n){case"number":i(n);break;case"string":i('"',n,'"');break;case"object":Array.isArray(n)&&i("[",n.join(),"]");break;default:i(e.link(n))}i(";")}})),t.dynamic[n]=new he.DynamicVariable(po,{thisDep:a,contextDep:s,propDep:u,ref:l,append:c}),delete t.static[n]}function c(e,t){o.forEach((function(n){var i=r[n];if(he.isDynamic(i)){var o=e.invoke(t,i);t(l,".",n,"=",o,";")}}))}}function le(e,n,r,i,o){var a=j();a.stats=a.link(o),Object.keys(n.static).forEach((function(e){ue(a,n,e)})),sa.forEach((function(t){ue(a,e,t)}));var s=H(e,n,r,i,a);return te(a,s),ae(a,s),oe(a,s),t(a.compile(),{destroy:function(){s.shader.program.destroy()}})}return{next:x,current:_,procs:function(){var e=j(),t=e.proc("poll"),n=e.proc("refresh"),o=e.block();t(o),n(o);var a,s=e.shared,u=s.gl,l=s.next,c=s.current;o(c,".dirty=false;"),G(e,t),G(e,n,null,!0),g&&(a=e.link(g)),r.oes_vertex_array_object&&n(e.link(r.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var p=0;p<i.maxAttributes;++p){var f=n.def(s.attributes,"[",p,"]"),d=e.cond(f,".buffer");d.then(u,".enableVertexAttribArray(",p,");",u,".bindBuffer(",ua,",",f,".buffer.buffer);",u,".vertexAttribPointer(",p,",",f,".size,",f,".type,",f,".normalized,",f,".stride,",f,".offset);").else(u,".disableVertexAttribArray(",p,");",u,".vertexAttrib4f(",p,",",f,".x,",f,".y,",f,".z,",f,".w);",f,".buffer=null;"),n(d),g&&n(a,".vertexAttribDivisorANGLE(",p,",",f,".divisor);")}return n(e.shared.vao,".currentVAO=null;",e.shared.vao,".setVAO(",e.shared.vao,".targetVAO);"),Object.keys(k).forEach((function(r){var i=k[r],a=o.def(l,".",r),s=e.block();s("if(",a,"){",u,".enable(",i,")}else{",u,".disable(",i,")}",c,".",r,"=",a,";"),n(s),t("if(",a,"!==",c,".",r,"){",s,"}")})),Object.keys(E).forEach((function(r){var i,a,s=E[r],p=_[r],f=e.block();if(f(u,".",s,"("),pn(p)){var d=p.length;i=e.global.def(l,".",r),a=e.global.def(c,".",r),f(Pe(d,(function(e){return i+"["+e+"]"})),");",Pe(d,(function(e){return a+"["+e+"]="+i+"["+e+"];"})).join("")),t("if(",Pe(d,(function(e){return i+"["+e+"]!=="+a+"["+e+"]"})).join("||"),"){",f,"}")}else i=o.def(l,".",r),a=o.def(c,".",r),f(i,");",c,".",r,"=",i,";"),t("if(",i,"!==",a,"){",f,"}");n(f)})),e.compile()}(),compile:le}}function ds(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var hs=34918,vs=34919,ms=35007,bs=function(e,t){if(!t.ext_disjoint_timer_query)return null;var n=[];function r(){return n.pop()||t.ext_disjoint_timer_query.createQueryEXT()}function i(e){n.push(e)}var o=[];function a(e){var n=r();t.ext_disjoint_timer_query.beginQueryEXT(ms,n),o.push(n),d(o.length-1,o.length,e)}function s(){t.ext_disjoint_timer_query.endQueryEXT(ms)}function u(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var l=[];function c(){return l.pop()||new u}function p(e){l.push(e)}var f=[];function d(e,t,n){var r=c();r.startQueryIndex=e,r.endQueryIndex=t,r.sum=0,r.stats=n,f.push(r)}var h=[],v=[];function m(){var e,n,r=o.length;if(0!==r){v.length=Math.max(v.length,r+1),h.length=Math.max(h.length,r+1),h[0]=0,v[0]=0;var a=0;for(e=0,n=0;n<o.length;++n){var s=o[n];t.ext_disjoint_timer_query.getQueryObjectEXT(s,vs)?(a+=t.ext_disjoint_timer_query.getQueryObjectEXT(s,hs),i(s)):o[e++]=s,h[n+1]=a,v[n+1]=e}for(o.length=e,e=0,n=0;n<f.length;++n){var u=f[n],l=u.startQueryIndex,c=u.endQueryIndex;u.sum+=h[c]-h[l];var d=v[l],m=v[c];m===d?(u.stats.gpuTime+=u.sum/1e6,p(u)):(u.startQueryIndex=d,u.endQueryIndex=m,f[e++]=u)}f.length=e}}return{beginQuery:a,endQuery:s,pushScopeStats:d,update:m,getNumPendingQueries:function(){return o.length},clear:function(){n.push.apply(n,o);for(var e=0;e<n.length;e++)t.ext_disjoint_timer_query.deleteQueryEXT(n[e]);o.length=0,n.length=0},restore:function(){o.length=0,n.length=0}}},gs=16384,ys=256,ws=1024,_s=34962,xs="webglcontextlost",Cs="webglcontextrestored",ks=1,Es=2,Ps=3;function As(e,t){for(var n=0;n<e.length;++n)if(e[n]===t)return n;return-1}function Vs(e){var n=ke(e);if(!n)return null;var r=n.gl,i=r.getContextAttributes(),o=r.isContextLost(),a=Ee(r,n);if(!a)return null;var s=be(),u=ds(),l=a.extensions,c=bs(r,l),p=me(),f=r.drawingBufferWidth,d=r.drawingBufferHeight,h={tick:0,time:0,viewportWidth:f,viewportHeight:d,framebufferWidth:f,framebufferHeight:d,drawingBufferWidth:f,drawingBufferHeight:d,pixelRatio:n.pixelRatio},v={},m={elements:null,primitive:4,count:-1,offset:0,instances:-1},b=xt(r,l),g=Gt(r,u,n,_),y=an(r,l,g,u),w=Hi(r,l,b,u,g,y,m);function _(e){return w.destroyBuffer(e)}var x=Yi(r,s,u,n),C=Qr(r,l,b,(function(){P.procs.poll()}),h,u,n),k=li(r,l,b,u,n),E=Bi(r,l,b,C,k,u),P=fs(r,s,l,b,g,y,C,E,v,w,x,m,h,c,n),A=Zi(r,E,P.procs.poll,h,i,l,b),V=P.next,S=r.canvas,O=[],D=[],j=[],L=[n.onDestroy],T=null;function F(){if(0===O.length)return c&&c.update(),void(T=null);T=ve.next(F),W();for(var e=O.length-1;e>=0;--e){var t=O[e];t&&t(h,null,0)}r.flush(),c&&c.update()}function M(){!T&&O.length>0&&(T=ve.next(F))}function B(){T&&(ve.cancel(F),T=null)}function I(e){e.preventDefault(),o=!0,B(),D.forEach((function(e){e()}))}function R(e){r.getError(),o=!1,a.restore(),x.restore(),g.restore(),C.restore(),k.restore(),E.restore(),w.restore(),c&&c.restore(),P.procs.refresh(),M(),j.forEach((function(e){e()}))}function z(){O.length=0,B(),S&&(S.removeEventListener(xs,I),S.removeEventListener(Cs,R)),x.clear(),E.clear(),k.clear(),w.clear(),C.clear(),y.clear(),g.clear(),c&&c.clear(),L.forEach((function(e){e()}))}function N(e){function n(e){var n=t({},e);function r(e){if(e in n){var t=n[e];delete n[e],Object.keys(t).forEach((function(r){n[e+"."+r]=t[r]}))}}return delete n.uniforms,delete n.attributes,delete n.context,delete n.vao,"stencil"in n&&n.stencil.op&&(n.stencil.opBack=n.stencil.opFront=n.stencil.op,delete n.stencil.op),r("blend"),r("depth"),r("cull"),r("stencil"),r("polygonOffset"),r("scissor"),r("sample"),"vao"in e&&(n.vao=e.vao),n}function r(e,t){var n={},r={};return Object.keys(e).forEach((function(i){var o=e[i];if(he.isDynamic(o))r[i]=he.unbox(o,i);else{if(t&&Array.isArray(o))for(var a=0;a<o.length;++a)if(he.isDynamic(o[a]))return void(r[i]=he.unbox(o,i));n[i]=o}})),{dynamic:r,static:n}}ne(!!e,"invalid args to regl({...})"),ne.type(e,"object","invalid args to regl({...})");var i=r(e.context||{},!0),a=r(e.uniforms||{},!0),s=r(e.attributes||{},!1),u=r(n(e),!1),l={gpuTime:0,cpuTime:0,count:0},c=P.compile(u,s,a,i,l),p=c.draw,f=c.batch,d=c.scope,h=[];function v(e){for(;h.length<e;)h.push(null);return h}function m(e,t){var n;if(o&&ne.raise("context lost"),"function"==typeof e)return d.call(this,null,e,0);if("function"==typeof t)if("number"==typeof e)for(n=0;n<e;++n)d.call(this,null,t,n);else{if(!Array.isArray(e))return d.call(this,e,t,0);for(n=0;n<e.length;++n)d.call(this,e[n],t,n)}else if("number"==typeof e){if(e>0)return f.call(this,v(0|e),0|e)}else{if(!Array.isArray(e))return p.call(this,e);if(e.length)return f.call(this,e,e.length)}}return t(m,{stats:l,destroy:function(){c.destroy()}})}S&&(S.addEventListener(xs,I,!1),S.addEventListener(Cs,R,!1));var U=E.setFBO=N({framebuffer:he.define.call(null,ks,"framebuffer")});function H(e,t){var n=0;P.procs.poll();var i=t.color;i&&(r.clearColor(+i[0]||0,+i[1]||0,+i[2]||0,+i[3]||0),n|=gs),"depth"in t&&(r.clearDepth(+t.depth),n|=ys),"stencil"in t&&(r.clearStencil(0|t.stencil),n|=ws),ne(!!n,"called regl.clear with no buffer specified"),r.clear(n)}function K(e){if(ne("object"==typeof e&&e,"regl.clear() takes an object as input"),"framebuffer"in e)if(e.framebuffer&&"framebufferCube"===e.framebuffer_reglType)for(var n=0;n<6;++n)U(t({framebuffer:e.framebuffer.faces[n]},e),H);else U(e,H);else H(null,e)}function G(e){function t(){var t=As(O,e);function n(){var e=As(O,n);O[e]=O[O.length-1],O.length-=1,O.length<=0&&B()}ne(t>=0,"cannot cancel a frame twice"),O[t]=n}return ne.type(e,"function","regl.frame() callback must be a function"),O.push(e),M(),{cancel:t}}function q(){var e=V.viewport,t=V.scissor_box;e[0]=e[1]=t[0]=t[1]=0,h.viewportWidth=h.framebufferWidth=h.drawingBufferWidth=e[2]=t[2]=r.drawingBufferWidth,h.viewportHeight=h.framebufferHeight=h.drawingBufferHeight=e[3]=t[3]=r.drawingBufferHeight}function W(){h.tick+=1,h.time=Q(),q(),P.procs.poll()}function Y(){C.refresh(),q(),P.procs.refresh(),c&&c.update()}function Q(){return(me()-p)/1e3}function $(e,t){var n;switch(ne.type(t,"function","listener callback must be a function"),e){case"frame":return G(t);case"lost":n=D;break;case"restore":n=j;break;case"destroy":n=L;break;default:ne.raise("invalid event, must be one of frame,lost,restore,destroy")}return n.push(t),{cancel:function(){for(var e=0;e<n.length;++e)if(n[e]===t)return n[e]=n[n.length-1],void n.pop()}}}Y();var X=t(N,{clear:K,prop:he.define.bind(null,ks),context:he.define.bind(null,Es),this:he.define.bind(null,Ps),draw:N({}),buffer:function(e){return g.create(e,_s,!1,!1)},elements:function(e){return y.create(e,!1)},texture:C.create2D,cube:C.createCube,renderbuffer:k.create,framebuffer:E.create,framebufferCube:E.createCube,vao:w.createVAO,attributes:i,frame:G,on:$,limits:b,hasExtension:function(e){return b.extensions.indexOf(e.toLowerCase())>=0},read:A,destroy:z,_gl:r,_refresh:Y,poll:function(){W(),c&&c.update()},now:Q,stats:u});return n.onDone(null,X),X}return Vs}()})),n=e((function(e,t){e.exports=function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])})(t,n)};function t(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}var n=function(){return(n=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function r(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),i=0;for(t=0;t<n;t++)for(var o=arguments[t],a=0,s=o.length;a<s;a++,i++)r[i]=o[a];return r}var i={blades:[],inputs:[],monitors:[]};function o(){return r(i.blades,i.inputs,i.monitors)}function a(e){return e}function s(e){return null==e}function u(e,t){if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}var l={alreadydisposed:function(){return"View has been already disposed"},invalidparams:function(e){return"Invalid parameters for '"+e.name+"'"},nomatchingcontroller:function(e){return"No matching controller for '"+e.key+"'"},nomatchingview:function(e){return"No matching view for '"+JSON.stringify(e.params)+"'"},notbindable:function(){return"Value is not bindable"},propertynotfound:function(e){return"Property '"+e.name+"' not found"},shouldneverhappen:function(){return"This error should never happen"}},c=function(){function e(e){var t;this.message=null!==(t=l[e.type](a(e.context)))&&void 0!==t?t:"Unexpected error",this.name=this.constructor.name,this.stack=new Error(this.message).stack,this.type=e.type}return e.alreadyDisposed=function(){return new e({type:"alreadydisposed"})},e.notBindable=function(){return new e({type:"notbindable"})},e.propertyNotFound=function(t){return new e({type:"propertynotfound",context:{name:t}})},e.shouldNeverHappen=function(){return new e({type:"shouldneverhappen"})},e}();c.prototype=Object.create(Error.prototype),c.prototype.constructor=c;var p=function(){function e(e,t,n){this.obj_=e,this.key_=t,this.presetKey_=null!=n?n:t}return e.isBindable=function(e){return null!==e&&"object"==typeof e},Object.defineProperty(e.prototype,"key",{get:function(){return this.key_},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"presetKey",{get:function(){return this.presetKey_},enumerable:!1,configurable:!0}),e.prototype.read=function(){return this.obj_[this.key_]},e.prototype.write=function(e){this.obj_[this.key_]=e},e.prototype.writeProperty=function(t,n){var r=this.read();if(!e.isBindable(r))throw c.notBindable();if(!(t in r))throw c.propertyNotFound(t);r[t]=n},e}();function f(e,t,n){if(!p.isBindable(e))throw c.notBindable();return new p(e,t,n)}function d(e){"blade"===e.type?i.blades.unshift(e.plugin):"input"===e.type?i.inputs.unshift(e.plugin):"monitor"===e.type&&i.monitors.unshift(e.plugin)}var h=function(){function e(){this.observers_={}}return e.prototype.on=function(e,t){var n=this.observers_[e];return n||(n=this.observers_[e]=[]),n.push({handler:t}),this},e.prototype.off=function(e,t){var n=this.observers_[e];return n&&(this.observers_[e]=n.filter((function(e){return e.handler!==t}))),this},e.prototype.emit=function(e,t){var n=this.observers_[e];n&&n.forEach((function(e){e.handler(t)}))},e}(),v=function(){function e(){this.emitter=new h,this.disposed_=!1}return Object.defineProperty(e.prototype,"disposed",{get:function(){return this.disposed_},enumerable:!1,configurable:!0}),e.prototype.dispose=function(){return!this.disposed_&&(this.disposed_=!0,this.emitter.emit("dispose",{sender:this}),!0)},e}(),m=function(){function e(){this.emitter=new h,this.disposable_=new v,this.positions_=[],this.onDispose_=this.onDispose_.bind(this),this.disposable_.emitter.on("dispose",this.onDispose_)}return Object.defineProperty(e.prototype,"positions",{get:function(){return this.positions_},set:function(e){u(e,this.positions_)||(this.positions_=e,this.emitter.emit("change",{propertyName:"positions",sender:this}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"disposed",{get:function(){return this.disposable_.disposed},enumerable:!1,configurable:!0}),e.prototype.dispose=function(){this.disposable_.dispose()},e.prototype.onDispose_=function(){this.emitter.emit("dispose",{sender:this})},e}(),b="http://www.w3.org/2000/svg";function g(e){e.offsetHeight}function y(e,t){var n=e.style.transition;e.style.transition="none",t(),e.style.transition=n}function w(e){return void 0!==e.ontouchstart}function _(){return new Function("return this")()}function x(){return a(_()).document}function C(){return"document"in _()}function k(e){return C()?e.getContext("2d"):null}var E={check:'<path d="M2 8l4 4l8 -8"/>',dropdown:'<path d="M5 7h6l-3 3 z"/>',p2dpad:'<path d="M8 4v8"/><path d="M4 8h8"/><circle cx="12" cy="12" r="1.2"/>'};function P(e,t){var n=e.createElementNS(b,"svg");return n.innerHTML=E[t],n}function A(e,t,n){e.insertBefore(t,e.children[n])}function V(e){e.parentElement&&e.parentElement.removeChild(e)}function S(e){for(;e.children.length>0;)e.removeChild(e.children[0])}function O(e){for(;e.childNodes.length>0;)e.removeChild(e.childNodes[0])}function D(e){return e.relatedTarget?a(e.relatedTarget):"explicitOriginalTarget"in e?e.explicitOriginalTarget:null}var j="tp";function L(e){return function(t,n){return[j,"-",e,"v",t?"_"+t:"",n?"-"+n:""].join("")}}function T(e,t){return function(n){return t(e(n))}}function F(e){return e.rawValue}function M(e,t,n){n?e.classList.add(t):e.classList.remove(t)}var B=L("");function I(e,t){return function(n){M(e,B(void 0,t),n)}}function R(e,t,n){e.valueEmitter(t).on("change",T(F,n)),n(e.get(t))}function z(e,t){R(e,"disabled",I(t,"disabled")),R(e,"hidden",I(t,"hidden"))}function N(e,t){R(e,"disabled",(function(e){t.disabled=e}))}function U(e,t){R(e,"disabled",(function(e){t.tabIndex=e?-1:0}))}function H(e,t,n){R(e,t,(function(e){n.textContent=null!=e?e:""}))}var K=L("lst"),G=function(){function e(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.props_=t.props,this.element=e.createElement("div"),this.element.classList.add(K()),z(t.viewProps,this.element);var n=e.createElement("select");n.classList.add(K("s")),R(this.props_,"options",(function(t){S(n),t.forEach((function(t,r){var i=e.createElement("option");i.dataset.index=String(r),i.textContent=t.text,i.value=String(t.value),n.appendChild(i)}))})),N(t.viewProps,n),this.element.appendChild(n),this.selectElement=n;var r=e.createElement("div");r.classList.add(K("m")),r.appendChild(P(e,"dropdown")),this.element.appendChild(r),t.value.emitter.on("change",this.onValueChange_),this.value_=t.value,this.update_()}return e.prototype.update_=function(){this.selectElement.value=String(this.value_.rawValue)},e.prototype.onValueChange_=function(){this.update_()},e}(),q=function(){function e(e,t){this.onSelectChange_=this.onSelectChange_.bind(this),this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.view=new G(e,{props:this.props,value:this.value,viewProps:this.viewProps}),this.view.selectElement.addEventListener("change",this.onSelectChange_)}return e.prototype.onSelectChange_=function(e){var t=a(e.currentTarget).selectedOptions.item(0);if(t){var n=Number(t.dataset.index);this.value.rawValue=this.props.get("options")[n].value}},e}(),W=function(){function e(e){this.emitter=new h,this.value_=e}return Object.defineProperty(e.prototype,"rawValue",{get:function(){return this.value_},set:function(e){this.value_!==e&&(this.value_=e,this.emitter.emit("change",{sender:this,rawValue:this.value_}))},enumerable:!1,configurable:!0}),e}(),Y=function(){function e(e){var t=this;this.emitter=new h;var n=Object.keys(e),r=n.map((function(t){return new W(e[t])}));r.forEach((function(e,r){e.emitter.on("change",(function(){t.emitter.emit("change",{key:n[r],sender:t})}))})),this.valMap_=n.reduce((function(e,t,n){var i;return Object.assign(e,((i={})[t]=r[n],i))}),{})}return e.prototype.get=function(e){return this.valMap_[e].rawValue},e.prototype.set=function(e,t){this.valMap_[e].rawValue=t},e.prototype.valueEmitter=function(e){return this.valMap_[e].emitter},e}();function Q(e){return function(t,n){if(n in t){var r=t[n];return e(r)?r:void 0}}}var $=Q((function(e){return"boolean"==typeof e})),X=Q((function(e){return"number"==typeof e})),J=Q((function(e){return"string"==typeof e})),Z=Q((function(e){return"function"==typeof e}));function ee(e){return null!==e&&"object"==typeof e}var te=Q(ee),ne=function(){function e(e){this.constraints=e}return e.prototype.constrain=function(e){return this.constraints.reduce((function(e,t){return t.constrain(e)}),e)},e}();function re(e,t){if(e instanceof t)return e;if(e instanceof ne){var n=e.constraints.reduce((function(e,n){return e||(n instanceof t?n:null)}),null);if(n)return n}return null}var ie=function(){function e(e){this.options=e}return e.prototype.constrain=function(e){var t=this.options;return 0===t.length||t.filter((function(t){return t.value===e})).length>0?e:t[0].value},e}(),oe=function(){function e(e){this.step=e}return e.prototype.constrain=function(e){return(e<0?-Math.round(-e/this.step):Math.round(e/this.step))*this.step},e}();function ae(e){var t,n,r=null!=e?e:{};return new Y({disabled:null!==(t=r.disabled)&&void 0!==t&&t,hidden:null!==(n=r.hidden)&&void 0!==n&&n})}function se(e,t,n,r,i){return r+(e-t)/(n-t)*(i-r)}function ue(e){return String(e.toFixed(10)).split(".")[1].replace(/0+$/,"").length}function le(e,t,n){return Math.min(Math.max(e,t),n)}function ce(e,t){return(e%t+t)%t}function pe(e){if(Array.isArray(e))return e;var t=[];return Object.keys(e).forEach((function(n){t.push({text:n,value:e[n]})})),t}function fe(e){return"options"in e&&void 0!==e.options?new ie(pe(a(e.options))):null}function de(e){var t=e?re(e,ie):null;return t?t.options:null}function he(e){var t=e?re(e,oe):null;return t?t.step:null}function ve(e,t){var n=e&&re(e,oe);return n?ue(n.step):Math.max(ue(t),2)}function me(e){var t=he(e);return null!=t?t:1}function be(e,t){var n,r=e&&re(e,oe),i=Math.abs(null!==(n=null==r?void 0:r.step)&&void 0!==n?n:t);return 0===i?.1:Math.pow(10,Math.floor(Math.log10(i))-1)}function ge(e,t){e.viewProps||(e.viewProps=ae(),console.warn("Missing controller.viewProps (plugin: '"+t+"')\nThis polyfill will be removed in the next major version."))}function ye(e){return e&&e.parentElement&&e.parentElement.removeChild(e),null}function we(){return["first","last"]}var _e=L(""),xe=function(){function e(e){var t=this;this.parent_=null,this.blade=e.blade,this.view=e.view,this.viewProps=e.viewProps;var n=this.view.element;this.blade.emitter.on("change",(function(e){"positions"===e.propertyName&&(we().forEach((function(e){n.classList.remove(_e(void 0,e))})),t.blade.positions.forEach((function(e){n.classList.add(_e(void 0,e))})))})),this.blade.emitter.on("dispose",(function(){t.view.onDispose&&t.view.onDispose(),ye(n),t.onDispose()}))}return Object.defineProperty(e.prototype,"parent",{get:function(){return this.parent_},enumerable:!1,configurable:!0}),e.prototype.onDispose=function(){},e}(),Ce=L("lbl");function ke(e,t){var n=e.createDocumentFragment();return t.split("\n").map((function(t){return e.createTextNode(t)})).forEach((function(t,r){r>0&&n.appendChild(e.createElement("br")),n.appendChild(t)})),n}var Ee=function(){function e(e,t){var n=this;this.element=e.createElement("div"),this.element.classList.add(Ce()),z(t.viewProps,this.element);var r=e.createElement("div");r.classList.add(Ce("l")),R(t.props,"label",(function(t){s(t)?n.element.classList.add(Ce(void 0,"nol")):(n.element.classList.remove(Ce(void 0,"nol")),O(r),r.appendChild(ke(e,t)))})),this.element.appendChild(r),this.labelElement=r;var i=e.createElement("div");i.classList.add(Ce("v")),this.element.appendChild(i),this.valueElement=i}return e}(),Pe=function(e){function r(t,r){var i=this,o=r.valueController.viewProps;return(i=e.call(this,n(n({},r),{view:new Ee(t,{props:r.props,viewProps:o}),viewProps:o}))||this).props=r.props,i.valueController=r.valueController,i.view.valueElement.appendChild(i.valueController.view.element),i}return t(r,e),r.prototype.onDispose=function(){var e=this.valueController;e.onDispose&&e.onDispose(),e.view.onDispose&&e.view.onDispose()},r}(xe),Ae=function(){function e(e){this.controller_=e}return Object.defineProperty(e.prototype,"disabled",{get:function(){return this.controller_.viewProps.get("disabled")},set:function(e){this.controller_.viewProps.set("disabled",e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hidden",{get:function(){return this.controller_.viewProps.get("hidden")},set:function(e){this.controller_.viewProps.set("hidden",e)},enumerable:!1,configurable:!0}),e.prototype.dispose=function(){this.controller_.blade.dispose()},e}(),Ve=function(){function e(e){this.target=e}return e}(),Se=function(e){function n(t,n,r){var i=e.call(this,t)||this;return i.value=n,i.presetKey=r,i}return t(n,e),n}(Ve),Oe=function(e){function n(t,n,r){var i=e.call(this,t)||this;return i.value=n,i.presetKey=r,i}return t(n,e),n}(Ve),De=function(e){function n(t,n){var r=e.call(this,t)||this;return r.expanded=n,r}return t(n,e),n}(Ve),je=function(e){function n(t){var n=e.call(this,t)||this;return n.emitter_=new h,n.controller_.valueController.value.emitter.on("change",(function(e){n.emitter_.emit("change",{event:new Se(n,e.rawValue)})})),n}return t(n,e),Object.defineProperty(n.prototype,"label",{get:function(){return this.controller_.props.get("label")},set:function(e){this.controller_.props.set("label",e)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"options",{get:function(){return this.controller_.valueController.props.get("options")},set:function(e){this.controller_.valueController.props.set("options",e)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"value",{get:function(){return this.controller_.valueController.value.rawValue},set:function(e){this.controller_.valueController.value.rawValue=e},enumerable:!1,configurable:!0}),n.prototype.on=function(e,t){var n=t.bind(this);return this.emitter_.on(e,(function(e){n(e.event)})),this},n}(Ae),Le={id:"list",accept:function(e){if("list"!==J(e,"view"))return null;var t=e.value,n=te(e,"options");return s(t)||!n?null:{params:{label:J(e,"label"),options:a(n),value:a(t),view:"list"}}},api:function(e){var t=new q(e.document,{props:new Y({options:pe(e.params.options)}),value:new W(e.params.value),viewProps:e.viewProps}),n=new Pe(e.document,{blade:e.blade,props:new Y({label:e.params.label}),valueController:t});return new je(n)}},Te=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return t(n,e),Object.defineProperty(n.prototype,"disabled",{get:function(){return this.controller_.viewProps.get("disabled")},set:function(e){this.controller_.viewProps.set("disabled",e)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"hidden",{get:function(){return this.controller_.viewProps.get("hidden")},set:function(e){this.controller_.viewProps.set("hidden",e)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"label",{get:function(){return this.controller_.props.get("label")},set:function(e){this.controller_.props.set("label",e)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"title",{get:function(){return this.controller_.valueController.props.get("title")},set:function(e){this.controller_.valueController.props.set("title",e)},enumerable:!1,configurable:!0}),n.prototype.on=function(e,t){return this.controller_.valueController.emitter.on(e,a(t.bind(this))),this},n}(Ae),Fe=L("btn"),Me=function(){function e(e,t){this.element=e.createElement("div"),this.element.classList.add(Fe()),z(t.viewProps,this.element);var n=e.createElement("button");n.classList.add(Fe("b")),N(t.viewProps,n),H(t.props,"title",n),this.element.appendChild(n),this.buttonElement=n}return e}(),Be=function(){function e(e,t){this.emitter=new h,this.onButtonClick_=this.onButtonClick_.bind(this),this.props=t.props,this.viewProps=t.viewProps,this.view=new Me(e,{props:this.props,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("click",this.onButtonClick_)}return e.prototype.click=function(){this.emitter.emit("click",{sender:this})},e.prototype.onButtonClick_=function(){this.click()},e}(),Ie={id:"button",accept:function(e){if("button"!==J(e,"view"))return null;var t=J(e,"title");return void 0===t?null:{params:{label:J(e,"label"),title:t,view:"button"}}},api:function(e){var t=new Pe(e.document,{blade:e.blade,props:new Y({label:e.params.label}),valueController:new Be(e.document,{props:new Y({title:e.params.title}),viewProps:e.viewProps})});return new Te(t)}},Re=function(e){function n(t,n){var r=e.call(this,t,n)||this;return r.binding=n.binding,r}return t(n,e),n}(Pe),ze=function(e){function n(t,n){var r=e.call(this,t,n)||this;return r.binding=n.binding,N(r.viewProps,r.binding.ticker),r}return t(n,e),n.prototype.onDispose=function(){this.binding.dispose(),e.prototype.onDispose.call(this)},n}(Pe);function Ne(e,t){var r=e.accept(t.params);if(!r)return null;var i=$(t.params,"disabled"),o=$(t.params,"hidden");return e.api({blade:new m,document:t.document,params:a(n(n({},r.params),{disabled:i,hidden:o})),viewProps:ae({disabled:i,hidden:o})})}function Ue(e,t){var n=i.blades.reduce((function(n,r){return n||Ne(r,{document:e,params:t})}),null);if(!n)throw new c({type:"nomatchingview",context:{params:t}});return n}function He(e,t){return e.addBlade_v3_(n(n({},t),{view:"button"}))}function Ke(e,t){return e.addBlade_v3_(n(n({},t),{view:"folder"}))}function Ge(e,t){var r=t||{};return e.addBlade_v3_(n(n({},r),{view:"separator"}))}var qe=function(e){function n(t){var n=e.call(this,t)||this;return n.onBindingChange_=n.onBindingChange_.bind(n),n.emitter_=new h,n.controller_.binding.emitter.on("change",n.onBindingChange_),n}return t(n,e),n.prototype.on=function(e,t){var n=t.bind(this);return this.emitter_.on(e,(function(e){n(e.event)})),this},n.prototype.refresh=function(){this.controller_.binding.read()},n.prototype.onBindingChange_=function(e){var t=e.sender.target.read();this.emitter_.emit("change",{event:new Se(this,a(t),this.controller_.binding.target.presetKey)})},n}(Ae),We=function(){function e(e){this.onValueChange_=this.onValueChange_.bind(this),this.reader=e.reader,this.writer=e.writer,this.emitter=new h,this.value=e.value,this.value.emitter.on("change",this.onValueChange_),this.target=e.target,this.read()}return e.prototype.read=function(){var e=this.target.read();void 0!==e&&(this.value.rawValue=this.reader(e))},e.prototype.write_=function(e){this.writer(this.target,e)},e.prototype.onValueChange_=function(e){this.write_(e.rawValue),this.emitter.emit("change",{rawValue:e.rawValue,sender:this})},e}(),Ye=function(){function e(e,t){var n;this.constraint_=null==t?void 0:t.constraint,this.equals_=null!==(n=null==t?void 0:t.equals)&&void 0!==n?n:function(e,t){return e===t},this.emitter=new h,this.rawValue_=e}return Object.defineProperty(e.prototype,"constraint",{get:function(){return this.constraint_},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"rawValue",{get:function(){return this.rawValue_},set:function(e){var t=this.constraint_?this.constraint_.constrain(e):e;!this.equals_(this.rawValue_,t)&&(this.rawValue_=t,this.emitter.emit("change",{rawValue:t,sender:this}))},enumerable:!1,configurable:!0}),e}();function Qe(e,t){var n=e.accept(t.target.read(),t.params);if(null===n)return null;var r={target:t.target,initialValue:n,params:t.params},i=e.binding.reader(r),o=e.binding.constraint?e.binding.constraint(r):void 0,a=new Ye(i(n),{constraint:o,equals:e.binding.equals}),s=new We({reader:i,target:t.target,value:a,writer:e.binding.writer(r)}),u=e.controller({constraint:o,document:t.document,initialValue:n,params:t.params,value:s.value,viewProps:ae({disabled:t.params.disabled})});ge(u,e.id);var l=new m;return new Re(t.document,{binding:s,blade:l,props:new Y({label:t.params.label||t.target.key}),valueController:u})}function $e(e,t,n){if(s(t.read()))throw new c({context:{key:t.key},type:"nomatchingcontroller"});var r=i.inputs.reduce((function(r,i){return r||Qe(i,{document:e,target:t,params:n})}),null);if(r)return r;throw new c({context:{key:t.key},type:"nomatchingcontroller"})}var Xe=function(e){function n(t){var n=e.call(this,t)||this;return n.onBindingUpdate_=n.onBindingUpdate_.bind(n),n.emitter_=new h,n.controller_.binding.emitter.on("update",n.onBindingUpdate_),n}return t(n,e),n.prototype.on=function(e,t){var n=t.bind(this);return this.emitter_.on(e,(function(e){n(e.event)})),this},n.prototype.refresh=function(){this.controller_.binding.read()},n.prototype.onBindingUpdate_=function(e){var t=e.sender.target.read();this.emitter_.emit("update",{event:new Oe(this,a(t),this.controller_.binding.target.presetKey)})},n}(Ae);function Je(e,t){for(;e.length<t;)e.push(void 0)}function Ze(e){var t=[];return Je(t,e),new Ye(t)}function et(e){var t=e.indexOf(void 0);return a(t<0?e:e.slice(0,t))}function tt(e,t){var n=r(et(e),[t]);return n.length>e.length?n.splice(0,n.length-e.length):Je(n,e.length),n}var nt=function(){function e(e){this.onTick_=this.onTick_.bind(this),this.reader_=e.reader,this.target=e.target,this.emitter=new h,this.value=e.value,this.ticker=e.ticker,this.ticker.emitter.on("tick",this.onTick_),this.read()}return e.prototype.dispose=function(){this.ticker.disposable.dispose()},e.prototype.read=function(){var e=this.target.read();if(void 0!==e){var t=this.value.rawValue,n=this.reader_(e);this.value.rawValue=tt(t,n),this.emitter.emit("update",{rawValue:n,sender:this})}},e.prototype.onTick_=function(e){this.read()},e}(),rt=function(){function e(e,t){var n=this;this.disabled_=!1,this.timerId_=null,this.onTick_=this.onTick_.bind(this),this.doc_=e,this.emitter=new h,this.interval_=t,this.setTimer_(),this.disposable=new v,this.disposable.emitter.on("dispose",(function(){n.clearTimer_()}))}return Object.defineProperty(e.prototype,"disabled",{get:function(){return this.disabled_},set:function(e){this.disabled_=e,this.disabled_?this.clearTimer_():this.setTimer_()},enumerable:!1,configurable:!0}),e.prototype.clearTimer_=function(){if(null!==this.timerId_){var e=this.doc_.defaultView;e&&e.clearInterval(this.timerId_),this.timerId_=null}},e.prototype.setTimer_=function(){if(this.clearTimer_(),!(this.interval_<=0)){var e=this.doc_.defaultView;e&&(this.timerId_=e.setInterval(this.onTick_,this.interval_))}},e.prototype.onTick_=function(){this.disabled_||this.emitter.emit("tick",{sender:this})},e}(),it=function(){function e(){this.disabled=!1,this.disposable=new v,this.emitter=new h}return e.prototype.tick=function(){this.disabled||this.emitter.emit("tick",{sender:this})},e}(),ot={monitor:{defaultInterval:200,defaultLineCount:3}};function at(e,t){return 0===t?new it:new rt(e,null!=t?t:ot.monitor.defaultInterval)}function st(e,t){var n,r,i=e.accept(t.target.read(),t.params);if(null===i)return null;var o={target:t.target,initialValue:i,params:t.params},a=e.binding.reader(o),s=null!==(r=null!==(n=t.params.bufferSize)&&void 0!==n?n:e.binding.defaultBufferSize&&e.binding.defaultBufferSize(t.params))&&void 0!==r?r:1,u=new nt({reader:a,target:t.target,ticker:at(t.document,t.params.interval),value:Ze(s)}),l=e.controller({document:t.document,params:t.params,value:u.value,viewProps:ae({disabled:t.params.disabled})});ge(l,e.id);var c=new m;return new ze(t.document,{binding:u,blade:c,props:new Y({label:t.params.label||t.target.key}),valueController:l})}function ut(e,t,n){var r=i.monitors.reduce((function(r,i){return r||st(i,{document:e,params:n,target:t})}),null);if(r)return r;throw new c({context:{key:t.key},type:"nomatchingcontroller"})}var lt=function(){function e(e){this.emitter=new h,this.items_=[],this.cache_=new Set,this.onSubListAdd_=this.onSubListAdd_.bind(this),this.onSubListRemove_=this.onSubListRemove_.bind(this),this.extract_=e}return Object.defineProperty(e.prototype,"items",{get:function(){return this.items_},enumerable:!1,configurable:!0}),e.prototype.allItems=function(){return Array.from(this.cache_)},e.prototype.find=function(e){for(var t=0,n=this.allItems();t<n.length;t++){var r=n[t];if(e(r))return r}return null},e.prototype.add=function(e,t){var n=this;if(this.cache_.has(e))throw c.shouldNeverHappen();var r=void 0!==t?t:this.items_.length;this.items_.splice(r,0,e),this.cache_.add(e);var i=this.extract_(e);i&&(i.emitter.on("add",this.onSubListAdd_),i.emitter.on("remove",this.onSubListRemove_),i.allItems().forEach((function(e){n.cache_.add(e)}))),this.emitter.emit("add",{index:r,item:e,root:this,target:this})},e.prototype.remove=function(e){var t=this.items_.indexOf(e);if(!(t<0)){this.items_.splice(t,1),this.cache_.delete(e);var n=this.extract_(e);n&&(n.emitter.off("add",this.onSubListAdd_),n.emitter.off("remove",this.onSubListRemove_)),this.emitter.emit("remove",{item:e,root:this,target:this})}},e.prototype.onSubListAdd_=function(e){this.cache_.add(e.item),this.emitter.emit("add",{index:e.index,item:e.item,root:this,target:e.target})},e.prototype.onSubListRemove_=function(e){this.cache_.delete(e.item),this.emitter.emit("remove",{item:e.item,root:this,target:e.target})},e}(),ct=function(e){function n(t){var r=e.call(this,t)||this;r.onFolderChange_=r.onFolderChange_.bind(r),r.onRackRemove_=r.onRackRemove_.bind(r),r.onRackInputChange_=r.onRackInputChange_.bind(r),r.onRackFolderFold_=r.onRackFolderFold_.bind(r),r.onRackMonitorUpdate_=r.onRackMonitorUpdate_.bind(r),r.emitter_=new h,r.apiSet_=new lt((function(e){return e instanceof n?e.apiSet_:null})),r.controller_.folder.emitter.on("change",r.onFolderChange_);var i=r.controller_.bladeRack;return i.emitter.on("remove",r.onRackRemove_),i.emitter.on("inputchange",r.onRackInputChange_),i.emitter.on("monitorupdate",r.onRackMonitorUpdate_),i.emitter.on("folderfold",r.onRackFolderFold_),r}return t(n,e),Object.defineProperty(n.prototype,"expanded",{get:function(){return this.controller_.folder.expanded},set:function(e){this.controller_.folder.expanded=e},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"title",{get:function(){return this.controller_.props.get("title")},set:function(e){this.controller_.props.set("title",e)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"children",{get:function(){var e=this;return this.controller_.bladeRack.children.map((function(t){var n=e.apiSet_.find((function(e){return e.controller_===t}));if(null===n)throw c.shouldNeverHappen();return n}))},enumerable:!1,configurable:!0}),n.prototype.addInput=function(e,t,n){var r=n||{},i=$e(this.controller_.document,f(e,t,r.presetKey),r),o=new qe(i);return this.add(o,r.index)},n.prototype.addMonitor=function(e,t,n){var r=n||{},i=ut(this.controller_.document,f(e,t),r),o=new Xe(i);return a(this.add(o,r.index))},n.prototype.addFolder=function(e){return Ke(this,e)},n.prototype.addButton=function(e){return He(this,e)},n.prototype.addSeparator=function(e){return Ge(this,e)},n.prototype.add=function(e,t){return this.controller_.bladeRack.add(e.controller_,t),this.apiSet_.add(e),e},n.prototype.remove=function(e){this.controller_.bladeRack.remove(e.controller_)},n.prototype.addBlade_v3_=function(e){var t=null!=e?e:{},n=Ue(this.controller_.document,t);return this.add(n,t.index)},n.prototype.on=function(e,t){var n=t.bind(this);return this.emitter_.on(e,(function(e){n(e.event)})),this},n.prototype.onRackRemove_=function(e){var t=this.apiSet_.find((function(t){return t.controller_===e.bladeController}));t&&this.apiSet_.remove(t)},n.prototype.onRackInputChange_=function(e){var t=this.apiSet_.find((function(t){return t instanceof qe&&t.controller_===e.bindingController}));if(!t)throw c.shouldNeverHappen();var n=e.bindingController.binding;this.emitter_.emit("change",{event:new Se(t,a(n.target.read()),n.target.presetKey)})},n.prototype.onRackMonitorUpdate_=function(e){var t=this.apiSet_.find((function(t){return t instanceof Xe&&t.controller_===e.bindingController}));if(!t)throw c.shouldNeverHappen();var n=e.bindingController.binding;this.emitter_.emit("update",{event:new Oe(t,a(n.target.read()),n.target.presetKey)})},n.prototype.onRackFolderFold_=function(e){var t=this.apiSet_.find((function(t){return t instanceof n&&t.controller_===e.folderController}));if(!t)throw c.shouldNeverHappen();this.emitter_.emit("fold",{event:new De(t,e.folderController.folder.expanded)})},n.prototype.onFolderChange_=function(e){"expanded"===e.propertyName&&this.emitter_.emit("fold",{event:new De(this,e.sender.expanded)})},n}(Ae);function pt(e,t){for(var n=0;n<e.length;n++){var r=e[n];if(r instanceof Re&&r.binding===t)return r}return null}function ft(e,t){for(var n=0;n<e.length;n++){var r=e[n];if(r instanceof ze&&r.binding===t)return r}return null}function dt(e,t){for(var n=0;n<e.length;n++){var r=e[n];if(r instanceof gt&&r.folder===t)return r}return null}var ht=function(){function e(){this.onSetAdd_=this.onSetAdd_.bind(this),this.onSetRemove_=this.onSetRemove_.bind(this),this.onChildDispose_=this.onChildDispose_.bind(this),this.onChildLayout_=this.onChildLayout_.bind(this),this.onChildFolderFold_=this.onChildFolderFold_.bind(this),this.onChildInputChange_=this.onChildInputChange_.bind(this),this.onChildMonitorUpdate_=this.onChildMonitorUpdate_.bind(this),this.onChildViewPropsChange_=this.onChildViewPropsChange_.bind(this),this.onDescendantLayout_=this.onDescendantLayout_.bind(this),this.onDescendantFolderFold_=this.onDescendantFolderFold_.bind(this),this.onDescendantInputChange_=this.onDescendantInputChange_.bind(this),this.onDescendaantMonitorUpdate_=this.onDescendaantMonitorUpdate_.bind(this),this.bcSet_=new lt((function(e){return e instanceof gt?e.bladeRack.bcSet_:null})),this.emitter=new h,this.bcSet_.emitter.on("add",this.onSetAdd_),this.bcSet_.emitter.on("remove",this.onSetRemove_)}return Object.defineProperty(e.prototype,"children",{get:function(){return this.bcSet_.items},enumerable:!1,configurable:!0}),e.prototype.add=function(e,t){e.parent&&e.parent.remove(e),e.parent_=this,this.bcSet_.add(e,t)},e.prototype.remove=function(e){e.parent_=null,this.bcSet_.remove(e)},e.prototype.find=function(e){return a(this.bcSet_.allItems().filter((function(t){return t instanceof e})))},e.prototype.onSetAdd_=function(e){var t=e.target===e.root;if(this.emitter.emit("add",{bladeController:e.item,index:e.index,isRoot:t,sender:this}),t){var n=e.item;if(n.blade.emitter.on("dispose",this.onChildDispose_),n.viewProps.emitter.on("change",this.onChildViewPropsChange_),n.blade.emitter.on("change",this.onChildLayout_),n instanceof Re)n.binding.emitter.on("change",this.onChildInputChange_);else if(n instanceof ze)n.binding.emitter.on("update",this.onChildMonitorUpdate_);else if(n instanceof gt){n.folder.emitter.on("change",this.onChildFolderFold_);var r=n.bladeRack.emitter;r.on("folderfold",this.onDescendantFolderFold_),r.on("layout",this.onDescendantLayout_),r.on("inputchange",this.onDescendantInputChange_),r.on("monitorupdate",this.onDescendaantMonitorUpdate_)}}},e.prototype.onSetRemove_=function(e){var t=e.target===e.root;if(this.emitter.emit("remove",{bladeController:e.item,isRoot:t,sender:this}),t){var n=e.item;if(n instanceof Re)n.binding.emitter.off("change",this.onChildInputChange_);else if(n instanceof ze)n.binding.emitter.off("update",this.onChildMonitorUpdate_);else if(n instanceof gt){n.folder.emitter.off("change",this.onChildFolderFold_);var r=n.bladeRack.emitter;r.off("folderfold",this.onDescendantFolderFold_),r.off("layout",this.onDescendantLayout_),r.off("inputchange",this.onDescendantInputChange_),r.off("monitorupdate",this.onDescendaantMonitorUpdate_)}}},e.prototype.onChildLayout_=function(e){"positions"===e.propertyName&&this.emitter.emit("layout",{sender:this})},e.prototype.onChildViewPropsChange_=function(e){this.emitter.emit("layout",{sender:this})},e.prototype.onChildDispose_=function(e){var t=this;this.bcSet_.items.filter((function(e){return e.blade.disposed})).forEach((function(e){t.bcSet_.remove(e)}))},e.prototype.onChildInputChange_=function(e){var t=pt(this.find(Re),e.sender);if(!t)throw c.shouldNeverHappen();this.emitter.emit("inputchange",{bindingController:t,sender:this})},e.prototype.onChildMonitorUpdate_=function(e){var t=ft(this.find(ze),e.sender);if(!t)throw c.shouldNeverHappen();this.emitter.emit("monitorupdate",{bindingController:t,sender:this})},e.prototype.onChildFolderFold_=function(e){if("expanded"===e.propertyName){var t=dt(this.find(gt),e.sender);t&&this.emitter.emit("folderfold",{folderController:t,sender:this})}},e.prototype.onDescendantLayout_=function(e){this.emitter.emit("layout",{sender:this})},e.prototype.onDescendantInputChange_=function(e){this.emitter.emit("inputchange",{bindingController:e.bindingController,sender:this})},e.prototype.onDescendaantMonitorUpdate_=function(e){this.emitter.emit("monitorupdate",{bindingController:e.bindingController,sender:this})},e.prototype.onDescendantFolderFold_=function(e){this.emitter.emit("folderfold",{folderController:e.folderController,sender:this})},e}(),vt=function(){function e(e){this.emitter=new h,this.expanded_=e,this.expandedHeight_=null,this.temporaryExpanded_=null,this.shouldFixHeight_=!1}return Object.defineProperty(e.prototype,"expanded",{get:function(){return this.expanded_},set:function(e){this.expanded_!==e&&(this.emitter.emit("beforechange",{propertyName:"expanded",sender:this}),this.expanded_=e,this.emitter.emit("change",{propertyName:"expanded",sender:this}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"temporaryExpanded",{get:function(){return this.temporaryExpanded_},set:function(e){this.temporaryExpanded_!==e&&(this.emitter.emit("beforechange",{propertyName:"temporaryExpanded",sender:this}),this.temporaryExpanded_=e,this.emitter.emit("change",{propertyName:"temporaryExpanded",sender:this}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"expandedHeight",{get:function(){return this.expandedHeight_},set:function(e){this.expandedHeight_!==e&&(this.emitter.emit("beforechange",{propertyName:"expandedHeight",sender:this}),this.expandedHeight_=e,this.emitter.emit("change",{propertyName:"expandedHeight",sender:this}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"shouldFixHeight",{get:function(){return this.shouldFixHeight_},set:function(e){this.shouldFixHeight_!==e&&(this.emitter.emit("beforechange",{propertyName:"shouldFixHeight",sender:this}),this.shouldFixHeight_=e,this.emitter.emit("change",{propertyName:"shouldFixHeight",sender:this}))},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"styleExpanded",{get:function(){var e;return null!==(e=this.temporaryExpanded)&&void 0!==e?e:this.expanded},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"styleHeight",{get:function(){return this.styleExpanded?this.shouldFixHeight&&!s(this.expandedHeight)?this.expandedHeight+"px":"auto":"0"},enumerable:!1,configurable:!0}),e}(),mt=function(){function e(e,t){var n=this;this.onFolderChange_=this.onFolderChange_.bind(this),this.folder_=t.folder,this.folder_.emitter.on("change",this.onFolderChange_),this.className_=L(t.viewName||"fld"),this.element=e.createElement("div"),this.element.classList.add(this.className_()),z(t.viewProps,this.element);var r=e.createElement("button");r.classList.add(this.className_("b")),R(t.props,"title",(function(e){s(e)?n.element.classList.add(n.className_(void 0,"not")):n.element.classList.remove(n.className_(void 0,"not"))})),N(t.viewProps,r),this.element.appendChild(r),this.buttonElement=r;var i=e.createElement("div");i.classList.add(this.className_("t")),H(t.props,"title",i),this.buttonElement.appendChild(i),this.titleElement=i;var o=e.createElement("div");o.classList.add(this.className_("m")),this.buttonElement.appendChild(o);var a=e.createElement("div");a.classList.add(this.className_("c")),this.element.appendChild(a),this.containerElement=a,this.applyModel_()}return e.prototype.applyModel_=function(){var e=this.folder_.styleExpanded,t=this.className_(void 0,"expanded");e?this.element.classList.add(t):this.element.classList.remove(t),this.containerElement.style.height=this.folder_.styleHeight},e.prototype.onFolderChange_=function(){this.applyModel_()},e}();function bt(e,t){var n=0;return y(t,(function(){e.expandedHeight=null,e.temporaryExpanded=!0,g(t),n=t.clientHeight,e.temporaryExpanded=null,g(t)})),n}var gt=function(e){function r(t,r){var i,o=this,a=new vt(null===(i=r.expanded)||void 0===i||i);(o=e.call(this,n(n({},r),{view:new mt(t,{folder:a,props:r.props,viewName:r.viewName,viewProps:r.viewProps})}))||this).onContainerTransitionEnd_=o.onContainerTransitionEnd_.bind(o),o.onFolderBeforeChange_=o.onFolderBeforeChange_.bind(o),o.onTitleClick_=o.onTitleClick_.bind(o),o.onRackAdd_=o.onRackAdd_.bind(o),o.onRackLayout_=o.onRackLayout_.bind(o),o.onRackRemove_=o.onRackRemove_.bind(o),o.props=r.props,o.folder=a,o.folder.emitter.on("beforechange",o.onFolderBeforeChange_);var s=new ht;return s.emitter.on("add",o.onRackAdd_),s.emitter.on("layout",o.onRackLayout_),s.emitter.on("remove",o.onRackRemove_),o.bladeRack=s,o.view.buttonElement.addEventListener("click",o.onTitleClick_),o.view.containerElement.addEventListener("transitionend",o.onContainerTransitionEnd_),o}return t(r,e),Object.defineProperty(r.prototype,"document",{get:function(){return this.view.element.ownerDocument},enumerable:!1,configurable:!0}),r.prototype.onDispose=function(){for(var e=this.bladeRack.children.length-1;e>=0;e--)this.bladeRack.children[e].blade.dispose()},r.prototype.onFolderBeforeChange_=function(e){"expanded"===e.propertyName&&(s(this.folder.expandedHeight)&&(this.folder.expandedHeight=bt(this.folder,this.view.containerElement)),this.folder.shouldFixHeight=!0,g(this.view.containerElement))},r.prototype.onTitleClick_=function(){this.folder.expanded=!this.folder.expanded},r.prototype.applyRackChange_=function(){var e=this.bladeRack.children.filter((function(e){return!e.viewProps.get("hidden")})),t=e[0],n=e[e.length-1];this.bladeRack.children.forEach((function(e){var r=[];e===t&&r.push("first"),e===n&&r.push("last"),e.blade.positions=r}))},r.prototype.onRackAdd_=function(e){e.isRoot&&(A(this.view.containerElement,e.bladeController.view.element,e.index),this.applyRackChange_())},r.prototype.onRackRemove_=function(e){e.isRoot&&(V(e.bladeController.view.element),this.applyRackChange_())},r.prototype.onRackLayout_=function(e){this.applyRackChange_()},r.prototype.onContainerTransitionEnd_=function(e){"height"===e.propertyName&&(this.folder.shouldFixHeight=!1,this.folder.expandedHeight=null)},r}(xe),yt={id:"button",accept:function(e){var t=J(e,"title");return void 0===t||"folder"!==J(e,"view")?null:{params:{expanded:$(e,"expanded"),title:t,view:"folder"}}},api:function(e){var t=new gt(e.document,{blade:e.blade,expanded:e.params.expanded,props:new Y({title:e.params.title}),viewProps:e.viewProps});return new ct(t)}},wt=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return t(n,e),n}(Ae),_t=L("spr"),xt=function(){function e(e,t){this.element=e.createElement("div"),this.element.classList.add(_t()),z(t.viewProps,this.element);var n=e.createElement("hr");n.classList.add(_t("r")),this.element.appendChild(n)}return e}(),Ct=function(e){function r(t,r){return e.call(this,n(n({},r),{view:new xt(t,{viewProps:r.viewProps})}))||this}return t(r,e),r}(xe),kt={id:"separator",accept:function(e){return"separator"!==J(e,"view")?null:{params:{view:"separator"}}},api:function(e){var t=new Ct(e.document,{blade:e.blade,viewProps:e.viewProps});return new wt(t)}};function Et(e){return e.reduce((function(e,t){var n;return Object.assign(e,((n={})[t.presetKey]=t.read(),n))}),{})}function Pt(e,t){e.forEach((function(e){var n=t[e.presetKey];void 0!==n&&e.write(n)}))}var At=function(e){function n(t){return e.call(this,t)||this}return t(n,e),n.registerPlugin=function(e){d(e)},Object.defineProperty(n.prototype,"element",{get:function(){return this.controller_.view.element},enumerable:!1,configurable:!0}),n.prototype.importPreset=function(e){Pt(this.controller_.bladeRack.find(Re).map((function(e){return e.binding.target})),e),this.refresh()},n.prototype.exportPreset=function(){return Et(this.controller_.bladeRack.find(Re).map((function(e){return e.binding.target})))},n.prototype.refresh=function(){this.controller_.bladeRack.find(Re).forEach((function(e){e.binding.read()})),this.controller_.bladeRack.find(ze).forEach((function(e){e.binding.read()}))},n}(ct);function Vt(){[Ie,yt,kt].forEach((function(e){d({type:"blade",plugin:e})}))}Vt();var St=function(e){function n(t,n){return e.call(this,t,{expanded:n.expanded,blade:n.blade,props:n.props,viewProps:n.viewProps,viewName:"rot"})||this}return t(n,e),n}(gt),Ot=function(){function e(e){this.text=e}return e.prototype.evaluate=function(){return Number(this.text)},e.prototype.toString=function(){return this.text},e}(),Dt={"**":function(e,t){return Math.pow(e,t)},"*":function(e,t){return e*t},"/":function(e,t){return e/t},"%":function(e,t){return e%t},"+":function(e,t){return e+t},"-":function(e,t){return e-t},"<<":function(e,t){return e<<t},">>":function(e,t){return e>>t},">>>":function(e,t){return e>>>t},"&":function(e,t){return e&t},"^":function(e,t){return e^t},"|":function(e,t){return e|t}},jt=function(){function e(e,t,n){this.left=t,this.operator=e,this.right=n}return e.prototype.evaluate=function(){var e=Dt[this.operator];if(!e)throw new Error("unexpected binary operator: '"+this.operator);return e(this.left.evaluate(),this.right.evaluate())},e.prototype.toString=function(){return["b(",this.left.toString(),this.operator,this.right.toString(),")"].join(" ")},e}(),Lt={"+":function(e){return e},"-":function(e){return-e},"~":function(e){return~e}},Tt=function(){function e(e,t){this.operator=e,this.expression=t}return e.prototype.evaluate=function(){var e=Lt[this.operator];if(!e)throw new Error("unexpected unary operator: '"+this.operator);return e(this.expression.evaluate())},e.prototype.toString=function(){return["u(",this.operator,this.expression.toString(),")"].join(" ")},e}();function Ft(e){return function(t,n){for(var r=0;r<e.length;r++){var i=e[r](t,n);if(""!==i)return i}return""}}function Mt(e,t){var n,r=e.substr(t).match(/^\s+/);return null!==(n=r&&r[0])&&void 0!==n?n:""}function Bt(e,t){var n=e.substr(t,1);return n.match(/^[1-9]$/)?n:""}function It(e,t){var n,r=e.substr(t).match(/^[0-9]+/);return null!==(n=r&&r[0])&&void 0!==n?n:""}function Rt(e,t){var n=It(e,t);if(""!==n)return n;var r=e.substr(t,1);if("-"!==r&&"+"!==r)return"";var i=It(e,t+=1);return""===i?"":r+i}function zt(e,t){var n=e.substr(t,1);if(t+=1,"e"!==n.toLowerCase())return"";var r=Rt(e,t);return""===r?"":n+r}function Nt(e,t){var n=e.substr(t,1);if("0"===n)return n;var r=Bt(e,t);return t+=r.length,""===r?"":r+It(e,t)}function Ut(e,t){var n=Nt(e,t);if(t+=n.length,""===n)return"";var r=e.substr(t,1);if(t+=r.length,"."!==r)return"";var i=It(e,t);return n+r+i+zt(e,t+=i.length)}function Ht(e,t){var n=e.substr(t,1);if(t+=n.length,"."!==n)return"";var r=It(e,t);return t+=r.length,""===r?"":n+r+zt(e,t)}function Kt(e,t){var n=Nt(e,t);return t+=n.length,""===n?"":n+zt(e,t)}var Gt=Ft([Ut,Ht,Kt]);function qt(e,t){var n,r=e.substr(t).match(/^[01]+/);return null!==(n=r&&r[0])&&void 0!==n?n:""}function Wt(e,t){var n=e.substr(t,2);if(t+=n.length,"0b"!==n.toLowerCase())return"";var r=qt(e,t);return""===r?"":n+r}function Yt(e,t){var n,r=e.substr(t).match(/^[0-7]+/);return null!==(n=r&&r[0])&&void 0!==n?n:""}function Qt(e,t){var n=e.substr(t,2);if(t+=n.length,"0o"!==n.toLowerCase())return"";var r=Yt(e,t);return""===r?"":n+r}function $t(e,t){var n,r=e.substr(t).match(/^[0-9a-f]+/i);return null!==(n=r&&r[0])&&void 0!==n?n:""}function Xt(e,t){var n=e.substr(t,2);if(t+=n.length,"0x"!==n.toLowerCase())return"";var r=$t(e,t);return""===r?"":n+r}var Jt=Ft([Wt,Qt,Xt]),Zt=Ft([Jt,Gt]);function en(e,t){var n=Zt(e,t);return t+=n.length,""===n?null:{evaluable:new Ot(n),cursor:t}}function tn(e,t){var n=e.substr(t,1);if(t+=n.length,"("!==n)return null;var r=un(e,t);if(!r)return null;t=r.cursor,t+=Mt(e,t).length;var i=e.substr(t,1);return t+=i.length,")"!==i?null:{evaluable:r.evaluable,cursor:t}}function nn(e,t){return en(e,t)||tn(e,t)}function rn(e,t){var n=nn(e,t);if(n)return n;var r=e.substr(t,1);if(t+=r.length,"+"!==r&&"-"!==r&&"~"!==r)return null;var i=rn(e,t);return i?{cursor:t=i.cursor,evaluable:new Tt(r,i.evaluable)}:null}function on(e,t,n){n+=Mt(t,n).length;var r=e.filter((function(e){return t.startsWith(e,n)}))[0];return r?(n+=r.length,{cursor:n+=Mt(t,n).length,operator:r}):null}function an(e,t){return function(n,r){var i=e(n,r);if(!i)return null;r=i.cursor;for(var o=i.evaluable;;){var a=on(t,n,r);if(!a)break;r=a.cursor;var s=e(n,r);if(!s)return null;r=s.cursor,o=new jt(a.operator,o,s.evaluable)}return o?{cursor:r,evaluable:o}:null}}var sn=[["**"],["*","/","%"],["+","-"],["<<",">>>",">>"],["&"],["^"],["|"]].reduce((function(e,t){return an(e,t)}),rn);function un(e,t){return t+=Mt(e,t).length,sn(e,t)}function ln(e){var t=un(e,0);return t?t.cursor+Mt(e,t.cursor).length!==e.length?null:t.evaluable:null}function cn(e){var t,n=ln(e);return null!==(t=null==n?void 0:n.evaluate())&&void 0!==t?t:null}function pn(e){if("number"==typeof e)return e;if("string"==typeof e){var t=cn(e);if(!s(t))return t}return 0}function fn(e){return String(e)}function dn(e){return function(t){return t.toFixed(Math.max(Math.min(e,20),0))}}var hn=L("sldtxt"),vn=function(){function e(e,t){this.element=e.createElement("div"),this.element.classList.add(hn());var n=e.createElement("div");n.classList.add(hn("s")),this.sliderView_=t.sliderView,n.appendChild(this.sliderView_.element),this.element.appendChild(n);var r=e.createElement("div");r.classList.add(hn("t")),this.textView_=t.textView,r.appendChild(this.textView_.element),this.element.appendChild(r)}return e}();function mn(e,t){var n=e*(t.altKey?.1:1)*(t.shiftKey?10:1);return t.upKey?+n:t.downKey?-n:0}function bn(e){return{altKey:e.altKey,downKey:"ArrowDown"===e.key,shiftKey:e.shiftKey,upKey:"ArrowUp"===e.key}}function gn(e){return{altKey:e.altKey,downKey:"ArrowLeft"===e.key,shiftKey:e.shiftKey,upKey:"ArrowRight"===e.key}}function yn(e){return"ArrowUp"===e||"ArrowDown"===e}function wn(e){return yn(e)||"ArrowLeft"===e||"ArrowRight"===e}function _n(e,t){var n=t.ownerDocument.defaultView,r=t.getBoundingClientRect();return{x:e.pageX-((n&&n.scrollX||0)+r.left),y:e.pageY-((n&&n.scrollY||0)+r.top)}}var xn=function(){function e(e){this.onDocumentMouseMove_=this.onDocumentMouseMove_.bind(this),this.onDocumentMouseUp_=this.onDocumentMouseUp_.bind(this),this.onMouseDown_=this.onMouseDown_.bind(this),this.onTouchEnd_=this.onTouchEnd_.bind(this),this.onTouchMove_=this.onTouchMove_.bind(this),this.onTouchStart_=this.onTouchStart_.bind(this),this.elem_=e,this.emitter=new h,w(this.elem_.ownerDocument)?(e.addEventListener("touchstart",this.onTouchStart_),e.addEventListener("touchmove",this.onTouchMove_),e.addEventListener("touchend",this.onTouchEnd_)):e.addEventListener("mousedown",this.onMouseDown_)}return e.prototype.computePosition_=function(e){var t=this.elem_.getBoundingClientRect();return{bounds:{width:t.width,height:t.height},point:e?{x:e.x,y:e.y}:null}},e.prototype.onMouseDown_=function(e){var t;e.preventDefault(),null===(t=e.currentTarget)||void 0===t||t.focus();var n=this.elem_.ownerDocument;n.addEventListener("mousemove",this.onDocumentMouseMove_),n.addEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("down",{data:this.computePosition_(_n(e,this.elem_)),sender:this})},e.prototype.onDocumentMouseMove_=function(e){this.emitter.emit("move",{data:this.computePosition_(_n(e,this.elem_)),sender:this})},e.prototype.onDocumentMouseUp_=function(e){var t=this.elem_.ownerDocument;t.removeEventListener("mousemove",this.onDocumentMouseMove_),t.removeEventListener("mouseup",this.onDocumentMouseUp_),this.emitter.emit("up",{data:this.computePosition_(_n(e,this.elem_)),sender:this})},e.prototype.onTouchStart_=function(e){e.preventDefault();var t=e.targetTouches.item(0),n=this.elem_.getBoundingClientRect();this.emitter.emit("down",{data:this.computePosition_(t?{x:t.clientX-n.left,y:t.clientY-n.top}:void 0),sender:this})},e.prototype.onTouchMove_=function(e){var t=e.targetTouches.item(0),n=this.elem_.getBoundingClientRect();this.emitter.emit("move",{data:this.computePosition_(t?{x:t.clientX-n.left,y:t.clientY-n.top}:void 0),sender:this})},e.prototype.onTouchEnd_=function(e){var t=e.targetTouches.item(0),n=this.elem_.getBoundingClientRect();this.emitter.emit("up",{data:this.computePosition_(t?{x:t.clientX-n.left,y:t.clientY-n.top}:void 0),sender:this})},e}(),Cn=L("txt"),kn=function(){function e(e,t){this.onChange_=this.onChange_.bind(this),this.props_=t.props,this.props_.emitter.on("change",this.onChange_),this.element=e.createElement("div"),this.element.classList.add(Cn(),Cn(void 0,"num")),t.arrayPosition&&this.element.classList.add(Cn(void 0,t.arrayPosition)),z(t.viewProps,this.element);var n=e.createElement("input");n.classList.add(Cn("i")),n.type="text",N(t.viewProps,n),this.element.appendChild(n),this.inputElement=n,this.onDraggingChange_=this.onDraggingChange_.bind(this),this.dragging_=t.dragging,this.dragging_.emitter.on("change",this.onDraggingChange_),this.element.classList.add(Cn()),this.inputElement.classList.add(Cn("i"));var r=e.createElement("div");r.classList.add(Cn("k")),this.element.appendChild(r),this.knobElement=r;var i=e.createElementNS(b,"svg");i.classList.add(Cn("g")),this.knobElement.appendChild(i);var o=e.createElementNS(b,"path");o.classList.add(Cn("gb")),i.appendChild(o),this.guideBodyElem_=o;var a=e.createElementNS(b,"path");a.classList.add(Cn("gh")),i.appendChild(a),this.guideHeadElem_=a;var s=e.createElement("div");s.classList.add(L("tt")()),this.knobElement.appendChild(s),this.tooltipElem_=s,t.value.emitter.on("change",this.onChange_),this.value=t.value,this.update_()}return e.prototype.onDraggingChange_=function(e){if(null!==e.rawValue){this.element.classList.add(Cn(void 0,"drg"));var t=e.rawValue/this.props_.get("draggingScale"),n=t+(t>0?-1:t<0?1:0),r=le(-n,-4,4);this.guideHeadElem_.setAttributeNS(null,"d",["M "+(n+r)+",0 L"+n+",4 L"+(n+r)+",8","M "+t+",-1 L"+t+",9"].join(" ")),this.guideBodyElem_.setAttributeNS(null,"d","M 0,4 L"+t+",4");var i=this.props_.get("formatter");this.tooltipElem_.textContent=i(this.value.rawValue),this.tooltipElem_.style.left=t+"px"}else this.element.classList.remove(Cn(void 0,"drg"))},e.prototype.update_=function(){var e=this.props_.get("formatter");this.inputElement.value=e(this.value.rawValue)},e.prototype.onChange_=function(){this.update_()},e}(),En=function(){function e(e,t){this.originRawValue_=0,this.onInputChange_=this.onInputChange_.bind(this),this.onInputKeyDown_=this.onInputKeyDown_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.baseStep_=t.baseStep,this.parser_=t.parser,this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.dragging_=new Ye(null),this.view=new kn(e,{arrayPosition:t.arrayPosition,dragging:this.dragging_,props:this.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_),this.view.inputElement.addEventListener("keydown",this.onInputKeyDown_);var n=new xn(this.view.knobElement);n.emitter.on("down",this.onPointerDown_),n.emitter.on("move",this.onPointerMove_),n.emitter.on("up",this.onPointerUp_)}return e.prototype.onInputChange_=function(e){var t=a(e.currentTarget).value,n=this.parser_(t);s(n)||(this.value.rawValue=n)},e.prototype.onInputKeyDown_=function(e){var t=mn(this.baseStep_,bn(e));0!==t&&(this.value.rawValue+=t)},e.prototype.onPointerDown_=function(){this.originRawValue_=this.value.rawValue,this.dragging_.rawValue=0},e.prototype.onPointerMove_=function(e){if(e.data.point){var t=e.data.point.x-e.data.bounds.width/2;this.value.rawValue=this.originRawValue_+t*this.props.get("draggingScale"),this.dragging_.rawValue=this.value.rawValue-this.originRawValue_}},e.prototype.onPointerUp_=function(){this.dragging_.rawValue=null},e}(),Pn=L("sld"),An=function(){function e(e,t){this.onChange_=this.onChange_.bind(this),this.props_=t.props,this.props_.emitter.on("change",this.onChange_),this.element=e.createElement("div"),this.element.classList.add(Pn()),z(t.viewProps,this.element);var n=e.createElement("div");n.classList.add(Pn("t")),U(t.viewProps,n),this.element.appendChild(n),this.trackElement=n;var r=e.createElement("div");r.classList.add(Pn("k")),this.trackElement.appendChild(r),this.knobElement=r,t.value.emitter.on("change",this.onChange_),this.value=t.value,this.update_()}return e.prototype.update_=function(){var e=le(se(this.value.rawValue,this.props_.get("minValue"),this.props_.get("maxValue"),0,100),0,100);this.knobElement.style.width=e+"%"},e.prototype.onChange_=function(){this.update_()},e}(),Vn=function(){function e(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onPoint_=this.onPoint_.bind(this),this.baseStep_=t.baseStep,this.value=t.value,this.viewProps=t.viewProps,this.props=t.props,this.view=new An(e,{props:this.props,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new xn(this.view.trackElement),this.ptHandler_.emitter.on("down",this.onPoint_),this.ptHandler_.emitter.on("move",this.onPoint_),this.ptHandler_.emitter.on("up",this.onPoint_),this.view.trackElement.addEventListener("keydown",this.onKeyDown_)}return e.prototype.handlePointerEvent_=function(e){e.point&&(this.value.rawValue=se(le(e.point.x,0,e.bounds.width),0,e.bounds.width,this.props.get("minValue"),this.props.get("maxValue")))},e.prototype.onPoint_=function(e){this.handlePointerEvent_(e.data)},e.prototype.onKeyDown_=function(e){this.value.rawValue+=mn(this.baseStep_,gn(e))},e}(),Sn=function(){function e(e,t){this.value=t.value,this.viewProps=t.viewProps,this.sliderC_=new Vn(e,{baseStep:t.baseStep,props:t.sliderProps,value:t.value,viewProps:this.viewProps}),this.textC_=new En(e,{baseStep:t.baseStep,parser:t.parser,props:t.textProps,value:t.value,viewProps:t.viewProps}),this.view=new vn(e,{sliderView:this.sliderC_.view,textView:this.textC_.view})}return Object.defineProperty(e.prototype,"sliderController",{get:function(){return this.sliderC_},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"textController",{get:function(){return this.textC_},enumerable:!1,configurable:!0}),e}(),On=function(e){function n(t){var n=e.call(this,t)||this;return n.emitter_=new h,n.controller_.valueController.value.emitter.on("change",(function(e){n.emitter_.emit("change",{event:new Se(n,e.rawValue)})})),n}return t(n,e),Object.defineProperty(n.prototype,"label",{get:function(){return this.controller_.props.get("label")},set:function(e){this.controller_.props.set("label",e)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"maxValue",{get:function(){return this.controller_.valueController.sliderController.props.get("maxValue")},set:function(e){this.controller_.valueController.sliderController.props.set("maxValue",e)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"minValue",{get:function(){return this.controller_.valueController.sliderController.props.get("minValue")},set:function(e){this.controller_.valueController.sliderController.props.set("minValue",e)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"value",{get:function(){return this.controller_.valueController.value.rawValue},set:function(e){this.controller_.valueController.value.rawValue=e},enumerable:!1,configurable:!0}),n.prototype.on=function(e,t){var n=t.bind(this);return this.emitter_.on(e,(function(e){n(e.event)})),this},n}(Ae),Dn={id:"slider",accept:function(e){if("slider"!==J(e,"view"))return null;var t=X(e,"max"),n=X(e,"min");return void 0===t||void 0===n?null:{params:{format:a(Z(e,"format")),label:J(e,"label"),max:t,min:n,value:X(e,"value"),view:"slider"}}},api:function(e){var t,n,r=null!==(t=e.params.value)&&void 0!==t?t:0,i=new Sn(e.document,{baseStep:1,parser:cn,sliderProps:new Y({maxValue:e.params.max,minValue:e.params.min}),textProps:new Y({draggingScale:be(void 0,r),formatter:null!==(n=e.params.format)&&void 0!==n?n:fn}),value:new W(r),viewProps:e.viewProps}),o=new Pe(e.document,{blade:e.blade,props:new Y({label:e.params.label}),valueController:i});return new On(o)}},jn=L("txt"),Ln=function(){function e(e,t){this.onChange_=this.onChange_.bind(this),this.element=e.createElement("div"),this.element.classList.add(jn()),z(t.viewProps,this.element),this.props_=t.props,this.props_.emitter.on("change",this.onChange_);var n=e.createElement("input");n.classList.add(jn("i")),n.type="text",N(t.viewProps,n),this.element.appendChild(n),this.inputElement=n,t.value.emitter.on("change",this.onChange_),this.value_=t.value,this.update_()}return e.prototype.update_=function(){var e=this.props_.get("formatter");this.inputElement.value=e(this.value_.rawValue)},e.prototype.onChange_=function(){this.update_()},e}(),Tn=function(){function e(e,t){this.onInputChange_=this.onInputChange_.bind(this),this.parser_=t.parser,this.props=t.props,this.value=t.value,this.viewProps=t.viewProps,this.view=new Ln(e,{props:t.props,value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}return e.prototype.onInputChange_=function(e){var t=a(e.currentTarget).value,n=this.parser_(t);s(n)||(this.value.rawValue=n)},e}(),Fn=function(e){function n(t){var n=e.call(this,t)||this;return n.emitter_=new h,n.controller_.valueController.value.emitter.on("change",(function(e){n.emitter_.emit("change",{event:new Se(n,e.rawValue)})})),n}return t(n,e),Object.defineProperty(n.prototype,"label",{get:function(){return this.controller_.props.get("label")},set:function(e){this.controller_.props.set("label",e)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"formatter",{get:function(){return this.controller_.valueController.props.get("formatter")},set:function(e){this.controller_.valueController.props.set("formatter",e)},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"value",{get:function(){return this.controller_.valueController.value.rawValue},set:function(e){this.controller_.valueController.value.rawValue=e},enumerable:!1,configurable:!0}),n.prototype.on=function(e,t){var n=t.bind(this);return this.emitter_.on(e,(function(e){n(e.event)})),this},n}(Ae),Mn={id:"text",accept:function(e){if("text"!==J(e,"view"))return null;var t=Z(e,"parse"),n=e.value;return t&&n?{params:{format:a(Z(e,"format")),label:J(e,"label"),parse:a(t),value:a(n),view:"text"}}:null},api:function(e){var t,n=new Tn(e.document,{parser:e.params.parse,props:new Y({formatter:null!==(t=e.params.format)&&void 0!==t?t:function(e){return String(e)}}),value:new W(e.params.value),viewProps:e.viewProps}),r=new Pe(e.document,{blade:e.blade,props:new Y({label:e.params.label}),valueController:n});return new Fn(r)}};function Bn(e){return String(e)}function In(e){return"false"!==e&&!!e}function Rn(e){return Bn(e)}function zn(e,t){e.write(t)}var Nn=L("ckb"),Un=function(){function e(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.element=e.createElement("div"),this.element.classList.add(Nn()),z(t.viewProps,this.element);var n=e.createElement("label");n.classList.add(Nn("l")),this.element.appendChild(n);var r=e.createElement("input");r.classList.add(Nn("i")),r.type="checkbox",n.appendChild(r),this.inputElement=r,N(t.viewProps,this.inputElement);var i=e.createElement("div");i.classList.add(Nn("w")),n.appendChild(i);var o=P(e,"check");i.appendChild(o),t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.update_()}return e.prototype.update_=function(){this.inputElement.checked=this.value.rawValue},e.prototype.onValueChange_=function(){this.update_()},e}(),Hn=function(){function e(e,t){this.onInputChange_=this.onInputChange_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new Un(e,{value:this.value,viewProps:this.viewProps}),this.view.inputElement.addEventListener("change",this.onInputChange_)}return e.prototype.onInputChange_=function(e){var t=a(e.currentTarget);this.value.rawValue=t.checked},e}();function Kn(e){var t=[],n=fe(e);return n&&t.push(n),new ne(t)}var Gn={id:"input-bool",accept:function(e){return"boolean"==typeof e?e:null},binding:{reader:function(e){return In},constraint:function(e){return Kn(e.params)},writer:function(e){return zn}},controller:function(e){var t,n=e.document,r=e.value,i=e.constraint;return i&&re(i,ie)?new q(n,{props:new Y({options:null!==(t=de(i))&&void 0!==t?t:[]}),value:r,viewProps:e.viewProps}):new Hn(n,{value:r,viewProps:e.viewProps})}},qn=L("clswtxt"),Wn=function(){function e(e,t){this.element=e.createElement("div"),this.element.classList.add(qn());var n=e.createElement("div");n.classList.add(qn("s")),this.swatchView_=t.swatchView,n.appendChild(this.swatchView_.element),this.element.appendChild(n);var r=e.createElement("div");r.classList.add(qn("t")),this.textView=t.textView,r.appendChild(this.textView.element),this.element.appendChild(r)}return e}(),Yn=function(){function e(e){this.onValueChange_=this.onValueChange_.bind(this),this.mode_=e.rawValue.mode,this.value=e,this.value.emitter.on("change",this.onValueChange_),this.emitter=new h}return Object.defineProperty(e.prototype,"mode",{get:function(){return this.mode_},set:function(e){this.mode_!==e&&(this.mode_=e,this.emitter.emit("change",{propertyName:"mode",sender:this}))},enumerable:!1,configurable:!0}),e.prototype.onValueChange_=function(){this.emitter.emit("change",{propertyName:"value",sender:this})},e}(),Qn=dn(0);function $n(e){return Qn(e)+"%"}function Xn(e,t,n){var r=le(e/255,0,1),i=le(t/255,0,1),o=le(n/255,0,1),a=Math.max(r,i,o),s=Math.min(r,i,o),u=a-s,l=0,c=0,p=(s+a)/2;return 0!==u&&(c=u/(1-Math.abs(a+s-1)),l=(l=r===a?(i-o)/u:i===a?2+(o-r)/u:4+(r-i)/u)/6+(l<0?1:0)),[360*l,100*c,100*p]}function Jn(e,t,n){var r,i,o,a,s,u,l,c,p,f=(e%360+360)%360,d=le(t/100,0,1),h=le(n/100,0,1),v=(1-Math.abs(2*h-1))*d,m=v*(1-Math.abs(f/60%2-1)),b=h-v/2;return f>=0&&f<60?(l=(r=[v,m,0])[0],c=r[1],p=r[2]):f>=60&&f<120?(l=(i=[m,v,0])[0],c=i[1],p=i[2]):f>=120&&f<180?(l=(o=[0,v,m])[0],c=o[1],p=o[2]):f>=180&&f<240?(l=(a=[0,m,v])[0],c=a[1],p=a[2]):f>=240&&f<300?(l=(s=[m,0,v])[0],c=s[1],p=s[2]):(l=(u=[v,0,m])[0],c=u[1],p=u[2]),[255*(l+b),255*(c+b),255*(p+b)]}function Zn(e,t,n){var r=le(e/255,0,1),i=le(t/255,0,1),o=le(n/255,0,1),a=Math.max(r,i,o),s=a-Math.min(r,i,o);return[0===s?0:a===r?((i-o)/s%6+6)%6*60:a===i?60*((o-r)/s+2):60*((r-i)/s+4),100*(0===a?0:s/a),100*a]}function er(e,t,n){var r,i,o,a,s,u,l,c,p,f=ce(e,360),d=le(t/100,0,1),h=le(n/100,0,1),v=h*d,m=v*(1-Math.abs(f/60%2-1)),b=h-v;return f>=0&&f<60?(l=(r=[v,m,0])[0],c=r[1],p=r[2]):f>=60&&f<120?(l=(i=[m,v,0])[0],c=i[1],p=i[2]):f>=120&&f<180?(l=(o=[0,v,m])[0],c=o[1],p=o[2]):f>=180&&f<240?(l=(a=[0,m,v])[0],c=a[1],p=a[2]):f>=240&&f<300?(l=(s=[m,0,v])[0],c=s[1],p=s[2]):(l=(u=[v,0,m])[0],c=u[1],p=u[2]),[255*(l+b),255*(c+b),255*(p+b)]}function tr(e,t,n){var r=n+t*(100-Math.abs(2*n-100))/200;return[e,0!==r?t*(100-Math.abs(2*n-100))/r:0,n+t*(100-Math.abs(2*n-100))/200]}function nr(e,t,n){var r=100-Math.abs(n*(200-t)/100-100);return[e,0!==r?t*n/r:0,n*(200-t)/200]}function rr(e){return[e[0],e[1],e[2]]}function ir(e,t){return[e[0],e[1],e[2],t]}var or={hsl:{hsl:function(e,t,n){return[e,t,n]},hsv:tr,rgb:Jn},hsv:{hsl:nr,hsv:function(e,t,n){return[e,t,n]},rgb:er},rgb:{hsl:Xn,hsv:Zn,rgb:function(e,t,n){return[e,t,n]}}};function ar(e,t,n){var r;return(r=or[t])[n].apply(r,e)}var sr={hsl:function(e){var t;return[ce(e[0],360),le(e[1],0,100),le(e[2],0,100),le(null!==(t=e[3])&&void 0!==t?t:1,0,1)]},hsv:function(e){var t;return[ce(e[0],360),le(e[1],0,100),le(e[2],0,100),le(null!==(t=e[3])&&void 0!==t?t:1,0,1)]},rgb:function(e){var t;return[le(e[0],0,255),le(e[1],0,255),le(e[2],0,255),le(null!==(t=e[3])&&void 0!==t?t:1,0,1)]}};function ur(e,t){return"object"==typeof e&&!s(e)&&t in e&&"number"==typeof e[t]}var lr=function(){function e(e,t){this.mode_=t,this.comps_=sr[t](e)}return e.black=function(){return new e([0,0,0],"rgb")},e.fromObject=function(t){return new e("a"in t?[t.r,t.g,t.b,t.a]:[t.r,t.g,t.b],"rgb")},e.toRgbaObject=function(e){return e.toRgbaObject()},e.isRgbColorObject=function(e){return ur(e,"r")&&ur(e,"g")&&ur(e,"b")},e.isRgbaColorObject=function(e){return this.isRgbColorObject(e)&&ur(e,"a")},e.isColorObject=function(e){return this.isRgbColorObject(e)},e.equals=function(e,t){if(e.mode_!==t.mode_)return!1;for(var n=e.comps_,r=t.comps_,i=0;i<n.length;i++)if(n[i]!==r[i])return!1;return!0},Object.defineProperty(e.prototype,"mode",{get:function(){return this.mode_},enumerable:!1,configurable:!0}),e.prototype.getComponents=function(e){return ir(ar(rr(this.comps_),this.mode_,e||this.mode_),this.comps_[3])},e.prototype.toRgbaObject=function(){var e=this.getComponents("rgb");return{r:e[0],g:e[1],b:e[2],a:e[3]}},e}();function cr(e,t){var n=e.match(/^(.+)%$/);return n?Math.min(.01*parseFloat(n[1])*t,t):Math.min(parseFloat(e),t)}var pr={deg:function(e){return e},grad:function(e){return 360*e/400},rad:function(e){return 360*e/(2*Math.PI)},turn:function(e){return 360*e}};function fr(e){var t=e.match(/^([0-9.]+?)(deg|grad|rad|turn)$/);if(!t)return parseFloat(e);var n=parseFloat(t[1]),r=t[2];return pr[r](n)}var dr={"func.rgb":function(e){var t=e.match(/^rgb\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!t)return null;var n=[cr(t[1],255),cr(t[2],255),cr(t[3],255)];return isNaN(n[0])||isNaN(n[1])||isNaN(n[2])?null:new lr(n,"rgb")},"func.rgba":function(e){var t=e.match(/^rgba\(\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!t)return null;var n=[cr(t[1],255),cr(t[2],255),cr(t[3],255),cr(t[4],1)];return isNaN(n[0])||isNaN(n[1])||isNaN(n[2])||isNaN(n[3])?null:new lr(n,"rgb")},"func.hsl":function(e){var t=e.match(/^hsl\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!t)return null;var n=[fr(t[1]),cr(t[2],100),cr(t[3],100)];return isNaN(n[0])||isNaN(n[1])||isNaN(n[2])?null:new lr(n,"hsl")},"func.hsla":function(e){var t=e.match(/^hsla\(\s*([0-9A-Fa-f.]+(?:deg|grad|rad|turn)?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*,\s*([0-9A-Fa-f.]+%?)\s*\)$/);if(!t)return null;var n=[fr(t[1]),cr(t[2],100),cr(t[3],100),cr(t[4],1)];return isNaN(n[0])||isNaN(n[1])||isNaN(n[2])||isNaN(n[3])?null:new lr(n,"hsl")},"hex.rgb":function(e){var t=e.match(/^#([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(t)return new lr([parseInt(t[1]+t[1],16),parseInt(t[2]+t[2],16),parseInt(t[3]+t[3],16)],"rgb");var n=e.match(/^#([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return n?new lr([parseInt(n[1],16),parseInt(n[2],16),parseInt(n[3],16)],"rgb"):null},"hex.rgba":function(e){var t=e.match(/^#?([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])([0-9A-Fa-f])$/);if(t)return new lr([parseInt(t[1]+t[1],16),parseInt(t[2]+t[2],16),parseInt(t[3]+t[3],16),se(parseInt(t[4]+t[4],16),0,255,0,1)],"rgb");var n=e.match(/^#?([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})([0-9A-Fa-f]{2})$/);return n?new lr([parseInt(n[1],16),parseInt(n[2],16),parseInt(n[3],16),se(parseInt(n[4],16),0,255,0,1)],"rgb"):null}};function hr(e){return Object.keys(dr).reduce((function(t,n){return t||((0,dr[n])(e)?n:null)}),null)}var vr=function(e){var t=hr(e);return t?dr[t](e):null};function mr(e){return"func.hsla"===e||"func.rgba"===e||"hex.rgba"===e}function br(e){if("string"==typeof e){var t=vr(e);if(t)return t}return lr.black()}function gr(e){var t=le(Math.floor(e),0,255).toString(16);return 1===t.length?"0"+t:t}function yr(e){return"#"+rr(e.getComponents("rgb")).map(gr).join("")}function wr(e){var t=e.getComponents("rgb");return"#"+[t[0],t[1],t[2],255*t[3]].map(gr).join("")}function _r(e){var t=dn(0);return"rgb("+rr(e.getComponents("rgb")).map((function(e){return t(e)})).join(", ")+")"}function xr(e){var t=dn(2),n=dn(0);return"rgba("+e.getComponents("rgb").map((function(e,r){return(3===r?t:n)(e)})).join(", ")+")"}function Cr(e){var t=[dn(0),$n,$n];return"hsl("+rr(e.getComponents("hsl")).map((function(e,n){return t[n](e)})).join(", ")+")"}function kr(e){var t=[dn(0),$n,$n,dn(2)];return"hsla("+e.getComponents("hsl").map((function(e,n){return t[n](e)})).join(", ")+")"}var Er={"func.hsl":Cr,"func.hsla":kr,"func.rgb":_r,"func.rgba":xr,"hex.rgb":yr,"hex.rgba":wr};function Pr(e){return Er[e]}var Ar=L("clsw"),Vr=function(){function e(e,t){this.onValueChange_=this.onValueChange_.bind(this),t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.element=e.createElement("div"),this.element.classList.add(Ar()),z(t.viewProps,this.element);var n=e.createElement("div");n.classList.add(Ar("sw")),this.element.appendChild(n),this.swatchElem_=n;var r=e.createElement("button");r.classList.add(Ar("b")),N(t.viewProps,r),this.element.appendChild(r),this.buttonElement=r;var i=e.createElement("div");i.classList.add(Ar("p")),this.pickerView_=t.pickerView,i.appendChild(this.pickerView_.element),this.element.appendChild(i),this.update_()}return e.prototype.update_=function(){var e=this.value.rawValue;this.swatchElem_.style.backgroundColor=wr(e)},e.prototype.onValueChange_=function(){this.update_()},e}(),Sr=function(){function e(e){this.maxValue=e.max,this.minValue=e.min}return e.prototype.constrain=function(e){var t=e;return s(this.minValue)||(t=Math.max(t,this.minValue)),s(this.maxValue)||(t=Math.min(t,this.maxValue)),t},e}();function Or(e){var t=e.primary,n=e.secondary,r=e.forward,i=e.backward,o=!1;function a(e){o||(o=!0,e(),o=!1)}t.emitter.on("change",(function(){a((function(){n.rawValue=r(t,n)}))})),n.emitter.on("change",(function(){a((function(){t.rawValue=i(t,n)})),a((function(){n.rawValue=r(t,n)}))})),a((function(){n.rawValue=r(t,n)}))}var Dr=L("clp"),jr=function(){function e(e,t){this.alphaViews_=null,this.onFoldableChange_=this.onFoldableChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.pickedColor=t.pickedColor,this.pickedColor.value.emitter.on("change",this.onValueChange_),this.expanded_=t.expanded,this.expanded_.emitter.on("change",this.onFoldableChange_),this.element=e.createElement("div"),this.element.classList.add(Dr());var n=e.createElement("div");n.classList.add(Dr("hsv"));var r=e.createElement("div");r.classList.add(Dr("sv")),this.svPaletteView_=t.svPaletteView,r.appendChild(this.svPaletteView_.element),n.appendChild(r);var i=e.createElement("div");i.classList.add(Dr("h")),this.hPaletteView_=t.hPaletteView,i.appendChild(this.hPaletteView_.element),n.appendChild(i),this.element.appendChild(n);var o=e.createElement("div");if(o.classList.add(Dr("rgb")),this.textView_=t.textView,o.appendChild(this.textView_.element),this.element.appendChild(o),t.alphaViews){this.alphaViews_={palette:t.alphaViews.palette,text:t.alphaViews.text};var a=e.createElement("div");a.classList.add(Dr("a"));var s=e.createElement("div");s.classList.add(Dr("ap")),s.appendChild(this.alphaViews_.palette.element),a.appendChild(s);var u=e.createElement("div");u.classList.add(Dr("at")),u.appendChild(this.alphaViews_.text.element),a.appendChild(u),this.element.appendChild(a)}this.update_()}return Object.defineProperty(e.prototype,"allFocusableElements",{get:function(){var e=r([this.svPaletteView_.element,this.hPaletteView_.element],this.textView_.textViews.map((function(e){return e.inputElement})));return this.alphaViews_&&e.push(this.alphaViews_.palette.element,this.alphaViews_.text.inputElement),a(e)},enumerable:!1,configurable:!0}),e.prototype.update_=function(){this.expanded_.rawValue?this.element.classList.add(Dr(void 0,"expanded")):this.element.classList.remove(Dr(void 0,"expanded"))},e.prototype.onValueChange_=function(){this.update_()},e.prototype.onFoldableChange_=function(){this.update_()},e}();function Lr(e){return e?.1:1}var Tr=L("apl"),Fr=function(){function e(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(Tr()),U(t.viewProps,this.element);var n=e.createElement("div");n.classList.add(Tr("b")),this.element.appendChild(n);var r=e.createElement("div");r.classList.add(Tr("c")),n.appendChild(r),this.colorElem_=r;var i=e.createElement("div");i.classList.add(Tr("m")),this.element.appendChild(i),this.markerElem_=i;var o=e.createElement("div");o.classList.add(Tr("p")),this.markerElem_.appendChild(o),this.previewElem_=o,this.update_()}return e.prototype.update_=function(){var e=this.value.rawValue,t=e.getComponents("rgb"),n=new lr([t[0],t[1],t[2],0],"rgb"),r=new lr([t[0],t[1],t[2],255],"rgb"),i=["to right",xr(n),xr(r)];this.colorElem_.style.background="linear-gradient("+i.join(",")+")",this.previewElem_.style.backgroundColor=xr(e);var o=se(t[3],0,1,0,100);this.markerElem_.style.left=o+"%"},e.prototype.onValueChange_=function(){this.update_()},e}(),Mr=function(){function e(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new Fr(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new xn(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_)}return e.prototype.handlePointerEvent_=function(e){if(e.point){var t=e.point.x/e.bounds.width,n=this.value.rawValue.getComponents("hsv"),r=n[0],i=n[1],o=n[2];this.value.rawValue=new lr([r,i,o,t],"hsv")}},e.prototype.onPointerDown_=function(e){this.handlePointerEvent_(e.data)},e.prototype.onPointerMove_=function(e){this.handlePointerEvent_(e.data)},e.prototype.onPointerUp_=function(e){this.handlePointerEvent_(e.data)},e.prototype.onKeyDown_=function(e){var t=mn(Lr(!0),gn(e)),n=this.value.rawValue.getComponents("hsv"),r=n[0],i=n[1],o=n[2],a=n[3];this.value.rawValue=new lr([r,i,o,a+t],"hsv")},e}(),Br=L("cltxt");function Ir(e){var t=e.createElement("select"),n=[{text:"RGB",value:"rgb"},{text:"HSL",value:"hsl"},{text:"HSV",value:"hsv"}];return t.appendChild(n.reduce((function(t,n){var r=e.createElement("option");return r.textContent=n.text,r.value=n.value,t.appendChild(r),t}),e.createDocumentFragment())),t}var Rr=function(){function e(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.element=e.createElement("div"),this.element.classList.add(Br());var n=e.createElement("div");n.classList.add(Br("m")),this.modeElem_=Ir(e),this.modeElem_.classList.add(Br("ms")),n.appendChild(this.modeSelectElement);var r=e.createElement("div");r.classList.add(Br("mm")),r.appendChild(P(e,"dropdown")),n.appendChild(r),this.element.appendChild(n);var i=e.createElement("div");i.classList.add(Br("w")),this.element.appendChild(i),this.textsElem_=i,this.textViews_=t.textViews,this.applyTextViews_(),this.pickedColor=t.pickedColor,this.pickedColor.emitter.on("change",this.onValueChange_),this.update_()}return Object.defineProperty(e.prototype,"modeSelectElement",{get:function(){return this.modeElem_},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"textViews",{get:function(){return this.textViews_},set:function(e){this.textViews_=e,this.applyTextViews_()},enumerable:!1,configurable:!0}),e.prototype.update_=function(){this.modeElem_.value=this.pickedColor.mode},e.prototype.applyTextViews_=function(){var e=this;S(this.textsElem_);var t=this.element.ownerDocument;this.textViews_.forEach((function(n){var r=t.createElement("div");r.classList.add(Br("c")),r.appendChild(n.element),e.textsElem_.appendChild(r)}))},e.prototype.onValueChange_=function(){this.update_()},e}(),zr=dn(0),Nr={rgb:function(){return new Sr({min:0,max:255})},hsl:function(e){return new Sr(0===e?{min:0,max:360}:{min:0,max:100})},hsv:function(e){return new Sr(0===e?{min:0,max:360}:{min:0,max:100})}};function Ur(e,t,n){return new En(e,{arrayPosition:0===n?"fst":2===n?"lst":"mid",baseStep:Lr(!1),parser:t.parser,props:new Y({draggingScale:1,formatter:zr}),value:new Ye(0,{constraint:Nr[t.colorMode](n)}),viewProps:t.viewProps})}var Hr=function(){function e(e,t){this.onModeSelectChange_=this.onModeSelectChange_.bind(this),this.parser_=t.parser,this.pickedColor=t.pickedColor,this.viewProps=t.viewProps,this.ccs_=this.createComponentControllers_(e),this.view=new Rr(e,{pickedColor:this.pickedColor,textViews:[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view]}),this.view.modeSelectElement.addEventListener("change",this.onModeSelectChange_)}return Object.defineProperty(e.prototype,"value",{get:function(){return this.pickedColor.value},enumerable:!1,configurable:!0}),e.prototype.createComponentControllers_=function(e){var t=this,n={colorMode:this.pickedColor.mode,parser:this.parser_,viewProps:this.viewProps},r=[Ur(e,n,0),Ur(e,n,1),Ur(e,n,2)];return r.forEach((function(e,n){Or({primary:t.value,secondary:e.value,forward:function(e){return e.rawValue.getComponents(t.pickedColor.mode)[n]},backward:function(e,r){var i=t.pickedColor.mode,o=e.rawValue.getComponents(i);return o[n]=r.rawValue,new lr(ir(rr(o),o[3]),i)}})})),r},e.prototype.onModeSelectChange_=function(e){var t=e.currentTarget;this.pickedColor.mode=t.value,this.ccs_=this.createComponentControllers_(this.view.element.ownerDocument),this.view.textViews=[this.ccs_[0].view,this.ccs_[1].view,this.ccs_[2].view]},e}(),Kr=L("hpl"),Gr=function(){function e(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(Kr()),U(t.viewProps,this.element);var n=e.createElement("div");n.classList.add(Kr("c")),this.element.appendChild(n);var r=e.createElement("div");r.classList.add(Kr("m")),this.element.appendChild(r),this.markerElem_=r,this.update_()}return e.prototype.update_=function(){var e=this.value.rawValue.getComponents("hsv")[0];this.markerElem_.style.backgroundColor=_r(new lr([e,100,100],"hsv"));var t=se(e,0,360,0,100);this.markerElem_.style.left=t+"%"},e.prototype.onValueChange_=function(){this.update_()},e}(),qr=function(){function e(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new Gr(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new xn(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_)}return e.prototype.handlePointerEvent_=function(e){if(e.point){var t=se(e.point.x,0,e.bounds.width,0,360),n=this.value.rawValue.getComponents("hsv"),r=n[1],i=n[2],o=n[3];this.value.rawValue=new lr([t,r,i,o],"hsv")}},e.prototype.onPointerDown_=function(e){this.handlePointerEvent_(e.data)},e.prototype.onPointerMove_=function(e){this.handlePointerEvent_(e.data)},e.prototype.onPointerUp_=function(e){this.handlePointerEvent_(e.data)},e.prototype.onKeyDown_=function(e){var t=mn(Lr(!1),gn(e)),n=this.value.rawValue.getComponents("hsv"),r=n[0],i=n[1],o=n[2],a=n[3];this.value.rawValue=new lr([r+t,i,o,a],"hsv")},e}(),Wr=L("svp"),Yr=64,Qr=function(){function e(e,t){this.onValueChange_=this.onValueChange_.bind(this),this.value=t.value,this.value.emitter.on("change",this.onValueChange_),this.element=e.createElement("div"),this.element.classList.add(Wr()),U(t.viewProps,this.element);var n=e.createElement("canvas");n.height=Yr,n.width=Yr,n.classList.add(Wr("c")),this.element.appendChild(n),this.canvasElement=n;var r=e.createElement("div");r.classList.add(Wr("m")),this.element.appendChild(r),this.markerElem_=r,this.update_()}return e.prototype.update_=function(){var e=k(this.canvasElement);if(e){for(var t=this.value.rawValue.getComponents("hsv"),n=this.canvasElement.width,r=this.canvasElement.height,i=e.getImageData(0,0,n,r),o=i.data,a=0;a<r;a++)for(var s=0;s<n;s++){var u=se(s,0,n,0,100),l=se(a,0,r,100,0),c=er(t[0],u,l),p=4*(a*n+s);o[p]=c[0],o[p+1]=c[1],o[p+2]=c[2],o[p+3]=255}e.putImageData(i,0,0);var f=se(t[1],0,100,0,100);this.markerElem_.style.left=f+"%";var d=se(t[2],0,100,100,0);this.markerElem_.style.top=d+"%"}},e.prototype.onValueChange_=function(){this.update_()},e}(),$r=function(){function e(e,t){this.onKeyDown_=this.onKeyDown_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.view=new Qr(e,{value:this.value,viewProps:this.viewProps}),this.ptHandler_=new xn(this.view.element),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.element.addEventListener("keydown",this.onKeyDown_)}return e.prototype.handlePointerEvent_=function(e){if(e.point){var t=se(e.point.x,0,e.bounds.width,0,100),n=se(e.point.y,0,e.bounds.height,100,0),r=this.value.rawValue.getComponents("hsv"),i=r[0],o=r[3];this.value.rawValue=new lr([i,t,n,o],"hsv")}},e.prototype.onPointerDown_=function(e){this.handlePointerEvent_(e.data)},e.prototype.onPointerMove_=function(e){this.handlePointerEvent_(e.data)},e.prototype.onPointerUp_=function(e){this.handlePointerEvent_(e.data)},e.prototype.onKeyDown_=function(e){wn(e.key)&&e.preventDefault();var t=this.value.rawValue.getComponents("hsv"),n=t[0],r=t[1],i=t[2],o=t[3],a=Lr(!1);this.value.rawValue=new lr([n,r+mn(a,gn(e)),i+mn(a,bn(e)),o],"hsv")},e}(),Xr=function(){function e(e,t){var n=this;this.triggerElement=null,this.onFocusableElementBlur_=this.onFocusableElementBlur_.bind(this),this.onKeyDown_=this.onKeyDown_.bind(this),this.pickedColor=t.pickedColor,this.viewProps=t.viewProps,this.expanded=new W(!1),this.hPaletteIc_=new qr(e,{value:this.pickedColor.value,viewProps:this.viewProps}),this.svPaletteIc_=new $r(e,{value:this.pickedColor.value,viewProps:this.viewProps}),this.alphaIcs_=t.supportsAlpha?{palette:new Mr(e,{value:this.pickedColor.value,viewProps:this.viewProps}),text:new En(e,{parser:cn,baseStep:.1,props:new Y({draggingScale:.01,formatter:dn(2)}),value:new Ye(0,{constraint:new Sr({min:0,max:1})}),viewProps:this.viewProps})}:null,this.alphaIcs_&&Or({primary:this.pickedColor.value,secondary:this.alphaIcs_.text.value,forward:function(e){return e.rawValue.getComponents()[3]},backward:function(e,t){var n=e.rawValue.getComponents();return n[3]=t.rawValue,new lr(n,e.rawValue.mode)}}),this.tc_=new Hr(e,{parser:cn,pickedColor:this.pickedColor,viewProps:this.viewProps}),this.view=new jr(e,{alphaViews:this.alphaIcs_?{palette:this.alphaIcs_.palette.view,text:this.alphaIcs_.text.view}:null,expanded:this.expanded,hPaletteView:this.hPaletteIc_.view,pickedColor:this.pickedColor,supportsAlpha:t.supportsAlpha,svPaletteView:this.svPaletteIc_.view,textView:this.tc_.view}),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.allFocusableElements.forEach((function(e){e.addEventListener("blur",n.onFocusableElementBlur_)}))}return Object.defineProperty(e.prototype,"value",{get:function(){return this.pickedColor.value},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"textController",{get:function(){return this.tc_},enumerable:!1,configurable:!0}),e.prototype.onFocusableElementBlur_=function(e){var t=this.view.element,n=D(e);n&&t.contains(n)||n&&n===this.triggerElement&&!w(t.ownerDocument)||(this.expanded.rawValue=!1)},e.prototype.onKeyDown_=function(e){"Escape"===e.key&&(this.expanded.rawValue=!1)},e}(),Jr=function(){function e(e,t){this.onButtonBlur_=this.onButtonBlur_.bind(this),this.onButtonClick_=this.onButtonClick_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.pickerIc_=new Xr(e,{pickedColor:new Yn(this.value),supportsAlpha:t.supportsAlpha,viewProps:this.viewProps}),this.view=new Vr(e,{pickerView:this.pickerIc_.view,value:this.value,viewProps:this.viewProps}),this.view.buttonElement.addEventListener("blur",this.onButtonBlur_),this.view.buttonElement.addEventListener("click",this.onButtonClick_),this.pickerIc_.triggerElement=this.view.buttonElement}return e.prototype.onButtonBlur_=function(e){var t=this.view.element,n=a(e.relatedTarget);n&&t.contains(n)||(this.pickerIc_.expanded.rawValue=!1)},e.prototype.onButtonClick_=function(){this.pickerIc_.expanded.rawValue=!this.pickerIc_.expanded.rawValue,this.pickerIc_.expanded.rawValue&&this.pickerIc_.view.allFocusableElements[0].focus()},e}(),Zr=function(){function e(e,t){this.value=t.value,this.viewProps=t.viewProps,this.swatchIc_=new Jr(e,{supportsAlpha:t.supportsAlpha,value:this.value,viewProps:this.viewProps}),this.textIc_=new Tn(e,{parser:t.parser,props:new Y({formatter:t.formatter}),value:this.value,viewProps:this.viewProps}),this.view=new Wn(e,{swatchView:this.swatchIc_.view,textView:this.textIc_.view})}return e}();function ei(e){return lr.isColorObject(e)?lr.fromObject(e):lr.black()}function ti(e){return rr(e.getComponents("rgb")).reduce((function(e,t){return e<<8|255&Math.floor(t)}),0)}function ni(e){return e.getComponents("rgb").reduce((function(e,t,n){return e<<8|255&Math.floor(3===n?255*t:t)}),0)>>>0}function ri(e){return new lr([e>>16&255,e>>8&255,255&e],"rgb")}function ii(e){return new lr([e>>24&255,e>>16&255,e>>8&255,se(255&e,0,255,0,1)],"rgb")}function oi(e){return"number"!=typeof e?lr.black():ri(e)}function ai(e){return"number"!=typeof e?lr.black():ii(e)}function si(e){var t=Pr(e);return function(e,n){zn(e,t(n))}}function ui(e){var t=e?ni:ti;return function(e,n){zn(e,t(n))}}function li(e,t){var n=t.toRgbaObject();e.writeProperty("r",n.r),e.writeProperty("g",n.g),e.writeProperty("b",n.b),e.writeProperty("a",n.a)}function ci(e,t){var n=t.toRgbaObject();e.writeProperty("r",n.r),e.writeProperty("g",n.g),e.writeProperty("b",n.b)}function pi(e){return e?li:ci}function fi(e){return"input"in e&&"color.rgba"===e.input}var di={id:"input-color-number",accept:function(e,t){return"number"!=typeof e?null:"input"in t?"color"!==t.input&&"color.rgb"!==t.input&&"color.rgba"!==t.input?null:e:null},binding:{reader:function(e){return fi(e.params)?ai:oi},equals:lr.equals,writer:function(e){return ui(fi(e.params))}},controller:function(e){var t=fi(e.params),n=t?wr:yr;return new Zr(e.document,{formatter:n,parser:vr,supportsAlpha:t,value:e.value,viewProps:e.viewProps})}};function hi(e){return lr.isRgbaColorObject(e)}var vi={id:"input-color-object",accept:function(e,t){return lr.isColorObject(e)?e:null},binding:{reader:function(e){return ei},equals:lr.equals,writer:function(e){return pi(hi(e.initialValue))}},controller:function(e){var t=lr.isRgbaColorObject(e.initialValue),n=t?wr:yr;return new Zr(e.document,{formatter:n,parser:vr,supportsAlpha:t,value:e.value,viewProps:e.viewProps})}},mi={id:"input-color-string",accept:function(e,t){return"string"!=typeof e||"input"in t&&"string"===t.input?null:hr(e)?e:null},binding:{reader:function(e){return br},equals:lr.equals,writer:function(e){var t=hr(e.initialValue);if(!t)throw c.shouldNeverHappen();return si(t)}},controller:function(e){var t=hr(e.initialValue);if(!t)throw c.shouldNeverHappen();var n=Pr(t);return new Zr(e.document,{formatter:n,parser:vr,supportsAlpha:mr(t),value:e.value,viewProps:e.viewProps})}};function bi(e){return"step"in e&&!s(e.step)?new oe(e.step):null}function gi(e){return"max"in e&&!s(e.max)||"min"in e&&!s(e.min)?new Sr({max:e.max,min:e.min}):null}function yi(e){var t=[],n=bi(e);n&&t.push(n);var r=gi(e);r&&t.push(r);var i=fe(e);return i&&t.push(i),new ne(t)}function wi(e){var t=e?re(e,Sr):null;return t?[t.minValue,t.maxValue]:[void 0,void 0]}function _i(e){var t=wi(e),n=t[0],r=t[1];return[null!=n?n:0,null!=r?r:100]}var xi={id:"input-number",accept:function(e){return"number"==typeof e?e:null},binding:{reader:function(e){return pn},constraint:function(e){return yi(e.params)},writer:function(e){return zn}},controller:function(e){var t,n,r=e.value,i=e.constraint;if(i&&re(i,ie))return new q(e.document,{props:new Y({options:null!==(t=de(i))&&void 0!==t?t:[]}),value:r,viewProps:e.viewProps});var o=null!==(n="format"in e.params?e.params.format:void 0)&&void 0!==n?n:dn(ve(i,r.rawValue));if(i&&re(i,Sr)){var a=_i(i),s=a[0],u=a[1];return new Sn(e.document,{baseStep:me(i),parser:cn,sliderProps:new Y({maxValue:u,minValue:s}),textProps:new Y({draggingScale:be(i,r.rawValue),formatter:o}),value:r,viewProps:e.viewProps})}return new En(e.document,{baseStep:me(i),parser:cn,props:new Y({draggingScale:be(i,r.rawValue),formatter:o}),value:r,viewProps:e.viewProps})}},Ci=function(){function e(e){this.components=e.components,this.asm_=e.assembly}return e.prototype.constrain=function(e){var t=this,n=this.asm_.toComponents(e).map((function(e,n){var r,i;return null!==(i=null===(r=t.components[n])||void 0===r?void 0:r.constrain(e))&&void 0!==i?i:e}));return this.asm_.fromComponents(n)},e}(),ki=L("p2dtxt"),Ei=function(){function e(e,t){var n=this;this.textViews=t.textViews,this.element=e.createElement("div"),this.element.classList.add(ki()),this.textViews.forEach((function(t){var r=e.createElement("div");r.classList.add(ki("a")),r.appendChild(t.element),n.element.appendChild(r)}))}return e}();function Pi(e,t,n){return new En(e,{arrayPosition:0===n?"fst":n===t.axes.length-1?"lst":"mid",baseStep:t.axes[n].baseStep,parser:t.parser,props:t.axes[n].textProps,value:new Ye(0,{constraint:t.axes[n].constraint}),viewProps:t.viewProps})}var Ai=function(){function e(e,t){var n=this;this.value=t.value,this.viewProps=t.viewProps,this.acs_=t.axes.map((function(n,r){return Pi(e,t,r)})),this.acs_.forEach((function(e,r){Or({primary:n.value,secondary:e.value,forward:function(e){return t.assembly.toComponents(e.rawValue)[r]},backward:function(e,n){var i=t.assembly.toComponents(e.rawValue);return i[r]=n.rawValue,t.assembly.fromComponents(i)}})})),this.view=new Ei(e,{textViews:this.acs_.map((function(e){return e.view}))})}return e}(),Vi=function(){function e(e,t){void 0===e&&(e=0),void 0===t&&(t=0),this.x=e,this.y=t}return e.prototype.getComponents=function(){return[this.x,this.y]},e.isObject=function(e){if(s(e))return!1;var t=e.x,n=e.y;return"number"==typeof t&&"number"==typeof n},e.equals=function(e,t){return e.x===t.x&&e.y===t.y},e.prototype.toObject=function(){return{x:this.x,y:this.y}},e}(),Si={toComponents:function(e){return e.getComponents()},fromComponents:function(e){return new(Vi.bind.apply(Vi,r([void 0],e)))}},Oi=L("p2dpadtxt"),Di=function(){function e(e,t){this.element=e.createElement("div"),this.element.classList.add(Oi()),z(t.viewProps,this.element);var n=e.createElement("div");n.classList.add(Oi("w")),this.element.appendChild(n);var r=e.createElement("button");r.classList.add(Oi("b")),r.appendChild(P(e,"p2dpad")),N(t.viewProps,r),n.appendChild(r),this.padButtonElem_=r;var i=e.createElement("div");i.classList.add(Oi("p")),n.appendChild(i),this.padView_=t.padView,i.appendChild(this.padView_.element);var o=e.createElement("div");o.classList.add(Oi("t")),this.textView_=t.textView,o.appendChild(this.textView_.element),this.element.appendChild(o)}return Object.defineProperty(e.prototype,"padButtonElement",{get:function(){return this.padButtonElem_},enumerable:!1,configurable:!0}),e}(),ji=L("p2dpad"),Li=function(){function e(e,t){this.onFoldableChange_=this.onFoldableChange_.bind(this),this.onValueChange_=this.onValueChange_.bind(this),this.expanded_=t.expanded,this.expanded_.emitter.on("change",this.onFoldableChange_),this.invertsY_=t.invertsY,this.maxValue_=t.maxValue,this.element=e.createElement("div"),this.element.classList.add(ji());var n=e.createElement("div");n.classList.add(ji("p")),U(t.viewProps,n),this.element.appendChild(n),this.padElement=n;var r=e.createElementNS(b,"svg");r.classList.add(ji("g")),this.padElement.appendChild(r),this.svgElem_=r;var i=e.createElementNS(b,"line");i.classList.add(ji("ax")),i.setAttributeNS(null,"x1","0"),i.setAttributeNS(null,"y1","50%"),i.setAttributeNS(null,"x2","100%"),i.setAttributeNS(null,"y2","50%"),this.svgElem_.appendChild(i);var o=e.createElementNS(b,"line");o.classList.add(ji("ax")),o.setAttributeNS(null,"x1","50%"),o.setAttributeNS(null,"y1","0"),o.setAttributeNS(null,"x2","50%"),o.setAttributeNS(null,"y2","100%"),this.svgElem_.appendChild(o);var a=e.createElementNS(b,"line");a.classList.add(ji("l")),a.setAttributeNS(null,"x1","50%"),a.setAttributeNS(null,"y1","50%"),this.svgElem_.appendChild(a),this.lineElem_=a;var s=e.createElementNS(b,"circle");s.classList.add(ji("m")),s.setAttributeNS(null,"r","2px"),this.svgElem_.appendChild(s),this.markerElem_=s,t.value.emitter.on("change",this.onValueChange_),this.value=t.value,this.update_()}return Object.defineProperty(e.prototype,"allFocusableElements",{get:function(){return[this.padElement]},enumerable:!1,configurable:!0}),e.prototype.update_=function(){this.expanded_.rawValue?this.element.classList.add(ji(void 0,"expanded")):this.element.classList.remove(ji(void 0,"expanded"));var e=this.value.rawValue.getComponents(),t=e[0],n=e[1],r=this.maxValue_,i=se(t,-r,+r,0,100),o=se(n,-r,+r,0,100),a=this.invertsY_?100-o:o;this.lineElem_.setAttributeNS(null,"x2",i+"%"),this.lineElem_.setAttributeNS(null,"y2",a+"%"),this.markerElem_.setAttributeNS(null,"cx",i+"%"),this.markerElem_.setAttributeNS(null,"cy",a+"%")},e.prototype.onValueChange_=function(){this.update_()},e.prototype.onFoldableChange_=function(){this.update_()},e}(),Ti=function(){function e(e,t){var n=this;this.triggerElement=null,this.onFocusableElementBlur_=this.onFocusableElementBlur_.bind(this),this.onKeyDown_=this.onKeyDown_.bind(this),this.onPadKeyDown_=this.onPadKeyDown_.bind(this),this.onPointerDown_=this.onPointerDown_.bind(this),this.onPointerMove_=this.onPointerMove_.bind(this),this.onPointerUp_=this.onPointerUp_.bind(this),this.expanded=new W(!1),this.value=t.value,this.viewProps=t.viewProps,this.baseSteps_=t.baseSteps,this.maxValue_=t.maxValue,this.invertsY_=t.invertsY,this.view=new Li(e,{expanded:this.expanded,invertsY:this.invertsY_,maxValue:this.maxValue_,value:this.value,viewProps:this.viewProps}),this.ptHandler_=new xn(this.view.padElement),this.ptHandler_.emitter.on("down",this.onPointerDown_),this.ptHandler_.emitter.on("move",this.onPointerMove_),this.ptHandler_.emitter.on("up",this.onPointerUp_),this.view.padElement.addEventListener("keydown",this.onPadKeyDown_),this.view.element.addEventListener("keydown",this.onKeyDown_),this.view.allFocusableElements.forEach((function(e){e.addEventListener("blur",n.onFocusableElementBlur_)}))}return e.prototype.handlePointerEvent_=function(e){if(e.point){var t=this.maxValue_,n=se(e.point.x,0,e.bounds.width,-t,+t),r=se(this.invertsY_?e.bounds.height-e.point.y:e.point.y,0,e.bounds.height,-t,+t);this.value.rawValue=new Vi(n,r)}},e.prototype.onPointerDown_=function(e){this.handlePointerEvent_(e.data)},e.prototype.onPointerMove_=function(e){this.handlePointerEvent_(e.data)},e.prototype.onPointerUp_=function(e){this.handlePointerEvent_(e.data)},e.prototype.onPadKeyDown_=function(e){wn(e.key)&&e.preventDefault(),this.value.rawValue=new Vi(this.value.rawValue.x+mn(this.baseSteps_[0],gn(e)),this.value.rawValue.y+mn(this.baseSteps_[1],bn(e))*(this.invertsY_?1:-1))},e.prototype.onFocusableElementBlur_=function(e){var t=this.view.element,n=D(e);n&&t.contains(n)||n&&n===this.triggerElement&&!w(t.ownerDocument)||(this.expanded.rawValue=!1)},e.prototype.onKeyDown_=function(e){"Escape"===e.key&&(this.expanded.rawValue=!1)},e}(),Fi=function(){function e(e,t){this.onPadButtonBlur_=this.onPadButtonBlur_.bind(this),this.onPadButtonClick_=this.onPadButtonClick_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.padIc_=new Ti(e,{baseSteps:[t.axes[0].baseStep,t.axes[1].baseStep],invertsY:t.invertsY,maxValue:t.maxValue,value:this.value,viewProps:this.viewProps}),this.textIc_=new Ai(e,{assembly:Si,axes:t.axes,parser:t.parser,value:this.value,viewProps:this.viewProps}),this.view=new Di(e,{padView:this.padIc_.view,textView:this.textIc_.view,viewProps:this.viewProps}),this.view.padButtonElement.addEventListener("blur",this.onPadButtonBlur_),this.view.padButtonElement.addEventListener("click",this.onPadButtonClick_),this.padIc_.triggerElement=this.view.padButtonElement}return e.prototype.onPadButtonBlur_=function(e){var t=this.view.element,n=a(e.relatedTarget);n&&t.contains(n)||(this.padIc_.expanded.rawValue=!1)},e.prototype.onPadButtonClick_=function(){this.padIc_.expanded.rawValue=!this.padIc_.expanded.rawValue,this.padIc_.expanded.rawValue&&this.padIc_.view.allFocusableElements[0].focus()},e}();function Mi(e){return Vi.isObject(e)?new Vi(e.x,e.y):new Vi}function Bi(e,t){e.writeProperty("x",t.x),e.writeProperty("y",t.y)}function Ii(e){if(e){var t=[];return s(e.step)||t.push(new oe(e.step)),s(e.max)&&s(e.min)||t.push(new Sr({max:e.max,min:e.min})),new ne(t)}}function Ri(e){return new Ci({assembly:Si,components:[Ii("x"in e?e.x:void 0),Ii("y"in e?e.y:void 0)]})}function zi(e,t){var n=e&&re(e,Sr);if(n)return Math.max(Math.abs(n.minValue||0),Math.abs(n.maxValue||0));var r=me(e);return Math.max(10*Math.abs(r),10*Math.abs(t))}function Ni(e,t){var n=t instanceof Ci?t.components[0]:void 0,r=t instanceof Ci?t.components[1]:void 0,i=zi(n,e.x),o=zi(r,e.y);return Math.max(i,o)}function Ui(e,t){return{baseStep:me(t),constraint:t,textProps:new Y({draggingScale:be(t,e),formatter:dn(ve(t,e))})}}function Hi(e){if(!("y"in e))return!1;var t=e.y;return!!t&&"inverted"in t&&!!t.inverted}var Ki={id:"input-point2d",accept:function(e,t){return Vi.isObject(e)?e:null},binding:{reader:function(e){return Mi},constraint:function(e){return Ri(e.params)},equals:Vi.equals,writer:function(e){return Bi}},controller:function(e){var t=e.document,n=e.value,r=e.constraint;if(!(r instanceof Ci))throw c.shouldNeverHappen();return new Fi(t,{axes:[Ui(n.rawValue.x,r.components[0]),Ui(n.rawValue.y,r.components[1])],invertsY:Hi(e.params),maxValue:Ni(n.rawValue,r),parser:cn,value:n,viewProps:e.viewProps})}},Gi=function(){function e(e,t,n){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=0),this.x=e,this.y=t,this.z=n}return e.prototype.getComponents=function(){return[this.x,this.y,this.z]},e.isObject=function(e){if(s(e))return!1;var t=e.x,n=e.y,r=e.z;return"number"==typeof t&&"number"==typeof n&&"number"==typeof r},e.equals=function(e,t){return e.x===t.x&&e.y===t.y&&e.z===t.z},e.prototype.toObject=function(){return{x:this.x,y:this.y,z:this.z}},e}(),qi={toComponents:function(e){return e.getComponents()},fromComponents:function(e){return new(Gi.bind.apply(Gi,r([void 0],e)))}};function Wi(e){return Gi.isObject(e)?new Gi(e.x,e.y,e.z):new Gi}function Yi(e,t){e.writeProperty("x",t.x),e.writeProperty("y",t.y),e.writeProperty("z",t.z)}function Qi(e){if(e){var t=[];return s(e.step)||t.push(new oe(e.step)),s(e.max)&&s(e.min)||t.push(new Sr({max:e.max,min:e.min})),new ne(t)}}function $i(e){return new Ci({assembly:qi,components:[Qi("x"in e?e.x:void 0),Qi("y"in e?e.y:void 0),Qi("z"in e?e.z:void 0)]})}function Xi(e,t){return{baseStep:me(t),constraint:t,textProps:new Y({draggingScale:be(t,e),formatter:dn(ve(t,e))})}}var Ji={id:"input-point3d",accept:function(e,t){return Gi.isObject(e)?e:null},binding:{reader:function(e){return Wi},constraint:function(e){return $i(e.params)},equals:Gi.equals,writer:function(e){return Yi}},controller:function(e){var t=e.value,n=e.constraint;if(!(n instanceof Ci))throw c.shouldNeverHappen();return new Ai(e.document,{assembly:qi,axes:[Xi(t.rawValue.x,n.components[0]),Xi(t.rawValue.y,n.components[1]),Xi(t.rawValue.z,n.components[2])],parser:cn,value:t,viewProps:e.viewProps})}},Zi=function(){function e(e,t,n,r){void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=0),void 0===r&&(r=0),this.x=e,this.y=t,this.z=n,this.w=r}return e.prototype.getComponents=function(){return[this.x,this.y,this.z,this.w]},e.isObject=function(e){if(s(e))return!1;var t=e.x,n=e.y,r=e.z,i=e.w;return"number"==typeof t&&"number"==typeof n&&"number"==typeof r&&"number"==typeof i},e.equals=function(e,t){return e.x===t.x&&e.y===t.y&&e.z===t.z&&e.w===t.w},e.prototype.toObject=function(){return{x:this.x,y:this.y,z:this.z,w:this.w}},e}(),eo={toComponents:function(e){return e.getComponents()},fromComponents:function(e){return new(Zi.bind.apply(Zi,r([void 0],e)))}};function to(e){return Zi.isObject(e)?new Zi(e.x,e.y,e.z,e.w):new Zi}function no(e,t){e.writeProperty("x",t.x),e.writeProperty("y",t.y),e.writeProperty("z",t.z),e.writeProperty("w",t.w)}function ro(e){if(e){var t=[];return s(e.step)||t.push(new oe(e.step)),s(e.max)&&s(e.min)||t.push(new Sr({max:e.max,min:e.min})),new ne(t)}}function io(e){return new Ci({assembly:eo,components:[ro("x"in e?e.x:void 0),ro("y"in e?e.y:void 0),ro("z"in e?e.z:void 0),ro("w"in e?e.w:void 0)]})}function oo(e,t){return{baseStep:me(t),constraint:t,textProps:new Y({draggingScale:be(t,e),formatter:dn(ve(t,e))})}}var ao={id:"input-point4d",accept:function(e,t){return Zi.isObject(e)?e:null},binding:{reader:function(e){return to},constraint:function(e){return io(e.params)},equals:Zi.equals,writer:function(e){return no}},controller:function(e){var t=e.value,n=e.constraint;if(!(n instanceof Ci))throw c.shouldNeverHappen();return new Ai(e.document,{assembly:eo,axes:t.rawValue.getComponents().map((function(e,t){return oo(e,n.components[t])})),parser:cn,value:t,viewProps:e.viewProps})}};function so(e){return String(e)}function uo(e){return e}function lo(e){var t=[],n=fe(e);return n&&t.push(n),new ne(t)}var co={id:"input-string",accept:function(e,t){return"string"==typeof e?e:null},binding:{reader:function(e){return so},constraint:function(e){return lo(e.params)},writer:function(e){return zn}},controller:function(e){var t,n=e.document,r=e.value,i=e.constraint;return i&&re(i,ie)?new q(n,{props:new Y({options:null!==(t=de(i))&&void 0!==t?t:[]}),value:r,viewProps:e.viewProps}):new Tn(n,{parser:function(e){return e},props:new Y({formatter:uo}),value:r,viewProps:e.viewProps})}},po=function(){function e(e){var t=e.split("-"),n=t[0],r=t[1],i=n.split(".");this.major=parseInt(i[0],10),this.minor=parseInt(i[1],10),this.patch=parseInt(i[2],10),this.prerelease=null!=r?r:null}return e.prototype.toString=function(){var e=[this.major,this.minor,this.patch].join(".");return null!==this.prerelease?[e,this.prerelease].join("-"):e},e}(),fo=L("mll"),ho=function(){function e(e,t){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=t.formatter,this.element=e.createElement("div"),this.element.classList.add(fo()),z(t.viewProps,this.element);var n=e.createElement("textarea");n.classList.add(fo("i")),n.style.height="calc(var(--bld-h) * "+t.lineCount+")",n.readOnly=!0,N(t.viewProps,n),this.element.appendChild(n),this.textareaElem_=n,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}return e.prototype.update_=function(){var e=this,t=this.textareaElem_,n=t.scrollTop===t.scrollHeight-t.clientHeight,r=[];this.value.rawValue.forEach((function(t){void 0!==t&&r.push(e.formatter_(t))})),t.textContent=r.join("\n"),n&&(t.scrollTop=t.scrollHeight)},e.prototype.onValueUpdate_=function(){this.update_()},e}(),vo=function(){function e(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new ho(e,{formatter:t.formatter,lineCount:t.lineCount,value:this.value,viewProps:this.viewProps})}return e}(),mo=L("sgl"),bo=function(){function e(e,t){this.onValueUpdate_=this.onValueUpdate_.bind(this),this.formatter_=t.formatter,this.element=e.createElement("div"),this.element.classList.add(mo()),z(t.viewProps,this.element);var n=e.createElement("input");n.classList.add(mo("i")),n.readOnly=!0,n.type="text",N(t.viewProps,n),this.element.appendChild(n),this.inputElem_=n,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}return e.prototype.update_=function(){var e=this.value.rawValue,t=e[e.length-1];this.inputElem_.value=void 0!==t?this.formatter_(t):""},e.prototype.onValueUpdate_=function(){this.update_()},e}(),go=function(){function e(e,t){this.value=t.value,this.viewProps=t.viewProps,this.view=new bo(e,{formatter:t.formatter,value:this.value,viewProps:this.viewProps})}return e}(),yo={id:"monitor-bool",accept:function(e,t){return"boolean"==typeof e?e:null},binding:{reader:function(e){return In}},controller:function(e){var t;return 1===e.value.rawValue.length?new go(e.document,{formatter:Rn,value:e.value,viewProps:e.viewProps}):new vo(e.document,{formatter:Rn,lineCount:null!==(t=e.params.lineCount)&&void 0!==t?t:ot.monitor.defaultLineCount,value:e.value,viewProps:e.viewProps})}},wo=function(){function e(){this.emitter=new h,this.index_=-1}return Object.defineProperty(e.prototype,"index",{get:function(){return this.index_},set:function(e){this.index_!==e&&(this.index_=e,this.emitter.emit("change",{index:e,sender:this}))},enumerable:!1,configurable:!0}),e}(),_o=L("grl"),xo=function(){function e(e,t){this.onCursorChange_=this.onCursorChange_.bind(this),this.onValueUpdate_=this.onValueUpdate_.bind(this),this.element=e.createElement("div"),this.element.classList.add(_o()),z(t.viewProps,this.element),this.formatter_=t.formatter,this.minValue_=t.minValue,this.maxValue_=t.maxValue,this.cursor_=t.cursor,this.cursor_.emitter.on("change",this.onCursorChange_);var n=e.createElementNS(b,"svg");n.classList.add(_o("g")),n.style.height="calc(var(--bld-h) * "+t.lineCount+")",this.element.appendChild(n),this.svgElem_=n;var r=e.createElementNS(b,"polyline");this.svgElem_.appendChild(r),this.lineElem_=r;var i=e.createElement("div");i.classList.add(_o("t"),L("tt")()),this.element.appendChild(i),this.tooltipElem_=i,t.value.emitter.on("change",this.onValueUpdate_),this.value=t.value,this.update_()}return Object.defineProperty(e.prototype,"graphElement",{get:function(){return this.svgElem_},enumerable:!1,configurable:!0}),e.prototype.update_=function(){var e=this.svgElem_.getBoundingClientRect(),t=this.value.rawValue.length-1,n=this.minValue_,r=this.maxValue_,i=[];this.value.rawValue.forEach((function(o,a){if(void 0!==o){var s=se(a,0,t,0,e.width),u=se(o,n,r,e.height,0);i.push([s,u].join(","))}})),this.lineElem_.setAttributeNS(null,"points",i.join(" "));var o=this.tooltipElem_,a=this.value.rawValue[this.cursor_.index];if(void 0!==a){var s=se(this.cursor_.index,0,t,0,e.width),u=se(a,n,r,e.height,0);o.style.left=s+"px",o.style.top=u+"px",o.textContent=""+this.formatter_(a),o.classList.contains(_o("t","a"))||(o.classList.add(_o("t","a"),_o("t","in")),g(o),o.classList.remove(_o("t","in")))}else o.classList.remove(_o("t","a"))},e.prototype.onValueUpdate_=function(){this.update_()},e.prototype.onCursorChange_=function(){this.update_()},e}(),Co=function(){function e(e,t){if(this.onGraphMouseMove_=this.onGraphMouseMove_.bind(this),this.onGraphMouseLeave_=this.onGraphMouseLeave_.bind(this),this.onGraphPointerDown_=this.onGraphPointerDown_.bind(this),this.onGraphPointerMove_=this.onGraphPointerMove_.bind(this),this.onGraphPointerUp_=this.onGraphPointerUp_.bind(this),this.value=t.value,this.viewProps=t.viewProps,this.cursor_=new wo,this.view=new xo(e,{cursor:this.cursor_,formatter:t.formatter,lineCount:t.lineCount,maxValue:t.maxValue,minValue:t.minValue,value:this.value,viewProps:this.viewProps}),w(e)){var n=new xn(this.view.element);n.emitter.on("down",this.onGraphPointerDown_),n.emitter.on("move",this.onGraphPointerMove_),n.emitter.on("up",this.onGraphPointerUp_)}else this.view.element.addEventListener("mousemove",this.onGraphMouseMove_),this.view.element.addEventListener("mouseleave",this.onGraphMouseLeave_)}return e.prototype.onGraphMouseLeave_=function(){this.cursor_.index=-1},e.prototype.onGraphMouseMove_=function(e){var t=this.view.element.getBoundingClientRect();this.cursor_.index=Math.floor(se(e.offsetX,0,t.width,0,this.value.rawValue.length))},e.prototype.onGraphPointerDown_=function(e){this.onGraphPointerMove_(e)},e.prototype.onGraphPointerMove_=function(e){e.data.point?this.cursor_.index=Math.floor(se(e.data.point.x,0,e.data.bounds.width,0,this.value.rawValue.length)):this.cursor_.index=-1},e.prototype.onGraphPointerUp_=function(){this.cursor_.index=-1},e}();function ko(){return dn(2)}function Eo(e){var t;return 1===e.value.rawValue.length?new go(e.document,{formatter:ko(),value:e.value,viewProps:e.viewProps}):new vo(e.document,{formatter:ko(),lineCount:null!==(t=e.params.lineCount)&&void 0!==t?t:ot.monitor.defaultLineCount,value:e.value,viewProps:e.viewProps})}function Po(e){var t,n,r;return new Co(e.document,{formatter:ko(),lineCount:null!==(t=e.params.lineCount)&&void 0!==t?t:ot.monitor.defaultLineCount,maxValue:null!==(n="max"in e.params?e.params.max:null)&&void 0!==n?n:100,minValue:null!==(r="min"in e.params?e.params.min:null)&&void 0!==r?r:0,value:e.value,viewProps:e.viewProps})}function Ao(e){return"view"in e&&"graph"===e.view}var Vo={id:"monitor-number",accept:function(e,t){return"number"==typeof e?e:null},binding:{defaultBufferSize:function(e){return Ao(e)?64:1},reader:function(e){return pn}},controller:function(e){return Ao(e.params)?Po(e):Eo(e)}},So={id:"monitor-string",accept:function(e,t){return"string"==typeof e?e:null},binding:{reader:function(e){return so}},controller:function(e){var t,n=e.value;return n.rawValue.length>1||"multiline"in e.params&&e.params.multiline?new vo(e.document,{formatter:uo,lineCount:null!==(t=e.params.lineCount)&&void 0!==t?t:ot.monitor.defaultLineCount,value:n,viewProps:e.viewProps}):new go(e.document,{formatter:uo,value:n,viewProps:e.viewProps})}};function Oo(e){var t=e.createElement("div");return t.classList.add(L("dfw")()),e.body&&e.body.appendChild(t),t}function Do(e,t,n){if(!e.querySelector("style[data-tp-style="+t+"]")){var r=e.createElement("style");r.dataset.tpStyle=t,r.textContent=n,e.head.appendChild(r)}}function jo(e){Do(e,"default",".tp-lstv_s,.tp-btnv_b,.tp-p2dpadtxtv_b,.tp-fldv_b,.tp-rotv_b,.tp-clswv_sw,.tp-p2dpadv_p,.tp-txtv_i,.tp-grlv_g,.tp-sglv_i,.tp-mllv_i,.tp-ckbv_i,.tp-cltxtv_ms{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-lstv_s,.tp-btnv_b,.tp-p2dpadtxtv_b{background-color:var(--btn-bg);border-radius:var(--elm-br);color:var(--btn-fg);cursor:pointer;display:block;font-weight:bold;height:var(--bld-h);line-height:var(--bld-h);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.tp-lstv_s:hover,.tp-btnv_b:hover,.tp-p2dpadtxtv_b:hover{background-color:var(--btn-bg-h)}.tp-lstv_s:focus,.tp-btnv_b:focus,.tp-p2dpadtxtv_b:focus{background-color:var(--btn-bg-f)}.tp-lstv_s:active,.tp-btnv_b:active,.tp-p2dpadtxtv_b:active{background-color:var(--btn-bg-a)}.tp-lstv_s:disabled,.tp-btnv_b:disabled,.tp-p2dpadtxtv_b:disabled{opacity:0.5}.tp-fldv_b,.tp-rotv_b{background-color:var(--cnt-bg);color:var(--cnt-fg);cursor:pointer;display:block;height:calc(var(--bld-h) + 4px);line-height:calc(var(--bld-h) + 4px);overflow:hidden;padding-left:calc(var(--cnt-p) + 8px);padding-right:calc(2px * 2 + var(--bld-h) + var(--cnt-p));position:relative;text-align:left;text-overflow:ellipsis;white-space:nowrap;width:100%;transition:border-radius .2s ease-in-out .2s}.tp-fldv_b:hover,.tp-rotv_b:hover{background-color:var(--cnt-bg-h)}.tp-fldv_b:focus,.tp-rotv_b:focus{background-color:var(--cnt-bg-f)}.tp-fldv_b:active,.tp-rotv_b:active{background-color:var(--cnt-bg-a)}.tp-fldv_b:disabled,.tp-rotv_b:disabled{opacity:0.5}.tp-fldv_m,.tp-rotv_m{background:linear-gradient(to left, var(--cnt-fg), var(--cnt-fg) 2px, transparent 2px, transparent 4px, var(--cnt-fg) 4px);border-radius:2px;bottom:0;content:'';display:block;height:6px;right:calc(var(--cnt-p) + (var(--bld-h) + 4px - 6px) / 2 - 2px);margin:auto;opacity:0.5;position:absolute;top:0;transform:rotate(90deg);transition:transform .2s ease-in-out;width:6px}.tp-fldv.tp-fldv-expanded>.tp-fldv_b>.tp-fldv_m,.tp-rotv.tp-rotv-expanded .tp-rotv_m{transform:none}.tp-fldv_c,.tp-rotv_c{box-sizing:border-box;height:0;opacity:0;overflow:hidden;padding-bottom:0;padding-top:0;position:relative;transition:height .2s ease-in-out,opacity .2s linear,padding .2s ease-in-out}.tp-fldv_c>.tp-fldv.tp-v-first,.tp-rotv_c>.tp-fldv.tp-v-first{margin-top:calc(-1 * var(--cnt-p))}.tp-fldv_c>.tp-fldv.tp-v-last,.tp-rotv_c>.tp-fldv.tp-v-last{margin-bottom:calc(-1 * var(--cnt-p))}.tp-fldv_c>.tp-fldv.tp-v-last .tp-fldv_c,.tp-rotv_c>.tp-fldv.tp-v-last .tp-fldv_c{border-bottom-left-radius:0}.tp-fldv_c>.tp-fldv.tp-v-last .tp-fldv_b,.tp-rotv_c>.tp-fldv.tp-v-last .tp-fldv_b{border-bottom-left-radius:0}.tp-fldv_c>*:not(.tp-v-first),.tp-rotv_c>*:not(.tp-v-first){margin-top:var(--bld-s)}.tp-fldv_c>.tp-fldv:not(.tp-v-first),.tp-rotv_c>.tp-fldv:not(.tp-v-first),.tp-fldv_c>.tp-sprv:not(.tp-v-first),.tp-rotv_c>.tp-sprv:not(.tp-v-first){margin-top:var(--cnt-p)}.tp-fldv_c>.tp-fldv+*:not(.tp-v-hidden),.tp-rotv_c>.tp-fldv+*:not(.tp-v-hidden),.tp-fldv_c>.tp-sprv+*:not(.tp-v-hidden),.tp-rotv_c>.tp-sprv+*:not(.tp-v-hidden){margin-top:var(--cnt-p)}.tp-fldv_c>.tp-fldv:not(.tp-v-hidden)+.tp-fldv,.tp-rotv_c>.tp-fldv:not(.tp-v-hidden)+.tp-fldv,.tp-fldv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv,.tp-rotv_c>.tp-sprv:not(.tp-v-hidden)+.tp-sprv{margin-top:0}.tp-fldv.tp-fldv-expanded>.tp-fldv_c,.tp-rotv.tp-rotv-expanded .tp-rotv_c{opacity:1;padding-bottom:var(--cnt-p);padding-top:var(--cnt-p);transform:none;overflow:visible;transition:height .2s ease-in-out,opacity .2s linear .2s,padding .2s ease-in-out}.tp-clswv_sw,.tp-p2dpadv_p,.tp-txtv_i{background-color:var(--in-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--bld-h);line-height:var(--bld-h);min-width:0;width:100%}.tp-clswv_sw:hover,.tp-p2dpadv_p:hover,.tp-txtv_i:hover{background-color:var(--in-bg-h)}.tp-clswv_sw:focus,.tp-p2dpadv_p:focus,.tp-txtv_i:focus{background-color:var(--in-bg-f)}.tp-clswv_sw:active,.tp-p2dpadv_p:active,.tp-txtv_i:active{background-color:var(--in-bg-a)}.tp-clswv_sw:disabled,.tp-p2dpadv_p:disabled,.tp-txtv_i:disabled{opacity:0.5}.tp-cltxtv_m,.tp-lstv{position:relative}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-cltxtv_mm,.tp-lstv_m{bottom:0;margin:auto;pointer-events:none;position:absolute;right:2px;top:0}.tp-cltxtv_mm svg,.tp-lstv_m svg{bottom:0;height:16px;margin:auto;position:absolute;right:0;top:0;width:16px}.tp-cltxtv_mm svg path,.tp-lstv_m svg path{fill:currentColor}.tp-grlv_g,.tp-sglv_i,.tp-mllv_i{background-color:var(--mo-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--mo-fg);height:var(--bld-h);width:100%}.tp-clpv,.tp-p2dpadv{background-color:var(--bs-bg);border-radius:6px;box-shadow:0 2px 4px var(--bs-sh);display:none;max-width:168px;padding:var(--cnt-p);position:relative;visibility:hidden;z-index:1000}.tp-clpv.tp-clpv-expanded,.tp-p2dpadv.tp-p2dpadv-expanded{display:block;visibility:visible}.tp-cltxtv_w,.tp-p2dtxtv,.tp-p3dtxtv{display:flex}.tp-cltxtv_c,.tp-p2dtxtv_a,.tp-p3dtxtv_a{width:100%}.tp-cltxtv_c+.tp-cltxtv_c,.tp-p2dtxtv_a+.tp-cltxtv_c,.tp-p3dtxtv_a+.tp-cltxtv_c,.tp-cltxtv_c+.tp-p2dtxtv_a,.tp-p2dtxtv_a+.tp-p2dtxtv_a,.tp-p3dtxtv_a+.tp-p2dtxtv_a,.tp-cltxtv_c+.tp-p3dtxtv_a,.tp-p2dtxtv_a+.tp-p3dtxtv_a,.tp-p3dtxtv_a+.tp-p3dtxtv_a{margin-left:2px}.tp-btnv_b{width:100%}.tp-ckbv_l{display:block;position:relative}.tp-ckbv_i{left:0;opacity:0;position:absolute;top:0}.tp-ckbv_w{background-color:var(--in-bg);border-radius:var(--elm-br);cursor:pointer;display:block;height:var(--bld-h);position:relative;width:var(--bld-h)}.tp-ckbv_w svg{bottom:0;display:block;height:16px;left:0;margin:auto;opacity:0;position:absolute;right:0;top:0;width:16px}.tp-ckbv_w svg path{fill:none;stroke:var(--in-fg);stroke-width:2}.tp-ckbv_i:hover+.tp-ckbv_w{background-color:var(--in-bg-h)}.tp-ckbv_i:focus+.tp-ckbv_w{background-color:var(--in-bg-f)}.tp-ckbv_i:active+.tp-ckbv_w{background-color:var(--in-bg-a)}.tp-ckbv_i:checked+.tp-ckbv_w svg{opacity:1}.tp-ckbv.tp-v-disabled .tp-ckbv_w{opacity:0.5}.tp-clpv_h,.tp-clpv_ap{margin-left:6px;margin-right:6px}.tp-clpv_h{margin-top:var(--bld-s)}.tp-clpv_rgb{display:flex;margin-top:var(--bld-s);width:100%}.tp-clpv_a{display:flex;margin-top:var(--cnt-p);padding-top:calc(var(--cnt-p) + 2px);position:relative}.tp-clpv_a:before{background-color:var(--spr-fg);content:'';height:2px;left:calc(-1 * var(--cnt-p));position:absolute;right:calc(-1 * var(--cnt-p));top:0}.tp-clpv_ap{align-items:center;display:flex;flex:3}.tp-clpv_at{flex:1;margin-left:4px}.tp-svpv{border-radius:var(--elm-br);outline:none;overflow:hidden;position:relative}.tp-svpv_c{cursor:crosshair;display:block;height:calc(var(--bld-h) * 4);width:100%}.tp-svpv_m{border-radius:100%;border:rgba(255,255,255,0.75) solid 2px;box-sizing:border-box;filter:drop-shadow(0 0 1px rgba(0,0,0,0.3));height:12px;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;width:12px}.tp-svpv:focus .tp-svpv_m{border-color:#fff}.tp-hplv{cursor:pointer;height:var(--bld-h);outline:none;position:relative}.tp-hplv_c{background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAAABCAYAAABubagXAAAAQ0lEQVQoU2P8z8Dwn0GCgQEDi2OK/RBgYHjBgIpfovFh8j8YBIgzFGQxuqEgPhaDOT5gOhPkdCxOZeBg+IDFZZiGAgCaSSMYtcRHLgAAAABJRU5ErkJggg==);background-position:left top;background-repeat:no-repeat;background-size:100% 100%;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;position:absolute;top:50%;width:100%}.tp-hplv_m{border-radius:var(--elm-br);border:rgba(255,255,255,0.75) solid 2px;box-shadow:0 0 2px rgba(0,0,0,0.1);box-sizing:border-box;height:12px;left:50%;margin-left:-6px;margin-top:-6px;pointer-events:none;position:absolute;top:50%;width:12px}.tp-hplv:focus .tp-hplv_m{border-color:#fff}.tp-aplv{cursor:pointer;height:var(--bld-h);outline:none;position:relative;width:100%}.tp-aplv_b{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:4px 4px;background-position:0 0,2px 2px;border-radius:2px;display:block;height:4px;left:0;margin-top:-2px;overflow:hidden;position:absolute;top:50%;width:100%}.tp-aplv_c{bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv_m{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:12px 12px;background-position:0 0,6px 6px;border-radius:var(--elm-br);box-shadow:0 0 2px rgba(0,0,0,0.1);height:12px;left:50%;margin-left:-6px;margin-top:-6px;overflow:hidden;pointer-events:none;position:absolute;top:50%;width:12px}.tp-aplv_p{border-radius:var(--elm-br);border:rgba(255,255,255,0.75) solid 2px;box-sizing:border-box;bottom:0;left:0;position:absolute;right:0;top:0}.tp-aplv:focus .tp-aplv_p{border-color:#fff}.tp-clswv{background-color:#fff;background-image:linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%),linear-gradient(to top right, #ddd 25%, transparent 25%, transparent 75%, #ddd 75%);background-size:10px 10px;background-position:0 0,5px 5px;border-radius:var(--elm-br)}.tp-clswv.tp-v-disabled{opacity:0.5}.tp-clswv_b{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border-width:0;cursor:pointer;display:block;height:var(--bld-h);left:0;margin:0;outline:none;padding:0;position:absolute;top:0;width:var(--bld-h)}.tp-clswv_b:focus::after{border:rgba(255,255,255,0.75) solid 2px;border-radius:var(--elm-br);bottom:0;content:'';display:block;left:0;position:absolute;right:0;top:0}.tp-clswv_p{left:calc(-1 * var(--cnt-p));position:absolute;right:calc(-1 * var(--cnt-p));top:var(--bld-h)}.tp-clswtxtv{display:flex;position:relative}.tp-clswtxtv_s{flex-grow:0;flex-shrink:0;width:var(--bld-h)}.tp-clswtxtv_t{flex:1;margin-left:4px}.tp-cltxtv{display:flex;width:100%}.tp-cltxtv_m{margin-right:4px}.tp-cltxtv_ms{border-radius:var(--elm-br);color:var(--lbl-fg);cursor:pointer;height:var(--bld-h);line-height:var(--bld-h);padding:0 18px 0 4px}.tp-cltxtv_ms:hover{background-color:var(--in-bg-h)}.tp-cltxtv_ms:focus{background-color:var(--in-bg-f)}.tp-cltxtv_ms:active{background-color:var(--in-bg-a)}.tp-cltxtv_mm{color:var(--lbl-fg)}.tp-cltxtv_w{flex:1}.tp-dfwv{position:absolute;top:8px;right:8px;width:256px}.tp-fldv.tp-fldv-not .tp-fldv_b{display:none}.tp-fldv.tp-fldv-expanded .tp-fldv_b{transition:border-radius 0s}.tp-fldv_c{border-left:var(--cnt-bg) solid 4px}.tp-fldv_b:hover+.tp-fldv_c{border-left-color:var(--cnt-bg-h)}.tp-fldv_b:focus+.tp-fldv_c{border-left-color:var(--cnt-bg-f)}.tp-fldv_b:active+.tp-fldv_c{border-left-color:var(--cnt-bg-a)}.tp-fldv_c>.tp-fldv{margin-left:4px}.tp-fldv_c>.tp-fldv>.tp-fldv_b{border-top-left-radius:var(--elm-br);border-bottom-left-radius:var(--elm-br)}.tp-fldv_c>.tp-fldv.tp-fldv-expanded>.tp-fldv_b{border-bottom-left-radius:0}.tp-fldv_c .tp-fldv>.tp-fldv_c{border-bottom-left-radius:var(--elm-br)}.tp-grlv{position:relative}.tp-grlv_g{display:block;height:calc(var(--bld-h) * 3)}.tp-grlv_g polyline{fill:none;stroke:var(--mo-fg);stroke-linejoin:round}.tp-grlv_t{margin-top:-4px;transition:left 0.05s, top 0.05s;visibility:hidden}.tp-grlv_t.tp-grlv_t-a{visibility:visible}.tp-grlv_t.tp-grlv_t-in{transition:none}.tp-grlv.tp-v-disabled .tp-grlv_g{opacity:0.5}.tp-grlv .tp-ttv{background-color:var(--mo-fg)}.tp-grlv .tp-ttv::before{border-top-color:var(--mo-fg)}.tp-lblv{align-items:center;display:flex;line-height:1.3;padding-left:var(--cnt-p);padding-right:var(--cnt-p)}.tp-lblv.tp-lblv-nol{display:block}.tp-lblv_l{color:var(--lbl-fg);flex:1;-webkit-hyphens:auto;-ms-hyphens:auto;hyphens:auto;overflow:hidden;padding-left:4px;padding-right:16px}.tp-lblv.tp-v-disabled .tp-lblv_l{opacity:0.5}.tp-lblv.tp-lblv-nol .tp-lblv_l{display:none}.tp-lblv_v{align-self:flex-start;flex-grow:0;flex-shrink:0;width:var(--value-width)}.tp-lblv.tp-lblv-nol .tp-lblv_v{width:100%}.tp-lstv_s{padding:0 20px 0 4px;width:100%}.tp-lstv.tp-v-disabled .tp-lstv_s{opacity:0.5}.tp-lstv_m{color:var(--btn-fg)}.tp-sglv_i{padding:0 4px}.tp-sglv.tp-v-disabled .tp-sglv_i{opacity:0.5}.tp-mllv_i{display:block;height:calc(var(--bld-h) * 3);line-height:var(--bld-h);padding:0 4px;resize:none;white-space:pre}.tp-mllv.tp-v-disabled .tp-mllv_i{opacity:0.5}.tp-p2dpadv{padding-left:calc(var(--cnt-p) + 4px + var(--bld-h))}.tp-p2dpadv_p{cursor:crosshair;height:0;overflow:hidden;padding-bottom:100%;position:relative}.tp-p2dpadv_g{display:block;height:100%;left:0;pointer-events:none;position:absolute;top:0;width:100%}.tp-p2dpadv_ax{opacity:0.1;stroke:var(--in-fg)}.tp-p2dpadv_l{stroke:var(--in-fg);stroke-dasharray:2px 2px}.tp-p2dpadv_m{fill:var(--in-fg)}.tp-p2dpadtxtv{display:flex;position:relative}.tp-p2dpadtxtv_b{height:var(--bld-h);position:relative;width:var(--bld-h)}.tp-p2dpadtxtv_b svg{display:block;height:16px;left:50%;margin-left:-8px;margin-top:-8px;position:absolute;top:50%;width:16px}.tp-p2dpadtxtv_b svg path{stroke:currentColor;stroke-width:2}.tp-p2dpadtxtv_b svg circle{fill:currentColor}.tp-p2dpadtxtv_p{left:calc(-1 * var(--cnt-p));position:absolute;right:calc(-1 * var(--cnt-p));top:var(--bld-h)}.tp-p2dpadtxtv_t{margin-left:4px}.tp-rotv{--font-family: var(--tp-font-family, Roboto Mono,Source Code Pro,Menlo,Courier,monospace);--bs-br: var(--tp-base-border-radius-v3, 6px);--cnt-p: var(--tp-container-padding-v3, 4px);--elm-br: var(--tp-element-border-radius-v3, 2px);--bld-h: var(--tp-blade-height-v3, 20px);--bld-s: var(--tp-blade-spacing-v3, 4px);--value-width: var(--tp-value-width-v3, 160px);--bs-bg: var(--tp-base-background-color, #2f3137);--bs-sh: var(--tp-base-shadow-color, rgba(0,0,0,0.2));--btn-bg: var(--tp-button-background-color, #adafb8);--btn-bg-a: var(--tp-button-background-color-active, #d6d7db);--btn-bg-f: var(--tp-button-background-color-focus, #c8cad0);--btn-bg-h: var(--tp-button-background-color-hover, #bbbcc4);--btn-fg: var(--tp-button-foreground-color, #2f3137);--cnt-bg: var(--tp-folder-background-color, rgba(200,202,208,0.1));--cnt-bg-a: var(--tp-folder-background-color-active, rgba(200,202,208,0.25));--cnt-bg-f: var(--tp-folder-background-color-focus, rgba(200,202,208,0.2));--cnt-bg-h: var(--tp-folder-background-color-hover, rgba(200,202,208,0.15));--cnt-fg: var(--tp-folder-foreground-color, #c8cad0);--in-bg: var(--tp-input-background-color, rgba(200,202,208,0.1));--in-bg-a: var(--tp-input-background-color-active, rgba(200,202,208,0.25));--in-bg-f: var(--tp-input-background-color-focus, rgba(200,202,208,0.2));--in-bg-h: var(--tp-input-background-color-hover, rgba(200,202,208,0.15));--in-fg: var(--tp-input-foreground-color, #c8cad0);--lbl-fg: var(--tp-label-foreground-color, rgba(200,202,208,0.7));--mo-bg: var(--tp-monitor-background-color, rgba(0,0,0,0.2));--mo-fg: var(--tp-monitor-foreground-color, rgba(200,202,208,0.7));--spr-fg: var(--tp-separator-color, rgba(0,0,0,0.2));--button-background-color: var(--btn-bg);--button-background-color-active: var(--btn-bg-a);--button-background-color-focus: var(--btn-bg-f);--button-background-color-hover: var(--btn-bg-h);--button-foreground-color: var(--btn-fg);--folder-background-color: var(--cnt-bg);--folder-background-color-active: var(--cnt-bg-a);--folder-background-color-focus: var(--cnt-bg-f);--folder-background-color-hover: var(--cnt-bg-h);--folder-foreground-color: var(--cnt-fg);--input-background-color: var(--in-bg);--input-background-color-active: var(--in-bg-a);--input-background-color-focus: var(--in-bg-f);--input-background-color-hover: var(--in-bg-h);--input-foreground-color: var(--in-fg);--label-foregound-color: var(--lbl-fg);--monitor-background-color: var(--mo-bg);--monitor-foreground-color: var(--mo-fg);--separator-color: var(--spr-fg);--unit-size: var(--bld-h)}.tp-rotv{background-color:var(--bs-bg);border-radius:var(--bs-br);box-shadow:0 2px 4px var(--bs-sh);font-family:var(--font-family);font-size:11px;font-weight:500;line-height:1;text-align:left}.tp-rotv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br);border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br);padding-left:calc(2px * 2 + var(--bld-h) + var(--cnt-p));text-align:center}.tp-rotv.tp-rotv-expanded .tp-rotv_b{border-bottom-left-radius:0;border-bottom-right-radius:0}.tp-rotv.tp-rotv-not .tp-rotv_b{display:none}.tp-rotv_c>.tp-fldv.tp-v-last>.tp-fldv_c{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-last:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-left-radius:var(--bs-br);border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-last .tp-fldv_c>.tp-fldv.tp-v-last:not(.tp-fldv-expanded)>.tp-fldv_b{border-bottom-right-radius:var(--bs-br)}.tp-rotv_c>.tp-fldv.tp-v-first>.tp-fldv_b{border-top-left-radius:var(--bs-br);border-top-right-radius:var(--bs-br)}.tp-rotv.tp-v-disabled,.tp-rotv .tp-v-disabled{pointer-events:none}.tp-rotv.tp-v-hidden,.tp-rotv .tp-v-hidden{display:none}.tp-sprv_r{background-color:var(--spr-fg);border-width:0;display:block;height:2px;margin:0;width:100%}.tp-sldv.tp-v-disabled{opacity:0.5}.tp-sldv_t{box-sizing:border-box;cursor:pointer;height:var(--bld-h);margin:0 6px;outline:none;position:relative}.tp-sldv_t::before{background-color:var(--in-bg);border-radius:1px;bottom:0;content:'';display:block;height:2px;left:0;margin:auto;position:absolute;right:0;top:0}.tp-sldv_k{height:100%;left:0;position:absolute;top:0}.tp-sldv_k::before{background-color:var(--in-fg);border-radius:1px;bottom:0;content:'';display:block;height:2px;left:0;margin-bottom:auto;margin-top:auto;position:absolute;right:0;top:0}.tp-sldv_k::after{background-color:var(--btn-bg);border-radius:var(--elm-br);bottom:0;content:'';display:block;height:12px;margin-bottom:auto;margin-top:auto;position:absolute;right:-6px;top:0;width:12px}.tp-sldv_t:hover .tp-sldv_k::after{background-color:var(--btn-bg-h)}.tp-sldv_t:focus .tp-sldv_k::after{background-color:var(--btn-bg-f)}.tp-sldv_t:active .tp-sldv_k::after{background-color:var(--btn-bg-a)}.tp-sldtxtv{display:flex}.tp-sldtxtv_s{flex:2}.tp-sldtxtv_t{flex:1;margin-left:4px}.tp-txtv{position:relative}.tp-txtv_i{padding:0 4px}.tp-txtv.tp-txtv-fst .tp-txtv_i{border-bottom-right-radius:0;border-top-right-radius:0}.tp-txtv.tp-txtv-mid .tp-txtv_i{border-radius:0}.tp-txtv.tp-txtv-lst .tp-txtv_i{border-bottom-left-radius:0;border-top-left-radius:0}.tp-txtv.tp-txtv-num .tp-txtv_i{text-align:right}.tp-txtv.tp-txtv-drg .tp-txtv_i{opacity:0.3}.tp-txtv_k{cursor:pointer;height:100%;left:-4px;position:absolute;top:0;width:12px}.tp-txtv_k::before{background-color:var(--in-fg);border-radius:2px 0 0 2px;bottom:0;content:'';height:var(--bld-h);left:50%;margin-bottom:auto;margin-left:-2px;margin-top:auto;opacity:0.1;position:absolute;top:0;transition:height 0.1s;width:4px}.tp-txtv.tp-txtv-mid .tp-txtv_k::before,.tp-txtv.tp-txtv-lst .tp-txtv_k::before{border-bottom-left-radius:0;border-top-left-radius:0}.tp-txtv_k:hover::before,.tp-txtv.tp-txtv-drg .tp-txtv_k::before{opacity:1}.tp-txtv.tp-txtv-drg .tp-txtv_k::before{border-radius:2px;height:4px}.tp-txtv.tp-txtv-drg.tp-txtv-mid .tp-txtv_k::before,.tp-txtv.tp-txtv-drg.tp-txtv-list .tp-txtv_k::before{border-bottom-left-radius:2px;border-top-left-radius:2px}.tp-txtv_g{bottom:0;display:block;height:8px;left:50%;margin:auto;overflow:visible;pointer-events:none;position:absolute;top:0;visibility:hidden;width:100%}.tp-txtv.tp-txtv-drg .tp-txtv_g{visibility:visible}.tp-txtv_gb{fill:none;stroke:var(--in-fg);stroke-dasharray:2px 2px}.tp-txtv_gh{fill:none;stroke:var(--in-fg)}.tp-txtv .tp-ttv{margin-left:6px;visibility:hidden}.tp-txtv.tp-txtv-drg .tp-ttv{visibility:visible}.tp-ttv{background-color:var(--in-fg);border-radius:var(--elm-br);color:var(--bs-bg);padding:2px 4px;pointer-events:none;position:absolute;transform:translate(-50%, -100%)}.tp-ttv::before{border-color:var(--in-fg) transparent transparent transparent;border-style:solid;border-width:2px;box-sizing:border-box;content:'';font-size:0.9em;height:4px;left:50%;margin-left:-2px;position:absolute;top:100%;width:4px}"),o().forEach((function(t){t.css&&Do(e,"plugin-"+t.id,t.css)}))}var Lo=function(e){function n(t){var n,r=this,i=t||{},o=null!==(n=i.document)&&void 0!==n?n:x(),a=new St(o,{expanded:i.expanded,blade:new m,props:new Y({title:i.title}),viewProps:ae()});return(r=e.call(this,a)||this).containerElem_=i.container||Oo(o),r.containerElem_.appendChild(r.element),r.doc_=o,r.usesDefaultWrapper_=!i.container,jo(r.document),r}return t(n,e),Object.defineProperty(n.prototype,"document",{get:function(){if(!this.doc_)throw c.alreadyDisposed();return this.doc_},enumerable:!1,configurable:!0}),n.prototype.dispose=function(){var t=this.containerElem_;if(!t)throw c.alreadyDisposed();if(this.usesDefaultWrapper_){var n=t.parentElement;n&&n.removeChild(t)}this.containerElem_=null,this.doc_=null,e.prototype.dispose.call(this)},n.version=new po("2.3.0"),n}(At);function To(){[Ki,Ji,ao,co,xi,mi,vi,di,Gn].forEach((function(e){d({type:"input",plugin:e})})),[yo,So,Vo].forEach((function(e){d({type:"monitor",plugin:e})})),[Dn,Le,Mn].forEach((function(e){d({type:"blade",plugin:e})}))}return To(),Lo}()})),r="undefined"!=typeof Float32Array?Float32Array:Array;
/*! Tweakpane 2.3.0 (c) 2016 cocopon, licensed under the MIT license. */function i(e,t,n,r){var i,o,a,s,u,l,c,p,f,d,h=t[0],v=t[1],m=t[2],b=r[0],g=r[1],y=r[2],w=n[0],_=n[1],x=n[2];return Math.abs(h-w)<1e-6&&Math.abs(v-_)<1e-6&&Math.abs(m-x)<1e-6?function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}(e):(c=h-w,p=v-_,f=m-x,i=g*(f*=d=1/Math.hypot(c,p,f))-y*(p*=d),o=y*(c*=d)-b*f,a=b*p-g*c,(d=Math.hypot(i,o,a))?(i*=d=1/d,o*=d,a*=d):(i=0,o=0,a=0),s=p*a-f*o,u=f*i-c*a,l=c*o-p*i,(d=Math.hypot(s,u,l))?(s*=d=1/d,u*=d,l*=d):(s=0,u=0,l=0),e[0]=i,e[1]=s,e[2]=c,e[3]=0,e[4]=o,e[5]=u,e[6]=p,e[7]=0,e[8]=a,e[9]=l,e[10]=f,e[11]=0,e[12]=-(i*h+o*v+a*m),e[13]=-(s*h+u*v+l*m),e[14]=-(c*h+p*v+f*m),e[15]=1,e)}function o(e,t,n,r){return e[0]=t,e[1]=n,e[2]=r,e}function a(e,t,n){return e[0]=t[0]+n[0],e[1]=t[1]+n[1],e[2]=t[2]+n[2],e}Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)});var s,u=function(e,t,n){return e[0]=t[0]-n[0],e[1]=t[1]-n[1],e[2]=t[2]-n[2],e},l=function(e){var t=e[0],n=e[1],r=e[2];return Math.hypot(t,n,r)};s=new r(3),r!=Float32Array&&(s[0]=0,s[1]=0,s[2]=0);export{o as a,a as b,i as c,l,t as r,u as s,n as t};
